<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Chapter 2. Quick Install</title><meta name="generator" content="DocBook XSL Stylesheets V1.58.1"><link rel="home" href="index.html" title="OpenACS Documentation"><link rel="up" href="acs-admin.html" title="Part II. Administrator's Guide"><link rel="previous" href="acs-admin.html" title="Part II. Administrator's Guide"><link rel="next" href="software-versions.html" title="Chapter 3. Prerequisite Software"><link rel="stylesheet" href="openacs.css" type="text/css"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><a href="http://openacs.org"><img src="images/alex.jpg" border="0"></a><table width="100%" summary="Navigation header" border="0"><tr><td width="20%" align="left"><a accesskey="p" href="acs-admin.html">Prev</a> </td><th width="60%" align="center">Part II. Administrator's Guide</th><td width="20%" align="right"> <a accesskey="n" href="software-versions.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><h2 class="title"><a name="quick"></a>Chapter 2. Quick Install</h2></div></div><div class="authorblurb"><p>
	by <a href="mailto:docs@openacs.org" target="_top">Joel Aufrecht</a><br>
          OpenACS docs are written by the named authors, and may be edited
          by OpenACS documentation staff.
        </p></div><div class="sect2" lang="en"><div class="titlepage"><div><h3 class="title"><a name="install-purpose"></a>Purpose of this document</h3></div></div><p>
	  This page describes a minimal installation of OpenACS with
	  PostGreSQL (not Oracle).  It will produce a working OpenACS
	  installation in under an hour.  It excludes source control,
	  full text search, ssl, managed services (daemontools),
	  DocBook, and qmail.  
	</p></div><div class="sect2" lang="en"><div class="titlepage"><div><h3 class="title"><a name="id2952161"></a>For Red Hat 9</h3></div></div><div class="orderedlist"><ol type="1"><li><p>Install PostGreSQL 7.3.2 from RPM.  Select
        <tt>Menu &gt; System Settings &gt; Add/Remove
        Applications</tt> and select <tt>Database Server</tt>.</p></li><li><p><a name="install-postgres-rpm"></a><b>Using the Red Hat RPM. </b>Red Hat users: If you install PostGreSQL 7.3.2 from the Red Hat 9 RPM, you
  can skip a few steps.  These shell commands add a link so that the
  data directory appears to be in the same place as in a source
  install; start the service; create a new group for web service
  users, and modify the postgres user's
  environment (<a href="postgres.html#install-postgres-env">more
  information</a>):</p></li><li><a name="install-plpgsql"></a><p><b>Install Pl/pgSQL. </b>Set up plpgsq and allow your user to have
	  access. Plpgsql is a PL/SQL-like language.  We add it to
	  template1, which is the template from which all new
	  databases are created.  We can verify that it was created
	  with the createlang command in list mode.</p><pre class="screen">[postgres@yourserver pgsql]$ <b><tt>createlang plpgsql template1</tt></b>
[postgres@yourserver pgsql]$ <b><tt>createlang -l template1</tt></b>
Procedural languages
  Name   | Trusted?
---------+----------
 plpgsql | t
(1 row)

[postgres@yourserver pgsql]$
<pre class="action">createlang plpgsql template1
createlang -l template1</pre></pre></li><li><a name="aolserver-tarball"></a><p><b>Unpack the Aolserver tarball. </b>Download the <a href="individual-programs.html#source-aolserver">aolserver tarball</a> to <tt>/tmp/aolserver3.3oacs1.tar.gz</tt>.  As <tt>root</tt>, untar
      <tt>aolserver3.3oacs1.tar.gz</tt>
      into <tt>/usr/local/src</tt>.
    </p><pre class="screen">[root@yourserver root]# <b><tt>cd /usr/local/src</tt></b>
[root@yourserver src]# <b><tt>tar xzf /tmp/aolserver3.3oacs1.tar.gz</tt></b>
[root@yourserver src]#
<pre class="action">cd /usr/local/src
tar xzf /tmp/aolserver3.3oacs1.tar.gz</pre></pre></li><li><a name="install-aolserver-compile"></a><p><b>Compile AOLserver. </b>Compile and install AOLserver.  First, prepare the installation directory and the source code.  The message about BUILD-MODULES can be ignored.</p><pre class="screen">root@yourserver root]# <b><tt>mkdir -p /usr/local/aolserver</tt></b>
[root@yourserver root]# <b><tt>cd /usr/local/src/aolserver</tt></b>
[root@yourserver aolserver]# <b><tt>./conf-clean</tt></b>
cat: BUILD-MODULES: No such file or directory
Done.
[root@yourserver aolserver]#<pre class="action">mkdir -p /usr/local/aolserver
cd /usr/local/src/aolserver
./conf-clean</pre></pre><p>
          If you are using Oracle, edit
          <tt>conf-db</tt> and change
          <tt>postgresql</tt> to
          <tt>oracle</tt>, or to the word
          <tt>both</tt> if you want both drivers
          installed.  In order to get nsoracle to compile, you may
          need to su - oracle, and then su (without the -) root to set
          the environment variables properly.
        </p><p><tt>conf-inst</tt> should contain the
          location where AOLserver is to be installed.  Overwrite the
          tarball's default value with our default value, <tt>/usr/local/aolserver</tt>:</p><pre class="screen">[root@yourserver aolserver]# <b><tt>echo &quot;/usr/local/aolserver&quot; &gt; conf-inst</tt></b>
[root@yourserver aolserver]#</pre><p><tt>conf-make</tt> should contain the
          name of the GNU Make command on your system. It defaults to
          <tt>gmake</tt>.</p><p>Set an environment variable that the nspostgres driver
      Makefile needs to compile correctly and run
          <tt>conf</tt>, which compiles
          AOLserver, the default modules, and the database driver, and
          installs them.</p><p>(Debian Users working with AOLserver 3.3+ad13 and
          postgresql from apt-get may need to
          make these symlinks: <tt>ln -s
          /usr/include/postgresql/ /usr/include/pgsql</tt>
          and <tt>ln -s /usr/lib/postgresql /usr/local/pgsql</tt>)</p><pre class="screen">[root@yourserver aolserver]# <b><tt>export POSTGRES=/usr/local/pgsql; ./conf</tt></b>
Building in /usr/local/aolserver
with the following modules:
aolserver
nscache
nsrewrite
nssha1
nsxml
pgdriver
==================================================================
Starting Build Sat Mar  8 10:28:26 PST 2003
Running gmake in aolserver/; output in log/aolserver.log
<span class="emphasis"><em>(several minute delay here)</em></span>
Running gmake in nscache/; output in log/nscache.log
Running gmake in nsrewrite/; output in log/nsrewrite.log
Running gmake in nssha1/; output in log/nssha1.log
Running gmake in nsxml/; output in log/nsxml.log
Running gmake in nspostgres/; output in log/nspostgres.log
Creating  ...
==================================================================
Done Building Sat Mar  8 10:31:35 PST 2003
[root@yourserver aolserver]# </pre><p>
          This takes about 5 minutes. It builds aolserver, several modules, and the database driver.  (Upgraders, note that the postgres database driver has changed from postgres.so to nspostgres.so).  All of the results are logged to files in <tt>/usr/local/src/aolserver/log</tt>.  If you run into problems running AOLserver, check these files for build errors.</p></li><li><a name="aolserver-db-wrapper"></a><p><b>Add a database-specific wrapper script. </b>This script
	  sets database environment variables before starting
	  AOLserver; this allows the AOLserver instance can
	  communicate with the database.  There is one script each for
	  Oracle and PostGreSQL.  They don't conflict, so if you plan
	  to use both databases, install both.</p><div class="itemizedlist"><ul type="disc"><li><p>Oracle</p><pre class="screen">[root@yourserver aolserver]# <b><tt>cd /usr/local/aolserver/bin</tt></b>
[root@yourserver bin]# <b><tt>cp /tmp/openacs-5.0.0d/packages/acs-core-docs/www/files/nsd-oracle.txt ./nsd-oracle</tt></b>
[root@yourserver bin]# <b><tt>chmod 750 nsd-oracle</tt></b>
[root@yourserver bin]#
<pre class="action">cd /usr/local/aolserver/bin
cp /tmp/openacs-5.0.0d/packages/acs-core-docs/www/files/nsd-oracle.txt ./nsd-oracle
chmod 750 nsd-oracle</pre></pre></li><li><p>PostGreSQL</p><pre class="screen">[root@yourserver aolserver]# <b><tt>cd /usr/local/aolserver/bin</tt></b>
[root@yourserver bin]# <b><tt>cp /tmp/openacs-5.0.0d/packages/acs-core-docs/www/files/nsd-postgres.txt ./nsd-postgres</tt></b>
[root@yourserver bin]# <b><tt>chmod 755 nsd-postgres</tt></b>
[root@yourserver bin]#
<pre class="action">cd /usr/local/aolserver/bin
cp /tmp/openacs-5.0.0d/packages/acs-core-docs/www/files/nsd-postgres.txt ./nsd-postgres
chmod 755 nsd-postgres</pre></pre></li></ul></div></li><li><p><a name="make-web-directory"></a>The reference install stores all OpenACS services in
      <tt>/web</tt>, with one subdirectory per
      service.  The first time you install a service, you must create
      that directory and set its permissions:</p><pre class="screen">[root@yourserver root]# <b><tt>mkdir /web</tt></b>
[root@yourserver root]# <b><tt>chgrp web /web</tt></b>
[root@yourserver root]# <b><tt>chmod 770 /web</tt></b>
[root@yourserver root]#
<pre class="action">mkdir /web
chgrp web /web
chmod 770 /web</pre></pre></li><li><p><a name="install-openacs-download"></a>You should already have downloaded the OpenACS tarball
      to the <tt>/tmp</tt> directory.  If
      not, <a href="individual-programs.html#openacs-download">download the OpenACS
      tarball</a> and save it in
      <tt>/tmp</tt> and proceed:</p></li><li><p><a name="install-aolserver-user-accounts"></a>Set up your user account.</p><p>
      AOLserver needs to be started as the root user if you want to use
      port 80. Once it starts, though, it will drop the root privileges and
      run as another user, which you must specify on the command line. It's
      important that this user has as few privileges as possible. Why?
      Because if an intruder somehow breaks in through AOLserver, you don't
      want her to have any ability to do damage to the rest of your
      server.</p><p>At the same time, AOLserver needs to have write access to
      some files on your system in order for OpenACS to function
      properly. So, we'll run AOLserver with a different user account
      for each different service.  A service name should be a single
      word, <span class="emphasis"><em>letters and numbers only</em></span>. If the name
      of your site is one word, that would be a good choice. For
      example &quot;<span class="replaceable">service0</span>&quot; might be the service name for the
      <a href="http://service0.net/" target="_top"><span class="replaceable">service0</span>.net</a>
      community.</p><p>For the 5.0.0d-P and 5.0.0d-O Reference Platform,
      we'll use a server named <span class="replaceable">service0</span> and
      a user named <span class="replaceable">service0</span>.  We'll leave the password
      blank for increased security.  The only way to log in will be
      with ssh certificates.  The only people who should log in are
      developers for that specific instance.  Add this user, and put
      it in the <tt>web</tt> group so that it
      can use database commands associated with that group.
    </p><pre class="screen">[root@yourserver root]# <b><tt>useradd -g web <span class="replaceable">service0</span> -d /home/<span class="replaceable">service0</span></tt></b>
[root@yourserver root]#</pre><p>Set up database environment variables.  They are
	necessary for working with the database.  
</p><pre class="screen">[root@yourserver root]# <b><tt>su - <span class="replaceable">service0</span></tt></b>
[service0@yourserver service0]$ <b><tt>emacs .bashrc</tt></b></pre><p>Put in the appropriate lines for the database you are running.  If you will use both databases, put in both sets of lines.</p><div class="itemizedlist"><ul type="disc"><li><p>PostGreSQL:</p><pre class="programlisting">export LD_LIBRARY_PATH=LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/pgsql/lib
export PATH=$PATH:/usr/local/pgsql/bin</pre></li><li><p>Oracle.  These environment variables are specific for a local Oracle
      installation communicating via IPC. If you are connecting to a remote
      Oracle installation, you'll need to adjust these appropriately. Also,
      make sure that the '8.1.7' matches your Oracle version.
</p><pre class="programlisting">export ORACLE_BASE=/ora8/m01/app/oracle
export ORACLE_HOME=$ORACLE_BASE/product/<span class="replaceable">8.1.7</span>
export PATH=$PATH:$ORACLE_HOME/bin
export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
export ORACLE_SID=ora8
export ORACLE_TERM=vt100
export ORA_NLS33=$ORACLE_HOME/ocommon/nls/admin/data</pre></li></ul></div><p>Test this by logging out and back in as
	<tt><span class="replaceable">service0</span></tt> and checking the paths.</p><pre class="screen">[service0@yourserver service0]$ <b><tt>exit</tt></b>
logout
[root@yourserver src]# <b><tt>su - <b><tt><span class="replaceable">service0</span></tt></b></tt></b>
[postgres@yourserver pgsql]$ <b><tt>env | grep PATH</tt></b>
</pre><p>For PostGreSQL, you should see:</p><pre class="screen">
LD_LIBRARY_PATH=LD_LIBRARY_PATH=:/usr/local/pgsql/lib
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:/usr/bin/X11:/usr/X11R6/bin:/root/bin:/usr/local/pgsql/bin:/usr/local/pgsql/bin</pre><p>For Oracle:</p><pre class="screen">ORACLE_BASE=/ora8/m01/app/oracle
ORACLE_HOME=/ora8/m01/app/oracle/product/8.1.7
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:/usr/bin/X11:/usr/X11R6/bin:/root/bin:/ora8/m01/app/oracle/product/8.1.7/bin
LD_LIBRARY_PATH=/ora8/m01/app/oracle/product/8.1.7/lib:/lib:/usr/lib
ORACLE_SID=ora8
ORACLE_TERM=vt100
ORA_NLS33=$ORACLE_HOME/ocommon/nls/admin/data</pre><pre class="screen">[service0@yourserver service0]$ <b><tt>exit</tt></b>
logout

[root@yourserver root]#</pre></li><li><p><a name="unpack-openacs"></a>Unpack the OpenACS tarball and rename it to <tt>service0</tt>.  Secure the directory so that only the owner can access it.  Check the permissions by listing the directory.</p><pre class="screen">[root@yourserver root]# <b><tt>su - <span class="replaceable">service0</span></tt></b>
[service0@yourserver service0]$ <b><tt>cd /web</tt></b>
[service0@yourserver web]$ <b><tt>tar xzf /tmp/openacs-5.0.0d.tgz</tt></b>
[service0@yourserver web]$ <b><tt>mv openacs-5.0.0d <span class="replaceable">service0</span></tt></b>
[service0@yourserver web]$ <b><tt>chmod -R 700 <span class="replaceable">service0</span></tt></b>
[service0@yourserver web]$ <b><tt>ls -al</tt></b>
total 3
drwxrwx---    3 root     web          1024 Mar 29 16:41 .
drwxr-xr-x   25 root     root         1024 Mar 29 16:24 ..
drwx------    7 service0 web          1024 Jan  6 14:36 service0
[service0@yourserver web]$ <b><tt>exit</tt></b>
logout

[root@yourserver root]#
<pre class="action">su - service0
cd /web
tar xzf /tmp/openacs-5.0.0d.tgz
mv openacs-5.0.0d service0
chmod -R 700 service0/
exit</pre></pre></li><li><p><a name="create-service-db-user"></a>Create a user in the database matching the service name.</p><pre class="screen">[root@yourserver root]# <b><tt>su - postgres</tt></b>
[postgres@yourserver pgsql]$ <b><tt>createuser <span class="replaceable">service0</span></tt></b>
Shall the new user be allowed to create databases? (y/n) <b><tt>y</tt></b>
Shall the new user be allowed to create more new users? (y/n) <b><tt>y</tt></b>
CREATE USER
[postgres@yourserver pgsql]$ <b><tt>exit</tt></b>
logout

[root@yourserver root]#</pre></li><li><p><a name="create-database"></a>Create a database with the same name as our service name, <span class="replaceable">service0</span>.</p><pre class="screen">[root@yourserver root]# <b><tt>su - <span class="replaceable">service0</span></tt></b>
[service0@yourserver service0]$ <b><tt>createdb -E UNICODE <span class="replaceable">service0</span></tt></b>
CREATE DATABASE
[service0@yourserver service0]$
<pre class="action">su - <span class="replaceable">service0</span>
createdb -E UNICODE <span class="replaceable">service0</span></pre></pre></li><li><a name="db-setup-exit"></a><pre class="screen">[service0@yourserver service0]$ <b><tt>exit</tt></b>
logout

[root@yourserver root]# </pre></li><li><p><a name="start-aolserver"></a>
	  Kill any current running AOLserver processes and start a new
	  one.  If you are using Oracle, rather than PostgreSQL, replace
	  <tt>nsd-postgres</tt> with
	  <tt>nsd-oracle</tt>).</p><p>If you want to use port 80, there are complications.
	  First, Aolserver must be root to use system ports such as
	  80, but refuses to run as root for security reasons.  Thus
	  you must start as root and specify a non-root user ID and
	  Group ID which Aolserver will switch to after claiming the
	  port.  To do so, find the UID and GID of the
	  <span class="replaceable">service0</span> user via
	  <tt>grep <span class="replaceable">service0</span>
	  /etc/passwd</tt> and then put those numbers into
	  the command line via <tt>-u
	  <span class="replaceable">501</span> -g
	  <span class="replaceable">502</span></tt>.  Second, if you are root then killall will affect all OpenACS services on the machine, so if there's more than one you'll have to do <tt>ps -auxw | grep
	  nsd</tt> and selectively kill by job number.</p><pre class="screen">[service0@yourserver etc]$ <b><tt>killall nsd</tt></b>
nsd: no process killed
[service0@yourserver service0]$<b><tt> /usr/local/aolserver/bin/nsd-postgres -t /web/<span class="replaceable">service0</span>/etc/config.tcl</tt></b>
[service0@yourserver service0]$ [08/Mar/2003:18:13:29][32131.8192][-main-] Notice: nsd.tcl: starting to read config file...
[08/Mar/2003:18:13:29][32131.8192][-main-] Notice: nsd.tcl: finished reading config file.</pre></li></ol></div></div><div class="sect2" lang="en"><div class="titlepage"></div><p>After completing installation and restarting the server, go to <a href="http://localhost:8000" target="_top">http://localhost:8000</a> for configuration and customization instructions.  You can upgrade a Quick Install with source control, full text search, backup/recovery, and other production features by walking through the <a href="unix-install" target="_top">Installation documentation</a> and doing the steps marked OPTIONAL.</p></div><div class="cvstag">($Id$)</div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="acs-admin.html">Prev</a> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right"> <a accesskey="n" href="software-versions.html">Next</a></td></tr><tr><td width="40%" align="left">Part II. Administrator's Guide </td><td width="20%" align="center"><a accesskey="u" href="acs-admin.html">Up</a></td><td width="40%" align="right"> Chapter 3. Prerequisite Software</td></tr></table><hr><address><a href="mailto:docs@openacs.org">docs@openacs.org</a></address></div><a name="comments"></a><center><a href="http://openacs.org/doc/quick.html#comments">View comments on this page at openacs.org</a></center></body></html>
