<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Install OpenACS 4.6.2</title><meta name="generator" content="DocBook XSL Stylesheets V1.58.1"><link rel="home" href="index.html" title="OpenACS Documentation"><link rel="up" href="unix-install.html" title="Chapter 3. Installing on Unix/Linux"><link rel="previous" href="aolserver.html" title="Install AOLserver 3.3+ad13"><link rel="next" href="credits.html" title="Credits"><link rel="stylesheet" href="openacs.css" type="text/css"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><a href="http://openacs.org"><img src="images/alex.jpg" border="0"></a><table width="100%" summary="Navigation header" border="0"><tr><td width="20%" align="left"><a accesskey="p" href="aolserver.html">Prev</a> </td><th width="60%" align="center">Chapter 3. Installing on Unix/Linux</th><td width="20%" align="right"> <a accesskey="n" href="credits.html">Next</a></td></tr></table><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="openacs"></a>Install OpenACS 4.6.2</h2></div></div><div class="authorblurb"><p>
	by <a href="mailto:vinod@kurup.com" target="_top">Vinod Kurup</a><br>
          OpenACS docs are written by the named authors, but may be edited
          by OpenACS documentation staff.
        </p></div><div class="sect2" lang="en"><div class="titlepage"><div><h3 class="title"><a name="id2890265"></a>Set up the file system for an OpenACS Service</h3></div></div><div class="orderedlist"><ol type="1"><li><p>The reference install stores all OpenACS services in
      <tt>/web</tt>, with one subdirectory per
      service.  The first time you install a service, you must create
      that directory and set its permissions:</p><pre class="screen">[root@yourserver root]# <b><tt>mkdir /web</tt></b>
[root@yourserver root]# <b><tt>chgrp web /web</tt></b>
[root@yourserver root]# <b><tt>chmod 770 /web</tt></b>
[root@yourserver root]#
<pre class="action">mkdir /web
chgrp web /web
chmod 770 /web</pre></pre></li><li><p><a name="install-openacs-download"></a>You should already have downloaded the OpenACS tarball
      to the <tt>/tmp</tt> directory.  If
      noot, <a href="individual-programs.html#openacs-download">download the OpenACS
      tarball</a> and save it in
      <tt>/tmp</tt> and proceed:</p></li><li><p><a name="install-aolserver-user-accounts"></a>Set up your user account.</p><p>
      AOLserver needs to be started as the root user if you want to use
      port 80. Once it starts, though, it will drop the root privileges and
      run as another user, which you must specify on the command line. It's
      important that this user has as few privileges as possible. Why?
      Because if an intruder somehow breaks in through AOLserver, you don't
      want her to have any ability to do damage to the rest of your
      server.</p><p>At the same time, AOLserver needs to have write access to
      some files on your system in order for OpenACS to function
      properly. So, we'll run AOLserver with a different user account
      for each different service.  A service name should be a single
      word, <span class="emphasis"><em>letters and numbers only</em></span>. If the name
      of your site is one word, that would be a good choice. For
      example &quot;<span class="replaceable">service0</span>&quot; might be the service name for the
      <a href="http://service0.net/" target="_top"><span class="replaceable">service0</span>.net</a>
      community.</p><p>For the 4.6.2-P and 4.6.2-O Reference Platform,
      we'll use a server named <span class="replaceable">service0</span> and
      a user named <span class="replaceable">service0</span>.  We'll leave the password
      blank for increased security.  The only way to log in will be
      with ssh certificates.  The only people who should log in are
      developers for that specific instance.  Add this user, and put
      it in the <tt>web</tt> group so that it
      can use database commands associated with that group.
    </p><pre class="screen">[root@yourserver root]# <b><tt>useradd -g web <span class="replaceable">service0</span></tt></b>
[root@yourserver root]#</pre><p>Set up database environment variables.  They are
	necessary for working with the database.  
</p><pre class="screen">[root@yourserver root]# <b><tt>su - <span class="replaceable">service0</span></tt></b>
[service0@yourserver service0]$ <b><tt>emacs .bashrc</tt></b></pre><p>Put in the appropriate lines for the database you are running.  If you will use both databases, put in both sets of lines.</p><div class="itemizedlist"><ul type="disc"><li><p>PostGreSQL:</p><pre class="programlisting">export LD_LIBRARY_PATH=LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/pgsql/lib
export PATH=$PATH:/usr/local/pgsql/bin</pre></li><li><p>Oracle.  These environment variables are specific for a local Oracle
      installation communicating via IPC. If you are connecting to a remote
      Oracle installation, you'll need to adjust these appropriately. Also,
      make sure that the '8.1.7' matches your Oracle version.
</p><pre class="programlisting">export ORACLE_BASE=/ora8/m01/app/oracle
export ORACLE_HOME=$ORACLE_BASE/product/<span class="replaceable">8.1.7</span>
export PATH=$PATH:$ORACLE_HOME/bin
export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
export ORACLE_SID=ora8
export ORACLE_TERM=vt100
export ORA_NLS33=$ORACLE_HOME/ocommon/nls/admin/data</pre></li></ul></div><p>Test this by logging out and back in as
	<tt><span class="replaceable">service0</span></tt> and checking the paths.</p><pre class="screen">[service0@yourserver service0]$ <b><tt>exit</tt></b>
logout
[root@yourserver src]# <b><tt>su - <b><tt><span class="replaceable">service0</span></tt></b></tt></b>
[postgres@yourserver pgsql]$ <b><tt>env | grep PATH</tt></b>
</pre><p>For PostGreSQL, you should see:</p><pre class="screen">
LD_LIBRARY_PATH=LD_LIBRARY_PATH=:/usr/local/pgsql/lib
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:/usr/bin/X11:/usr/X11R6/bin:/root/bin:/usr/local/pgsql/bin:/usr/local/pgsql/bin</pre><p>For Oracle:</p><pre class="screen">ORACLE_BASE=/ora8/m01/app/oracle
ORACLE_HOME=/ora8/m01/app/oracle/product/8.1.7
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:/usr/bin/X11:/usr/X11R6/bin:/root/bin:/ora8/m01/app/oracle/product/8.1.7/bin
LD_LIBRARY_PATH=/ora8/m01/app/oracle/product/8.1.7/lib:/lib:/usr/lib
ORACLE_SID=ora8
ORACLE_TERM=vt100
ORA_NLS33=$ORACLE_HOME/ocommon/nls/admin/data</pre><pre class="screen">[service0@yourserver service0]$ <b><tt>exit</tt></b>
logout

[root@yourserver root]#</pre></li><li><p>Unpack the OpenACS tarball and rename it to <tt>service0</tt>.  Secure the directory so that only the owner can access it.  Check the permissions by listing the directory.</p><pre class="screen">[root@yourserver root]# <b><tt>su - <span class="replaceable">service0</span></tt></b>
[service0@yourserver service0]$ <b><tt>cd /web</tt></b>
[service0@yourserver web]$ <b><tt>tar xzf /tmp/openacs-4.6.2.tgz</tt></b>
[service0@yourserver web]$ <b><tt>mv openacs-4.6.2 <span class="replaceable">service0</span></tt></b>
[service0@yourserver web]$ <b><tt>chmod -R 700 <span class="replaceable">service0</span></tt></b>
[service0@yourserver web]$ ls -al
total 3
drwxrwx---    3 root     web          1024 Mar 29 16:41 .
drwxr-xr-x   25 root     root         1024 Mar 29 16:24 ..
drwx------    7 service0 web          1024 Jan  6 14:36 service0
[service0@yourserver web]$ <b><tt>exit</tt></b>
logout

[root@yourserver root]#
<pre class="action">su - service0
cd /web
tar xzf /tmp/openacs-4.6.2.tgz
mv openacs-4.6.2 service0
chmod -R 700 service0/
ls -al
exit</pre></pre></li><li><p><a name="cvs-service-import"></a><b>Add the Service to CVS - OPTIONAL. </b><a class="indexterm" name="id2892443"></a>If this is a development server, you may want to add it to your local CVS repository.</p><div class="orderedlist"><ol type="a"><li><p>Create and set permissions on a subdirectory in the local cvs repository.</p><pre class="screen">[root@yourserver root]# <b><tt>mkdir /cvsroot/<span class="replaceable">service0</span></tt></b>
[root@yourserver root]#<b><tt> chown <span class="replaceable">service0</span>.web /cvsroot/<span class="replaceable">service0</span></tt></b>
[root@yourserver root]#
<pre class="action">mkdir /cvsroot/<span class="replaceable">service0</span>
chown <span class="replaceable">service0</span>.web /cvsroot/<span class="replaceable">service0</span></pre></pre></li><li><p>Add the repository location to the user environment.</p><pre class="screen">[root@yourserver root]# <b><tt>su - <span class="replaceable">service0</span></tt></b>
[service0@yourserver service0]$<b><tt> emacs .bashrc</tt></b></pre><p>Put this string into <tt>/home/<span class="replaceable">service0</span>/.bashrc</tt>:</p><pre class="programlisting">export CVSROOT=/cvsroot</pre><pre class="screen">[service0@yourserver service0]$ <b><tt>exit</tt></b>
logout

[root@yourserver root]#</pre></li><li><p>Import all files into cvs.  In order to work on
            files with source control, the files must be checked out
            from cvs.  So we will import, move aside, and then check
            out all of the files.  In the cvs import command,
            <tt><span class="replaceable">service0</span></tt>
            refers to the cvs repository to use; it uses the CVSROOT
            plus this string,
            i.e.
            <tt>/cvsroot/<span class="replaceable">service0</span></tt>.
            &quot;OpenACS&quot; is the vendor tag, and &quot;openacs-4-6-2&quot; is the
            release tag.  These tags will be useful in upgrading and
            branching.  -m sets the version comment.</p><pre class="screen">[root@yourserver root]# <b><tt>su - <span class="replaceable">service0</span></tt></b>
[service0@yourserver service0]$ <b><tt>cd /web/<span class="replaceable">service0</span></tt></b>
[service0@yourserver service0]$ <b><tt>cvs import -m &quot;initial install&quot; <span class="replaceable">service0</span> OpenACS openacs-4-6-2</tt></b>
N <span class="replaceable">service0</span>/license.txt
N <span class="replaceable">service0</span>/readme.txt
<span class="emphasis"><em>(many lines omitted)</em></span>
N <span class="replaceable">service0</span>/www/SYSTEM/flush-memoized-statement.tcl

No conflicts created by this import

[service0@yourserver service0]$
<pre class="action">su - <span class="replaceable">service0</span>
cd /web/<span class="replaceable">service0</span>
cvs import -m &quot;initial install&quot; <span class="replaceable">service0</span> OpenACS openacs-4-6-2</pre></pre><p>Move the original directory to a temporary location, and check out the cvs repository in its place.  If the service starts correctly, come back and remove the temporary copy of the uploaded files.</p><pre class="screen">[service0@yourserver service0]$ <b><tt>cd ..</tt></b>
[service0@yourserver web]$<b><tt> mv <span class="replaceable">service0</span> <span class="replaceable">service0</span>.orig</tt></b>
[service0@yourserver web]$ <b><tt>cvs checkout <span class="replaceable">service0</span></tt></b>
cvs checkout: Updating <span class="replaceable">service0</span>
U <span class="replaceable">service0</span>/license.txt
<span class="emphasis"><em>(many lines omitted)</em></span>
U <span class="replaceable">service0</span>/www/SYSTEM/dbtest.tcl
U <span class="replaceable">service0</span>/www/SYSTEM/flush-memoized-statement.tcl
[service0@yourserver web]$ <b><tt>exit</tt></b>
logout

[root@yourserver web]#
<pre class="action">cd ..
mv <span class="replaceable">service0</span> <span class="replaceable">service0</span>.orig
cvs checkout <span class="replaceable">service0</span>
exit</pre></pre></li></ol></div></li><li><p>Set up several additional directories in the service root:
      <tt>etc</tt> is for configuration and control files, <tt>log</tt> is for error and request (web page hit) log files, and <tt>database-backup</tt> is for database backup files.  If you did the CVS step, note that these new directories are excluded from that step so that you can decide whether or not you want your logs and config files in source control.</p><pre class="screen">[root@yourserver root]# <b><tt>su - <span class="replaceable">service0</span></tt></b>
[service0@yourserver service0]$ <b><tt>mkdir /web/<span class="replaceable">service0</span>/etc /web/<span class="replaceable">service0</span>/log /web/<span class="replaceable">service0</span>/database-backup</tt></b>
[service0@yourserver web]$ <b><tt>exit</tt></b>
logout

[root@yourserver web]#
<pre class="action">su - service0
mkdir /web/<span class="replaceable">service0</span>/etc /web/<span class="replaceable">service0</span>/log /web/<span class="replaceable">service0</span>/database-backup
exit</pre></pre></li></ol></div></div><div class="sect2" lang="en"><div class="titlepage"><div><h3 class="title"><a name="install-openacs-prepare-oracle"></a>Prepare Oracle for OpenACS</h3></div></div><p>OPTIONAL - if you won't be using Oracle, skip to <a href="openacs.html#install-openacs-prepare-postgres">Prepare PostgreSQL for OpenACS</a></p><p>
	  You should be sure that your user account
	  (e.g. <tt><span class="replaceable">service0</span></tt>) is in the
	  <tt>dba</tt> group.
	</p><div class="orderedlist"><ol type="1"><li><p> 
		  Verify membership by typing
		  <tt>groups</tt> when you login:

		  </p><pre class="programlisting">
<span class="replaceable">service0</span>:~$ groups
dba web</pre><p>

		  If you do not see these groups, take the following action: 

		  </p><pre class="programlisting">
<span class="replaceable">service0</span>:~$ su -      
Password: ************
root:~# adduser <span class="emphasis"><em><span class="replaceable">service0</span></em></span> dba</pre><p>

		  If you get an error about an undefined group, then add that group
		  manually:

</p><pre class="programlisting">
root:~# groupadd dba
root:~# groupadd web</pre><p>

		  Make sure to logout as <tt>root</tt> when
		  you are finished with this step and log back in as
		  your regular user.
		</p></li><li><p> 
		  Connect to Oracle using
		  <tt>svrmgrl</tt> and login:
        
		  </p><pre class="programlisting">
<span class="replaceable">service0</span>:~$ svrmgrl

SVRMGR&gt; connect internal
Connected.</pre><p>
		</p></li><li><p>
		  Determine where the system tablespaces are stored: 

		  </p><pre class="programlisting">
SVRMGR&gt;  select file_name from dba_data_files;</pre><p>
        Example results: 

		  </p><pre class="programlisting">
/ora8/m01/app/oracle/oradata/ora8/system01.dbf
/ora8/m01/app/oracle/oradata/ora8/tools01.dbf
/ora8/m01/app/oracle/oradata/ora8/rbs01.dbf
/ora8/m01/app/oracle/oradata/ora8/temp01.dbf
/ora8/m01/app/oracle/oradata/ora8/users01.dbf
/ora8/m01/app/oracle/oradata/ora8/indx01.dbf
/ora8/m01/app/oracle/oradata/ora8/drsys01.dbf</pre><p>
		</p></li><li><p> 
		  Using the above output, you should determine where
		  to store your tablespace. As a general rule, you'll want to
		  store your tablespace on a mount point under the
		  <tt>/ora8</tt> directory that is separate
		  from the Oracle system data files. By default, the Oracle system
		  is on <tt>m01</tt>, so we will use
		  <tt>m02</tt>. This enables your Oracle
		  system and database files to be on separate disks for optimized
		  performance. For more information on such a configuration, see
		  <a href="http://philip.greenspun.com/panda/databases-choosing" target="_top">Chapter
		  12</a> of <a href="http://philip.greenspun.com/panda/" target="_top">Philip's
		  book</a>.  For this example, we'll use
		  <tt>/ora8/m02/oradata/ora8/</tt>.
		</p></li><li><p> 
		  Create the directory for the datafile; to do this,
		  exit from <tt>svrmgrl</tt> and login as
		  <tt>root</tt> for this step: </p><pre class="programlisting">
SVRMGR&gt; exit
<span class="replaceable">service0</span>:~$ su -
Password: ************
root:~# mkdir -p /ora8/m02/oradata/ora8/
root:~# chown <span class="emphasis"><em><span class="replaceable">service0</span></em></span>.web /ora8/m02/oradata/ora8
root:~# chmod 775 /ora8/m02/oradata/ora8
root:~# exit
<span class="replaceable">service0</span>:~$</pre></li><li><p> 

		  Create a tablespace for the service. It is important that the
		  tablespace can <tt>autoextend</tt>. This
		  allows the tablespace's storage capacity to grow as the size
		  of the data grows. We set the pctincrease to be a very low value
		  so that our extents won't grow geometrically. We do not set
		  it to 0 at the tablespace level because this would affect
		  Oracle's ability to automatically coalesce free space in the
		  tablespace.

		</p><pre class="programlisting">
<span class="replaceable">service0</span>:~$ svrmgrl

SVRMGR&gt; connect internal;
SVRMGR&gt; create tablespace <span class="emphasis"><em><span class="replaceable">service0</span></em></span> 
             datafile '/ora8/m02/oradata/ora8/<span class="emphasis"><em><span class="replaceable">service0</span></em></span>01.dbf' 
             size 50M 
             autoextend on 
             next 10M
             maxsize 300M
             extent management local
             uniform size 32K;</pre></li><li><p> 
		  Create a database user for this service. Give the
		  user access to the tablespace and rights to connect. We'll use
		  <tt><span class="replaceable">service0</span>password</tt> as our password.</p><p>
		  Write down what you specify as <span class="emphasis"><em>service_name</em></span>
			(i.e. <tt><span class="replaceable">service0</span></tt>) and
			<span class="emphasis"><em>database_password</em></span>
			(i.e. <tt><span class="replaceable">service0</span>password</tt>). You
			will need this information for configuring exports and
			AOLserver.
		</p><pre class="programlisting">
SVRMGR&gt; create user <span class="emphasis"><em><span class="replaceable">service0</span></em></span> identified by <span class="emphasis"><em><span class="replaceable">service0</span>password</em></span> default tablespace <span class="emphasis"><em><span class="replaceable">service0</span></em></span>
temporary tablespace temp quota unlimited on <span class="emphasis"><em><span class="replaceable">service0</span></em></span>;
SVRMGR&gt; grant connect, resource, ctxapp, javasyspriv, query rewrite to <span class="emphasis"><em><span class="replaceable">service0</span></em></span>;
SVRMGR&gt; revoke unlimited tablespace from <span class="emphasis"><em><span class="replaceable">service0</span></em></span>;
SVRMGR&gt; alter user <span class="emphasis"><em><span class="replaceable">service0</span></em></span> quota unlimited on <span class="emphasis"><em><span class="replaceable">service0</span></em></span>;
SVRMGR&gt; exit;</pre><p>
		  Your table space is now ready. In case you are trying to delete a
		  previous OpenACS installation, consult these commands in <a href="database-management.html#install-openacs-delete-tablespace" title="Deleting a tablespace">the section called &#8220;Deleting a tablespace&#8221;</a> below.
		</p></li><li><p>
        Make sure that you can login to Oracle using your
        <span class="emphasis"><em>service_name</em></span> account: </p><pre class="programlisting">
<span class="replaceable">service0</span>:~$ sqlplus <span class="emphasis"><em><span class="replaceable">service0</span></em></span>/<span class="emphasis"><em><span class="replaceable">service0</span>password</em></span>
SQL&gt; select sysdate from dual;

SYSDATE
----------
2001-12-20

SQL&gt; exit</pre><p>
		  You should see today's date in a format 'YYYY-MM-DD.'
		  If you can't login, try redoing step 1 again. If the date is
		  in the wrong format, make sure you followed the steps outlined in
		  <a href="oracle.html#install-oracle-troubleshooting" title="Troubleshooting Oracle Dates">the section called &#8220;Troubleshooting Oracle Dates&#8221;</a>
		  </p></li></ol></div></div><div class="sect2" lang="en"><div class="titlepage"><div><h3 class="title"><a name="install-openacs-prepare-postgres"></a>Prepare PostgreSQL for an OpenACS Service</h3></div></div><div class="orderedlist"><ol type="1"><li><p>Create a user in the database matching the service name.</p><pre class="screen">[root@yourserver root]# <b><tt>su - postgres</tt></b>
[postgres@yourserver pgsql]$ <b><tt>createuser <span class="replaceable">service0</span></tt></b>
Shall the new user be allowed to create databases? (y/n) <b><tt>y</tt></b>
Shall the new user be allowed to create more new users? (y/n) <b><tt>y</tt></b>
CREATE USER
[postgres@yourserver pgsql]$ <b><tt>exit</tt></b>
logout

[root@yourserver root]#</pre></li><li><p>Create a database with the same name as our service name, <span class="replaceable">service0</span>.</p><pre class="screen">[root@yourserver root]# <b><tt>su - <span class="replaceable">service0</span></tt></b>
[service0@yourserver service0]$ <b><tt>createdb <span class="replaceable">service0</span></tt></b>
CREATE DATABASE
[service0@yourserver service0]$
<pre class="action">su - <span class="replaceable">service0</span>
createdb <span class="replaceable">service0</span></pre></pre></li><li><p>Automate daily database Vacuuming.  This is a process which cleans out discarded data from the database.  A quick way to automate vacuuming is to edit the cron file for the database user.</p><a class="indexterm" name="id2897951"></a><pre class="screen">[service0@yourserver service0]$ <b><tt>export EDITOR=emacs;crontab -e</tt></b></pre><p>Add this line to the file.  The numbers and stars at the beginning are cron columns that specify when the program should be run - in this case, whenever the minute is 0 and the hour is 1, i.e., 1:00 am every day.</p><pre class="programlisting">0 1 * * * /usr/local/pgsql/bin/vacuumdb <span class="replaceable">service0</span></pre></li><li><p><a name="install-next-openfts"></a>Add Full Text Search Support - OPTIONAL</p><a class="indexterm" name="id2898010"></a><p>If you are installing Full Text Search, add required packages to the new database.</p><pre class="screen">[service0@yourserver service0]$ <b><tt>/usr/local/pgsql/bin/psql <span class="replaceable">service0</span> -f /usr/local/src/postgresql-7.2.3/contrib/tsearch/tsearch.sql</tt></b>
BEGIN
CREATE
<span class="emphasis"><em>(many lines omitted)</em></span>
INSERT 0 1
COMMIT
[service0@yourserver service0]$ <b><tt>/usr/local/pgsql/bin/psql <span class="replaceable">service0</span> -f /usr/local/src/postgresql-7.2.3/contrib/pgsql_contrib_openfts/openfts.sql</tt></b>
CREATE
CREATE
[service0@yourserver service0]$
<pre class="action">/usr/local/pgsql/bin/psql <span class="replaceable">service0</span> -f /usr/local/src/postgresql-7.2.3/contrib/tsearch/tsearch.sql
/usr/local/pgsql/bin/psql <span class="replaceable">service0</span> -f /usr/local/src/postgresql-7.2.3/contrib/pgsql_contrib_openfts/openfts.sql</pre></pre></li><li><pre class="screen">[service0@yourserver service0]$ <b><tt>exit</tt></b>
logout

[root@yourserver root]# </pre></li></ol></div></div><div class="sect2" lang="en"><div class="titlepage"><div><h3 class="title"><a name="install-openacs-configure-aol"></a>Configure an AOLserver Service for OpenACS</h3></div></div><div class="orderedlist"><ol type="1"><li><p>
	  The AOLserver architecture lets you run an arbitrary number of
	  virtual servers. A virtual server is an HTTP service running on a
	  specific port, e.g. port 80. In order for OpenACS to work, you
	  need to configure a virtual server.  The Reference Platform uses a configuration file included in the OpenACS tarball.  Copy it to the <tt>/web/<span class="replaceable">service0</span>/etc</tt> directory and open it in an editor to adjust the parameters.</p><a class="indexterm" name="id2898154"></a><pre class="screen">[root@yourserver root]# <b><tt>su - <span class="replaceable">service0</span></tt></b>
[service0@yourserver service0]$ <b><tt>cd /web/<span class="replaceable">service0</span>/etc</tt></b>
[service0@yourserver etc]# <b><tt>cp /web/<span class="replaceable">service0</span>/packages/acs-core-docs/www/files/config.tcl.txt config.tcl</tt></b>
[service0@yourserver etc]# <b><tt>emacs config.tcl</tt></b>
</pre><p>
	   You can continue without changing any values in the file.  However, if you don't change <tt>address</tt> to match the computer's ip address, you won't be able to browse to your server from other machines.
	</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>httpport</em></span> - If you want your
		  server on a different port, enter it here.  The Reference Platform port is 8000, which is suitable for development use.  Port 80 is the standard http port - it's the port used by your browser when you enter http://yourserver.test.  So you should use port 80 for your production site.</p></li><li><p><span class="emphasis"><em>httpsport</em></span> - This is the
      port for https requests.  The Reference Platform https port is
      8443.  If http port is set to 80, httpsport should be 143 to
      match the standard.</p></li><li><p> 
		  <span class="emphasis"><em>address</em></span> - The IP address of the server.  If you are hosting multiple IPs on one computer, this is the address specific to the web site.  Each virtual server will ignore any requests directed at other addresses.</p></li><li><p><span class="emphasis"><em>server</em></span> - This is the keyword that, by convention, identifies the service.  It is also used as part of the path for the service root, as the name of the user for running the service, as the name of the database, and in various dependent places.  The Reference Platform uses <span class="replaceable">service0</span>.
      
    </p></li><li><p><span class="emphasis"><em>db_name</em></span> - In almost all cases,
		  this can be kept as a reference to $server. If for some reason,
		  the tablespace you are using is different than your servername,
		  then you can set it here. You should have a good reason for doing
		  this. 
		</p></li><li><p> 
		  <span class="emphasis"><em>servername</em></span> - This is just a *pretty* name for your server.</p></li><li><p><span class="emphasis"><em>user_account</em></span> - The account that
        will both own OpenACS files and connect to the database (for
        Postgresql).</p></li><li><p><span class="emphasis"><em>debug</em></span> - Set to true for a very verbose error log, including many lines for every page view, success or failure.</p></li></ul></div><p>
	  AOLServer is very configurable. These settings should get you
	  started, but for more options, read the <a href="http://aolserver.com/docs/admin/config.adp" target="_top">AOLServer
	  docs</a>.
	</p></li><li><p>OPTIONAL: To run OpenFTS, uncomment this line from <tt>config.tcl</tt>.  (To uncomment a line in a tcl file, remove the <tt>#</tt> at the beginning of the line.)</p><pre class="programlisting">#ns_param   nsfts           ${bindir}/nsfts.so</pre></li><li><p>OPTIONAL: To run nsopenssl:</p><div class="orderedlist"><ol type="a"><li><p>Uncomment this line from <tt>config.tcl</tt>.</p><pre class="programlisting">#ns_param   nsopenssl       ${bindir}/nsopenssl.so
</pre></li><li><p><a name="ssl-certificates"></a>Prepare a certificate directory for the service.</p><pre class="screen">[service0@yourserver etc]$ <b><tt>mkdir /web/<span class="replaceable">service0</span>/etc/certs</tt></b>
[service0@yourserver etc]$ <b><tt>chmod 700 /web/<span class="replaceable">service0</span>/etc/certs</tt></b>
[service0@yourserver etc]$ 
<pre class="action">mkdir /web/<span class="replaceable">service0</span>/etc/certs
chmod 700 /web/<span class="replaceable">service0</span>/etc/certs</pre></pre></li><li><p>It takes two files to support an SSL connection.  The certificate is the public half of the key pair - the server sends the certificate to browser requesting ssl.  The key is the private half of the key pair.  In addition, the certificate must be signed by Certificate Authority or browsers will protest.  Each web browser ships with a built-in list of acceptable Certificate Authorities (CAs) and their keys.  Only a site certificate signed by a known and approved CA will work smoothly.  Any other certificate will cause browsers to produce some messages or block the site.  Unfortunately, getting a site certificate signed by a CA costs money.  In this section, we'll generate an unsigned certificate which will work in most browsers, albeit with pop-up messages.</p><p>Use an OpenSSL perl script to generate a certificate and key.</p><pre class="screen">[service0@yourserver service0]$ <b><tt>cd /web/service0/etc/certs</tt></b>
[service0@yourserver certs]$ <b><tt>perl /usr/share/ssl/misc/CA -newcert</tt></b>
Using configuration from /usr/share/ssl/openssl.cnf
Generating a 1024 bit RSA private key
...++++++
.......++++++
writing new private key to 'newreq.pem'
Enter PEM pass phrase:</pre><p>Enter a pass phrase for the CA certificate.  Then, answer the rest of the questions.  At the end you should see this:</p><pre class="screen">Certificate (and private key) is in newreq.pem
[service0@yourserver certs]$</pre><p><tt>newreq.pem</tt> contains our certificate and private key.  The key is protected by a passphrase, which means that we'll have to enter the pass phrase each time the server starts.  This is impractical and unnecessary, so we create an unprotected version of the key.  <span class="emphasis"><em>Security implication</em></span>: if anyone gets access to the file keyfile.pem, they effectively own the key as much as you do.  Mitigation: don't use this key/cert combo for anything besides providing ssl for the web site.</p><pre class="screen">[root@yourserver misc]# <b><tt>openssl rsa -in newreq.pem -out keyfile.pem</tt></b>
read RSA key
Enter PEM pass phrase:
writing RSA key
[service0@yourserver certs]$ </pre><p>To create the certificate file, we take the combined file, copy it, and strip out the key.</p><pre class="screen">[service0@yourserver certs]$ <b><tt>cp newreq.pem certfile.pem</tt></b>
[root@yourserver misc]# <b><tt>emacs certfile.pem</tt></b></pre><p>Strip out the section that looks like</p><pre class="programlisting">-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: DES-EDE3-CBC,F3EDE7CA1B404997
S/Sd2MYA0JVmQuIt5bYowXR1KYKDka1d3DUgtoVTiFepIRUrMkZlCli08mWVjE6T
<span class="emphasis"><em>(11 lines omitted)</em></span>
1MU24SHLgdTfDJprEdxZOnxajnbxL420xNVc5RRXlJA8Xxhx/HBKTw==
-----END RSA PRIVATE KEY-----</pre></li></ol></div></li></ol></div></div><div class="sect2" lang="en"><div class="titlepage"><div><h3 class="title"><a name="id2898655"></a>Verify AOLserver startup</h3></div></div><div class="orderedlist"><ol type="1"><li><p>
	  Kill any current running AOLserver processes and start a new
	  one. (Note, if you are using Oracle, rather than PostgreSQL, replace
	  <tt>nsd-postgres</tt> with
	  <tt>nsd-oracle</tt>).  If you are using port 80, you must be root for this step. </p><pre class="screen">[service0@yourserver etc]$ <b><tt>killall nsd</tt></b>
nsd: no process killed
[service0@yourserver service0]$<b><tt> /usr/local/aolserver/bin/nsd-postgres -t /web/<span class="replaceable">service0</span>/etc/config.tcl</tt></b>
[service0@yourserver service0]$ [08/Mar/2003:18:13:29][32131.8192][-main-] Notice: nsd.tcl: starting to read config file...
[08/Mar/2003:18:13:29][32131.8192][-main-] Notice: nsd.tcl: finished reading config file.</pre></li><li><p>
	  Attempt to connect to the service from a web browser as you did
	  You should specify a URL like:
	</p><tt>http://<span class="replaceable">yourserver.test</span>:8000</tt><p>
	  You should see a page that looks like <a href="files/openacs-start.html" target="_top">this</a>.  If you <a href="openacs.html#cvs-service-import">imported your files into
        cvs</a>, now that you know it worked you can erase the temp
        directory with <tt>rm -rf /web/service0.orig</tt>.
	</p><p>

	  If you don't see the login page, view your error log
	  (<tt>/web/<span class="replaceable">service0</span>/log/<span class="replaceable">service0</span>-error.log</tt>)
	  to make sure the service is starting without any problems. If you
	  need to make changes, don't forget to kill any running servers with <b><tt>killall nsd</tt></b>.

	</p></li><li><p><a name="install-openacs-keepalive"></a>OPTIONAL - Automate AOLserver keepalive</p><p>Assuming AOLserver started cleanly in the previous step, we'll set it up so that it's always running, and automatically restarts whenever it dies or is stopped.  This step is strongly recommended, even for development sites, because it makes install and maintenance much simpler.  </p><p>The Reference Platform uses Daemontools to control AOLserver.  A simpler method, using <tt>init</tt>, is <a href="maintenance-web.html#install-openacs-inittab" title="AOLserver keepalive with inittab">here</a>.</p><div class="orderedlist"><ol type="a"><li><p>Daemontools must already be installed.  If not, <a href="linux-installation.html#install-daemontools" title="Install Daemontools (OPTIONAL)">install it</a>.</p></li><li><p>Each service controlled by daemontools must have a directory in <tt>/service</tt>.  That directory must have a file called <tt>run</tt>.  Daemontools then creates additional files and directories to track status and log.  Create the appropriate directory as <tt>/web/<span class="replaceable">service0</span>/etc/daemontools</tt>, copy the prepared <tt>run</tt> file, and set permissions.  If your server is not called <span class="replaceable">service0</span>, edit <tt>/web/<span class="replaceable">service0</span>/etc/run accordingly.</tt></p><pre class="screen">[service0@yourserver log]$ <b><tt>cd /web/<span class="replaceable">service0</span>/etc</tt></b>
[service0@yourserver etc]$ <b><tt>mkdir daemontools</tt></b>
[service0@yourserver etc]$ <b><tt>cp /web/<span class="replaceable">service0</span>/packages/acs-core-docs/www/files/run.txt daemontools/run</tt></b>
[service0@yourserver etc]$ <b><tt>chmod 700 daemontools/run</tt></b>
<pre class="action">cd /web/<span class="replaceable">service0</span>/etc
mkdir daemontools
cp /web/<span class="replaceable">service0</span>/packages/acs-core-docs/www/files/run.txt daemontools/run
chmod 700 daemontools/run</pre></pre></li><li><p>Kill any existing AOLserver instances.  As root, link the <tt>daemontools</tt> directory into the <tt>/service</tt> directory.  Daemontools' <tt>svscan</tt> process checks this directory every five seconds, and will quickly execute <tt>run</tt>.</p><pre class="screen">[service0@yourserver etc]$ <b><tt>killall nsd</tt></b>
nsd: no process killed
[service0@yourserver etc]$ <b><tt>exit</tt></b>

[root@yourserver root]# <b><tt>ln -s /web/<span class="replaceable">service0</span>/etc/daemontools/ /service/<span class="replaceable">service0</span></tt></b></pre><p>Verify that AOLserver is running.</p><pre class="screen">[root@yourserver root]#<b><tt> ps -auxw | grep nsd</tt></b>
<span class="replaceable">service0</span>   5562 14.2  6.2 22436 15952 ?       S    11:55   0:04 /usr/local/aolserver/bin/nsd -it /web/<span class="replaceable">service0</span>/etc/config.tcl -u serve
root      5582  0.0  0.2  3276  628 pts/0    S    11:55   0:00 grep nsd
[root@yourserver root]#</pre></li><li><p>The user <span class="replaceable">service0</span> can now control the service <span class="replaceable">service0</span> with these commands:</p><div class="itemizedlist"><ul type="disc"><li><p>

            <tt>svc -d /service/<span class="replaceable">service0</span></tt> -
            Bring the server down

          </p></li><li><p>

            <tt>svc -u /service/<span class="replaceable">service0</span></tt> -
            Start the server up and leave it in keepalive mode.

          </p></li><li><p>

            <tt>svc -o /service/<span class="replaceable">service0</span></tt> -
            Start the server up once. Do not restart it if it stops.

          </p></li><li><p>

            <tt>svc -t /service/<span class="replaceable">service0</span></tt> -
            Stop and immediately restart the server.

          </p></li><li><p>
        
            <tt>svc -k /service/<span class="replaceable">service0</span></tt> -
            Sends the server a KILL signal. This is like KILL -9. AOLserver
            exits immediately. If svc -t fails to fully kill AOLserver, use
            this option.  This does not take the server out of keepalive mode, so it should still bounce back up immediately.

          </p></li></ul></div></li><li><p>
        At this point, these commands will work only for the
        <tt>root</tt> user.  Grant permission for the <tt>web</tt> group to use <tt>svc</tt> commands on the <span class="emphasis"><em><span class="replaceable">service0</span></em></span> server.</p><pre class="screen">[root@yourserver root]# <b><tt>svgroup web /service/<span class="replaceable">service0</span></tt></b>
[root@yourserver root]#</pre></li><li><p>Verify that the controls work.  You may want to <tt>tail -f /web/<span class="replaceable">service0</span>/log/<span class="replaceable">service0</span>-error.log</tt> in another window, so you can see what happens when you type these commands.
      </p><p>

        Most of this information comes from Tom Jackson's <a href="http://zmbh.com/daemontools-aolserver/aolserver%2Bdaemontools.html" target="_top">AOLServer+Daemontools
          Mini-HOWTO</a>.
</p></li></ol></div></li></ol></div></div><div class="sect2" lang="en"><div class="titlepage"><div><h3 class="title"><a name="install-openacs-using-installer"></a>Configure a Service with the OpenACS Installer</h3></div></div><p>
	  Now that you've got AOLserver up and running, let's install OpenACS
	  4.6.2.
	</p><div class="itemizedlist"><ul type="disc"><li><p> 
		  You should see a page from the webserver titled
		  <tt>OpenACS Installation:
		  Welcome</tt>. You will be warned if your version of
		  the database driver is out of date, if AOLserver cannot connect
		  to the database, if any modules are missing or out-of-date, or if
		  there are any problems with filesystem permissions on the server
		  side. But if everything is fine, you can click
		  <tt>Next</tt> to proceed to load the
		  OpenACS Kernel data model.  
		</p></li><li><p>

		  The next page shows the results of loading the OpenACS Kernel
		  data model - be prepared to wait a few minutes as it works. You
		  should see a string of output messages from the database as the
		  datamodel is created.  You'll see the line:

		</p><pre class="programlisting">
Loading package .info files ... this will take a few minutes</pre><p>

		  This will really take a few minutes. Have faith! Finally, another
		  <tt>Next</tt> button will appear at the
		  bottom - click it.

		</p></li><li><p> 		  

		  The following page shows the results of loading the core package
		  data models. You should see positive results for each of the
		  previously selected packages, but watch out for any
		  errors. Eventually, the page will display &quot;Generating secret
		  tokens&quot; and then &quot;Done&quot;- click
		  <tt>Next</tt>.

		</p></li><li><p>

		  You should see a page, &quot;OpenACS Installation: Create
		  Administrator&quot; with form fields to define the OpenACS site
		  administrator. Fill out the fields as appropriate, and click
		  <tt>Create User</tt>.

		</p></li><li><p>
		  You should see a page, &quot;OpenACS Installation: Set System
		  Information&quot; allowing you to name your service. Fill out the
		  fields as appropriate, and click <tt>Set System
		  Information</tt> 
		</p></li><li><p> 
		  You'll see the final Installer page, &quot;OpenACS
		  Installation: Complete.&quot; It will tell you that the server is
		  being restarted; note that unless you already set up a way for
		  AOLServer to restart itself (ie. inittab or daemontools),
		  you'll need to manually restart your service.
		</p><pre class="screen">[service0@yourserver service0]$ <b><tt>/usr/local/aolserver/bin/nsd-postgres -t /web/<span class="emphasis"><em><span class="replaceable">service0</span></em></span>/config.tcl</tt></b></pre></li><li><p> 
		  Give the server a few minutes to start up. Then
		  reload the final page above. You should see the front page, with
		  an area to login near the upper right.  Congratulations, OpenACS
		  4.6.2 is now up and running!  
		</p></li><li><p>OPTIONAL - Install Full Text Search.</p><div class="orderedlist"><ol type="1"><li><p>Click <tt><span class="guilabel">Package Manager</span></tt> on the right side of the default home page.  If prompted, log in with the account and password you entered during install.</p></li><li><p>Click on the <tt><span class="guilabel">Install
packages</span></tt> link.</p></li><li><p>On the next screen, after it loads, click on <tt><span class="guilabel">Uncheck all boxes</span></tt>, then click the second checkbox next to <tt><span class="guilabel">OpenFTS Driver 4.2</span></tt>.  This will automatically check the first box. Then click <tt><span class="guibutton"><u>N</u>ext</span></tt>. </p></li><li><p>Click <tt><span class="guibutton">Install Packages</span></tt></p></li><li><p>Restart the service.</p><pre class="screen">[service0@yourserver service0]$ <b><tt>svc -t /service/<span class="replaceable">service0</span></tt></b>
[service0@yourserver service0]$</pre></li><li><p>Wait a minute, then browse back to the home page.</p></li><li><p>Click on <tt><span class="guilabel">Site Map</span></tt> on the top right side of the screen.</p></li><li><p>Mount the OpenFTS Full Text Search Engine in the site map.</p><div class="orderedlist"><ol type="a"><li><p>Click the <tt><span class="guilabel">new sub folder</span></tt> link on the &quot;/&quot; line, the first line under Main Site:/.</p></li><li><p>Type <b><tt>openfts</tt></b>
and click <tt><span class="guibutton">New</span></tt>.</p></li><li><p>On the new <tt><span class="guilabel">openfts</span></tt> line, click the <tt><span class="guilabel">mount</span></tt> link.</p></li><li><p>Click <tt><span class="guilabel">OpenFTS
Driver</span></tt>.</p></li><li><p>On the <tt><span class="guilabel">openfts</span></tt> line, click <tt><span class="guilabel">set parameters</span></tt>.</p></li><li><p>Change <tt><span class="guilabel">openfts_tcl_src_path</span></tt> to <b><tt>/usr/local/src/Search-OpenFTS-tcl-0.3.2/</tt></b> and click <tt><span class="guibutton">Set Parameters</span></tt>
              </p></li></ol></div></li><li><p>Mount the Search interface in the site map.</p><div class="orderedlist"><ol type="a"><li><p>Click the
<tt><span class="guilabel">new sub folder</span></tt> link on the
Main Site line. </p></li><li><p>Type <b><tt>search</tt></b>
and click <tt><span class="guibutton">New</span></tt>. </p></li><li><p>Click the <tt><span class="guilabel">new
application</span></tt> link on the <tt><span class="guilabel">search</span></tt>
	  line. </p></li><li><p>Type <b><tt>search</tt></b>
where it says
<tt><span class="guilabel">untitled</span></tt>, choose
<tt><span class="guilabel">search</span></tt> from the
drop-down list, and click
<tt><span class="guibutton">New</span></tt>.
</p></li></ol></div></li><li><p>Restart the service.</p><pre class="screen">[service0@yourserver service0]$ <b><tt>svc -t /service/<span class="replaceable">service0</span></tt></b>
[service0@yourserver service0]$</pre></li><li><p>Wait a minute, then click on <tt><span class="guilabel">Main Site</span></tt> at the top of the page.</p></li><li><p>Initialize the OpenFTS Engine.  This creates a set of tables in the database to support FTS.</p><p>Near the bottom of the page, click on the <tt><span class="guilabel">OpenFTS Driver</span></tt> link. Click on <tt><span class="guilabel">Administration</span></tt>.
Click on <tt><span class="guilabel">Initialize OpenFTS Engine</span></tt>. 
Click <tt><span class="guibutton">Initialize OpenFTS Engine</span></tt>. </p></li><li><p>Add the FTS Engine service contract</p><div class="orderedlist"><ol type="a"><li><p>Click on the <tt><span class="guilabel">Main
Site</span></tt>. </p></li><li><p>Click on the <tt><span class="guilabel">ACS
Service Contract</span></tt> link near the bottom of the home page. </p></li><li><p>On the <tt><span class="guilabel">FtsEngineDriver</span></tt>
line, click
<tt><span class="guilabel">Install</span></tt>.
</p></li></ol></div></li><li><p>Restart the service.</p><pre class="screen">[service0@yourserver service0]$ <b><tt>svc -t /service/<span class="replaceable">service0</span></tt></b>
[service0@yourserver service0]$</pre></li><li><p>Test FTS.  (INCOMPLETE).  Add a package that supports search,like &quot;note,&quot; add some content, and search for it.</p></li></ol></div></li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><h3 class="title"><a name="id2900182"></a>Back up the New Service - OPTIONAL</h3></div></div><p>This is a very good time to back the service, even if it's not a production service.  Making a backup now lets you roll back to this initial, clean setup at any point in the future, without repeating the install process.  A full OpenACS service backup includes everything in the <tt>/web/<span class="replaceable">service0</span>/</tt> directory.  At this point it's probably sufficient to back up just the database, because you can recover the files from a tarball.</p><p>Note that, if you did the CVS options in this document, the <tt>/web/service0/etc</tt> directory is not included in cvs and you may want to add it.</p><div class="itemizedlist"><ul type="disc"><li><p><b>PostGreSQL. </b>Create a backup file and verify that it was created and has a reasonable size (several megabytes).</p><pre class="screen">[service0@yourserver service0]$ <b><tt>mkdir /web/<span class="replaceable">service0</span>/database-backup</tt></b>
[service0@yourserver service0]$ <b><tt>pg_dump -f /web/<span class="replaceable">service0</span>/database-backup/initial_backup.dmp <span class="replaceable">service0</span></tt></b>
[service0@yourserver service0]$ <b><tt>ls -al /web/<span class="replaceable">service0</span>/database-backup</tt></b>
total 1425
drwxr-xr-x    2 <span class="replaceable">service0</span>  web          1024 Mar  9 14:13 .
drwx------   11 <span class="replaceable">service0</span>  web          1024 Mar  9 14:11 ..
-rw-r--r--    1 <span class="replaceable">service0</span>  web       1449826 Mar  9 14:13 initial_backup.dmp
[service0@yourserver service0]$
<pre class="action">mkdir /web/<span class="replaceable">service0</span>/database-backup
pg_dump -f /web/<span class="replaceable">service0</span>/database-backup/initial_backup.dmp <span class="replaceable">service0</span>
ls -al /web/<span class="replaceable">service0</span>/database-backup</pre></pre></li><li><p><b>Oracle - INCOMPLETE. </b></p></li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><h3 class="title"><a name="id2900349"></a>Set up Automated Backup - OPTIONAL</h3></div></div><p>Backup can encompass all files in <tt>/web/service0</tt>.  For a development server, putting the files in cvs is sufficient.  (It's important then to back up the cvs repository!)</p><p>A quick way to automate database backup is a cron job.  This is not recommended for production and is not part of the Reference Platform, because it is not cross-platform and can fail silently.  More thorough methods are documented in <a href="backup-recovery.html#install-next-backups" title="Backup Strategy">the section called &#8220;Backup Strategy&#8221;</a></p><pre class="screen">[service0@yourserver service0]$ <b><tt>export EDITOR=emacs;crontab -e</tt></b></pre><p>Add this line to the file.  The numbers and stars at the beginning are cron columns that specify when the program should be run - in this case, whenever the minute is 0 and the hour is 1, i.e., 1:00 am every day.</p><pre class="programlisting">0 1 * * * /usr/local/pgsql/bin/pg_dump -f /web/service0/database-backup/service0_$(date +%Y-%m-%d).dmp service0</pre><p>If you plan to back up the whole <tt>/web/<span class="replaceable">service0</span></tt> directory, then it would be redundant to keep a history of database backups.  In that case, set up the cron job to overwrite the previous backup each time:</p><pre class="programlisting">0 1 * * * /usr/local/pgsql/bin/pg_dump -f /web/service0/database-backup/service0_nightly.dmp service0</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><h3 class="title"><a name="id2900441"></a>Set up Log Analysis Reports - OPTIONAL</h3></div></div><p>Analog is a program with processes webserver access logs,
      performs DNS lookup, and outputs HTML reports.  Analog should
      <a href="aolserver.html#analog-install">already be
      installed.</a>  A modified configuration file is included in
      the OpenACS tarball.</p><div class="orderedlist"><ol type="1"><li><pre class="screen">[root@yourserver src]# <b><tt>su - service0</tt></b>
[service0@yourserver service0]$ <b><tt>cd /web/service0</tt></b>
[service0@yourserver service0]$ <b><tt>cp /web/service0/packages/acs-core-docs/www/files/analog.cfg.txt etc/analog.cfg</tt></b>
[service0@yourserver service0]$ <b><tt>mkdir www/log</tt></b>
[service0@yourserver service0]$ <b><tt>cp -r /usr/share/analog-5.31/images www/log/</tt></b>
[service0@yourserver service0]$ <pre class="action">
su - service0
cd /web/service0
cp /web/service0/packages/acs-core-docs/www/files/analog.cfg.txt etc/analog.cfg
mkdir www/log
cp -r /usr/share/analog-5.31/images www/log/</pre></pre><p>Edit
<tt>/web/service0/etc/analog.cfg</tt> and change the variable in <tt>HOSTNAME &quot;[my
organisation]&quot;</tt> to reflect your website title.  If you
don't want the traffic log to be publicly visible, change
<tt>OUTFILE /web/service0/www/log/traffic.html</tt> to use a private
directory.</p></li><li><p>Run it.</p><pre class="screen">[service0@yourserver service0]$ <b><tt>/usr/share/analog-5.31/analog -G -g/web/service0/etc/analog.cfg</tt></b>
/usr/share/analog-5.31/analog: analog version 5.31/Unix
/usr/share/analog-5.31/analog: Warning F: Failed to open DNS input file
  /home/service0/dnscache: ignoring it
  (For help on all errors and warnings, see docs/errors.html)
/usr/share/analog-5.31/analog: Warning R: Turning off empty Search Word Report
[service0@yourserver service0]$</pre><p>Verify that it works by browing to <tt>http://yourserver.test:8000/log/traffic.html</tt></p></li><li><p>Automate this by creating a file in
          <tt>/etc/cron.daily</tt>.</p><pre class="screen">[service0@yourserver service0]$ <b><tt>exit</tt></b>
logout

[root@yourserver root]# <b><tt>emacs /etc/cron.daily/analog</tt></b></pre><p>Put this into the file:</p><pre class="programlisting">#!/bin/sh

/usr/share/analog-5.31/analog -G -g/web/<span class="replaceable">service0</span>/etc/analog.cfg</pre><pre class="screen">[root@yourserver root]# <b><tt>chmod 755 /etc/cron.daily/analog</tt></b></pre><p>Test it by running the script.</p><pre class="screen">[root@yourserver root]# <b><tt>sh /etc/cron.daily/analog</tt></b></pre><p>Browse to <tt>http://<span class="replaceable">yourserver.test</span>/log/traffic.html</tt></p></li></ol></div></div><div class="sect2" lang="en"><div class="titlepage"><div><h3 class="title"><a name="id2900702"></a>Next Steps</h3></div></div><div class="itemizedlist"><ul type="disc"><li><p>Test your <a href="backup-recovery.html" title="Backup and Recovery">backup and recovery</a> procedure.</p></li><li><p>Follow the instruction on the home page to change the appearance of your service or add more packages.</p></li><li><p>Proceed to the <a href="tutorial.html" title="Chapter 8. Development Tutorial">tutorial</a> to learn how to develop your own packages.</p></li></ul></div></div><div class="cvstag">($Id$)</div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="aolserver.html">Prev</a> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right"> <a accesskey="n" href="credits.html">Next</a></td></tr><tr><td width="40%" align="left">Install AOLserver 3.3+ad13 </td><td width="20%" align="center"><a accesskey="u" href="unix-install.html">Up</a></td><td width="40%" align="right"> Credits</td></tr></table><hr><address>rmello at fslc.usu.edu</address><address><a href="mailto:vinod@kurup.com">vinod@kurup.com</a></address></div><a name="comments"></a><center><a href="http://openacs.org/doc/openacs-4/openacs.html#comments">View comments on this page at openacs.org</a></center></body></html>
