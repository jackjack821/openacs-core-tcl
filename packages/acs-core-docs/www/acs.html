<html xmlns:lxslt="http://xml.apache.org/xslt" xmlns:saxon="http://icl.com/saxon" xmlns:xalanredirect="org.apache.xalan.xslt.extensions.Redirect"><head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>7. Installing the ArsDigita Community System v 4.0</title><link rel="stylesheet" href="ad.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.24"><link rel="home" href="index.html" title="ACS Core"><link rel="up" href="unix-install.html" title="2. Installing on Unix/Linux"><link rel="previous" href="aolserver.html" title="6. Installing AOlserver 3.1"><link rel="next" href="tests.html" title="8. Acceptance Tests"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><a href="http://www.openacs.org/"><img src="images/alex.jpg" border="0" ></a><br><br><a class="topnav" href="/">Home</a><span class="topnav"> : </span><a class="topnav" href="index">Documentation</a><span class="topnav"> : </span><a class="topnav" href="acs-admin.html">Part II. For ACS Admins</a><span class="topnav"> : </span><a class="topnav" href="unix-install.html">2. Installing on Unix/Linux</a><span class="topnav"> : </span><strong class="topnav">7. Installing the ArsDigita Community System v 4.0&nbsp;</strong><hr size="1" noshade><div id="acs" class="sect1"><div class="titlepage"><h2 class="title" style="clear: all"><a name="acs"></a><span class="label">7.</span> <span class="title">Installing the ArsDigita Community System v 4.0</span></h2></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt>7.1. <a href="acs.html#install-acs-download">Downloading the ACS</a></dt><dt>7.2. <a href="acs.html#install-acs-prepare-oracle">Prepare Oracle for ACS</a></dt><dt>7.3. <a href="acs.html#install-acs-configure-aol">Configuring AOLserver</a></dt><dt>7.4. <a href="acs.html#install-acs-using-installer">Using the ACS Installer</a></dt><dt>7.5. <a href="acs.html#install-acs-troubleshooting">Troubleshooting</a></dt><dt>7.6. <a href="acs.html#install-acs-keepalive">Ensure that Your Service Automatically Starts on Boot (or any other
    time the service dies)</a></dt><dt>7.7. <a href="acs.html#install-acs-transfer">How to Transfer Data</a></dt><dt>7.8. <a href="acs.html#install-acs-port80">Running AOLserver on Port 80</a></dt><dt>7.9. <a href="acs.html#install-acs-delete-tablespace">Deleting a tablespace</a></dt><dt>7.10. <a href="acs.html#install-acs-backup">Set Up Nightly Oracle Exports</a></dt></dl></div><div id="install-acs-download" class="sect2"><div class="titlepage"><h3 class="title"><a name="install-acs-download"></a><span class="label">7.1.</span> <span class="title">Downloading the ACS</span></h3></div><div class="itemizedlist"><ul><li><a name="N2923"></a><p>
        Download the following from the ArsDigita <a href="http://www.openacs.org/download/" target="_top">download</a> page to the
        <strong>/tmp</strong> directory: 

        </p><div class="itemizedlist"><ul><li><a name="N2934"></a><p>
            ArsDigita Community System v 4.0.

            
          </p></li></ul></div></li><li><a name="N2937"></a><p>
        Login as nsadmin and uncompress the downloaded components into
        <tt>/web</tt>. Substitute the correct file name into the line
        below. Tip: If you type <tt>acs-</tt> and then press the
        <strong>TAB</strong> key, your shell should complete the file name
        for you. 

        
<blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
$ su - nsadmin
; Enter nsadmin's password.
$ cd /tmp
$ tar -xzvf acs-4.0.tar.gz --directory=/web

; Stay logged in as <strong>nsadmin</strong>.
   
</pre></td></tr></table></blockquote>
      </p></li><li><a name="N2958"></a><p>
        You should now have an <strong>acs/</strong> directory tree in
        <strong>/web</strong>. Rename this directory to whatever you want
        your web service to be identified as. The name of your web service is
        referred to as the <i>service_name</i>. This identification is used
        internally by AOLserver to differentiate your services from one
        another. A service name should be a single word, <i>letters and
        numbers only</i>. If the name of your site is one word, that would
        be a good choice. For example "arfdigita" is the service
        name for the <a href="http://arfdigita.org/" target="_top">ArfDigita.org</a>
        community. </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
$ cd /web
$ mv acs <i>service_name</i>
   
</pre></td></tr></table></blockquote></li></ul></div></div><div id="install-acs-prepare-oracle" class="sect2"><div class="titlepage"><h3 class="title"><a name="install-acs-prepare-oracle"></a><span class="label">7.2.</span> <span class="title">Prepare Oracle for ACS</span></h3></div><p>You should be logged on as <strong>nsadmin</strong> for this step and
    you should make sure that <strong>nsadmin</strong> is in the
    <strong>dba</strong> group.</p><div class="itemizedlist"><ul><li><a name="N2999"></a><p>
        Verify nsadmin membership by typing <strong>groups</strong> when you
        login: 
<blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
$ groups
nsadmin dba web
   
</pre></td></tr></table></blockquote>
        If you do not see these groups, take the following action: 
<blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
$ su -      # Enter root password
# usermod -g nsadmin -G dba,web nsadmin
   
</pre></td></tr></table></blockquote>
        If you get an error about an undefined group, then add that group
        manually: 
<blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
# groupadd dba
# groupadd nsadmin
# groupadd web
   
</pre></td></tr></table></blockquote>
        Make sure to logout as <tt>root</tt> when you are finished with
        this step and log back in as <tt>nsadmin</tt>. 

        
      </p></li><li><a name="N3025"></a><p>
        Connect to Oracle using <tt>svrmgrl</tt> and login:

        
<blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
$ svrmgrl

SVRMGR&gt; connect internal
Connected.
   
</pre></td></tr></table></blockquote>
      </p></li><li><a name="N3036"></a><p>
        Determine where the system tablespaces are stored: 
<blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
SVRMGR&gt;  select file_name from dba_data_files;
   
</pre></td></tr></table></blockquote>
        Example results: 
<blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
/ora8/m01/app/oracle/oradata/ora8/system01.dbf
/ora8/m01/app/oracle/oradata/ora8/tools01.dbf
/ora8/m01/app/oracle/oradata/ora8/rbs01.dbf
/ora8/m01/app/oracle/oradata/ora8/temp01.dbf
/ora8/m01/app/oracle/oradata/ora8/users01.dbf
/ora8/m01/app/oracle/oradata/ora8/indx01.dbf
/ora8/m01/app/oracle/oradata/ora8/drsys01.dbf
   
</pre></td></tr></table></blockquote>
      </p></li><li><a name="N3047"></a><p>
        Using the above output, you should determine where to store your
        tablespace. As a general rule, you'll want to store your
        tablespace on a mount point under the <tt>/ora8</tt> directory
        that is separate from the Oracle system data files. By default, the
        Oracle system is on <tt>m01</tt>, so we will use
        <tt>m02</tt>. This enables your Oracle system and database files
        to be on separate disks for optimized performance. For more
        information on such a configuration, see <a href="http://www.openacs.org/books/panda/databases-choosing" target="_top">Chapter
        12</a> of <a href="http://www.openacs.org/books/panda/" target="_top">Philip's book</a>.
        For this example, we'll use <tt>/ora8/m02/oradata/ora8/</tt>.
        

        
      </p></li><li><a name="N3074"></a><p>
        Create the directory for the datafile; to do this, exit from
        <tt>svrmgrl</tt> and login as <strong>root</strong> for this
        step: </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
SVRMGR&gt; exit
$ su -
; Enter root password.
# mkdir -p /ora8/m02/oradata/ora8/
# chown nsadmin.web /ora8/m02/oradata/ora8
# chmod 775 /ora8/m02/oradata/ora8
# exit
$
   
</pre></td></tr></table></blockquote></li><li><a name="N3087"></a><p>
        As <strong>nsadmin</strong>, create a tablespace for the service. It
        is important that the tablespace can <tt>autoextend</tt>. This
        allows the tablespace's storage capacity to grow as the size of
        the data grows. We set the pctincrease to be a very low value so that
        our extents won't grow geometrically. We do not set it to 0 at
        the tablespace level because this would affect Oracle's ability
        to automatically coalesce free space in the tablespace. </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
$ svrmgrl

SVRMGR&gt; connect internal;
SVRMGR&gt; create tablespace <i>service_name</i> datafile '/ora8/m02/oradata/ora8/<i>service_name</i>01.dbf' size 50m autoextend on default storage (pctincrease 1);
   
</pre></td></tr></table></blockquote></li><li><a name="N3106"></a><p>
        Create a database user for this service. Give the user access to the
        tablespace and rights to connect. (Substitute
        <tt>database_password</tt> with the appropriate password.)</p><p><strong>Write down what you specify as <i>service_name</i> and
        <i>database_password</i></strong>. You will need this information
        for configuring exports and AOLserver.</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
SVRMGR&gt; create user <i>service_name</i> identified by <i>database_password</i> default tablespace <i>service_name</i>
temporary tablespace temp quota unlimited on <i>service_name</i>;
SVRMGR&gt; grant connect, resource, ctxapp, javasyspriv, query rewrite to <i>service_name</i>;
SVRMGR&gt; revoke unlimited tablespace from <i>service_name</i>;
SVRMGR&gt; alter user <i>service_name</i> quota unlimited on <i>service_name</i>;
SVRMGR&gt; exit;
   
</pre></td></tr></table></blockquote><p>Your table space is now ready. In case you are trying to delete a
        previous ACS installation, consult these commands in <a href="acs.html#install-acs-delete-tablespace">Section 7.9.</a> below.
      </p></li><li><a name="N3154"></a><p>
        Make sure that you can login to Oracle using your
        <i>service_name</i> account: </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
$ sqlplus <i>service_name</i>/<i>database_password</i>
SQL&gt; select sysdate from dual;

SYSDATE
----------
2000-06-11

SQL&gt; exit
   
</pre></td></tr></table></blockquote><p>You should see today's date in a format 'YYYY-MM-DD.'
        If you can't login, try redoing step 1 again. If the date is in
        the wrong format, make sure you followed the steps outlined in the <a href="oracle.html#wrongdates" target="_top">Oracle documentation</a>.
      </p></li></ul></div></div><div id="install-acs-configure-aol" class="sect2"><div class="titlepage"><h3 class="title"><a name="install-acs-configure-aol"></a><span class="label">7.3.</span> <span class="title">Configuring AOLserver</span></h3></div><p>The AOLserver architecture lets you run an arbitrary number of virtual
    servers. A virtual server is an HTTP service running on a specific port,
    e.g. port 80. In order for the ACS to work, you need to configure a
    virtual server. Because the process is involved, we have prepared a
    sample virtual server configuration file.</p><div class="itemizedlist"><ul><li><a name="N3182"></a><p>
        Allot an IP address: You must know what IP address has been assigned
        to your web service. If you don't know, contact your system
        administrator and find out. If you do not have a network connection,
        use <tt>localhost 127.0.0.1</tt> Once you have installed a
        virtual server as described below, you should notify your sysadmin
        that you have claimed this IP. 

        
      </p></li><li><a name="N3189"></a><p>
        Save the template configuration file <a href="files/template-ini.ini" target="_top">template-ini.ini</a> into
        <strong>/tmp</strong>. 

        
      </p></li><li><a name="N3199"></a><p>
        Login as <strong>nsadmin</strong>: </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
$ cp /tmp/template-ini.ini /home/aol31/<i>service_name</i>.ini
   
</pre></td></tr></table></blockquote></li><li><a name="N3211"></a><p>
        Replace the following variables in the file as dictated below using a
        text editor. You must specify a service port for your web server to
        run. The standard HTTP port number is port 80. If you are already
        running a web server (such as <a href="http://www.apache.org/" target="_top">Apache</a>, then port 80 is likely no
        longer available. We recommend setting the service port to
        <tt>8080</tt> for a first time installation. No other service
        uses this port and special access is not required to use it. If you
        want to use port 80, please read <a href="acs.html#install-acs-port80">Section 7.8.</a>. 

     </p><div class="informaltable" id="N3225"><a name="N3225"></a><table cellpadding="5" cellspacing="0" border="1"><colgroup><col><col></colgroup><tbody><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><strong xmlns="">Variable to replace</strong></td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><strong xmlns="">Target Valuee</strong></td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">service_database_username</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">service_name</td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">service_database_password</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">database_password</td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">AOL_HOME</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">/home/aol31</td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">service_short_name</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">service_name</td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">service_short_description</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">a description of your service</td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">service_email</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">the email address of the maintainer</td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">ACS_HOME</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">/web/service_name</td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">service_ip_address</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">your ip address</td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">service_ip_name</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">your dns name</td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">service_port</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">what port to use (80 is standard HTTP port)</td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">service_ip_address_ssl</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">disabled by default</td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">service_ip_name_ssl</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">disabled by default</td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">service_port_ssl}</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">disabled by default</td></tr></tbody></table></div></li><li><a name="N3301"></a><p>
        Copy this <a href="files/nsd-oracle.txt" target="_top">nsd-oracle</a> script into
        <strong>/tmp/nsd-oracle.txt</strong>: </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
$ cd /usr/local/aolserver/bin
$ cp /tmp/nsd-oracle.txt ./nsd-oracle
$ chmod 700 /usr/local/aolserver/bin/nsd-oracle
   
</pre></td></tr></table></blockquote><p>If you deviated from the <a href="oracle.html#defaults" target="_top">Oracle</a>
        installation defaults we specified, edit <strong>nsd-oracle</strong>
        as necessary.
      </p></li><li><a name="N3323"></a><p>
        Kill any current running AOLserver processes and start a new one: </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
$ killall -9 nsd
; Should probably see:
nsd: no process killed    
$ /usr/local/aolserver/bin/nsd-oracle -c /home/aol31/servername.ini
   
</pre></td></tr></table></blockquote><p>Attempt to connect to the service from a web browser as you did in
        the <a href="aolserver.html#install" target="_top">AOLserver documentation</a>. You
        should specify a URL like:</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
http://<i>ip_name</i>:<i>ip_port</i>/
   
</pre></td></tr></table></blockquote><p>You should see a page that looks like <a href="files/acs-start.html" target="_top">this</a> - if so, go on to the next
        section.</p><p>If you don't see the login page, view your error log
        (<strong>/home/aol31/log/servername-error.log</strong>) to make sure
        the service is starting without any problems. If you need to make
        changes, don't forget to kill any running servers.</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
$ killall -9 nsd
   
</pre></td></tr></table></blockquote></li></ul></div></div><div id="install-acs-using-installer" class="sect2"><div class="titlepage"><h3 class="title"><a name="install-acs-using-installer"></a><span class="label">7.4.</span> <span class="title">Using the ACS Installer</span></h3></div><p>Assuming you got your AOLserver up and running previously,</p><div class="itemizedlist"><ul><li><a name="N3365"></a><p>
        You should see a page from the webserver titled <strong>ACS
        Installation: Welcome</strong>. You will be warned if your version of
        the Oracle driver is out of date, if AOLserver cannot connect to the
        database, or if there are any problems with filesystem permissions on
        the server side. But if everything is fine, you can click
        <strong>Next</strong> to proceed to load the ACS Kernel data model. 

        
      </p></li><li><a name="N3374"></a><p>
        The next page shows the results of loading the ACS Kernel data model
        - be prepared to wait 20-30 seconds as it works. You should see a
        string of "No errors." as the tables are created in Oracle.
        Finally, another <strong>Next</strong> button will appear at the
        bottom - click it. 

        
      </p></li><li><a name="N3380"></a><p>
        The following page shows the results of loading the package data
        models. You should see positive results for each of the previously
        selected packages, but watch out for any errors. Eventually, the page
        will display "Done installing packages." - click
        <strong>Create Administrator</strong>. 

        
      </p></li><li><a name="N3386"></a><p>
        You should see a page, "ACS Installation: Create
        Administrator" with form fields to define the ACS site
        administrator. Fill out the fields as appropriate, and click
        <strong>Create User</strong>. 

        
      </p></li><li><a name="N3392"></a><p>
        You should see a page, "ACS Installation: Set System
        Information" allowing you to essentially name your service. Fill
        out the fields as appropriate, and click <strong>Set System
        Information</strong> 

        
      </p></li><li><a name="N3398"></a><p>
        You'll see the final Installer page, "ACS Installation:
        Complete." It will tell you that the server is being restarted;
        note that unless you already added your AOLserver entry to the
        inittab, you'll need to manually restart your service. 

        
      </p></li><li><a name="N3401"></a><p>After the server restarts and you reload the final page above, you
      should see a login screen, asking for your email address and password.
      Congratulations, ACS 4 is now up and running.</p></li></ul></div></div><div id="install-acs-troubleshooting" class="sect2"><div class="titlepage"><h3 class="title"><a name="install-acs-troubleshooting"></a><span class="label">7.5.</span> <span class="title">Troubleshooting</span></h3></div><p>If you can't get to the login page, check for one of the below
    errors:</p><div class="itemizedlist"><ul><li><a name="N3411"></a><p>
        If you don't see a page at all.</p><p>Check the log file. Make sure there is a line like:</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
Notice: nssock: listening on http://localhost.localdomain:8000
  
</pre></td></tr></table></blockquote><p>
        If you can't find this line, look for a line specifying an error
        listening to a port. Such errors are caused if another process is
        listening to that port or if you don't have permission to access
        the port. Try using another port, perhaps 8086. You specify the port
        in <tt>/home/aol30/service_name.ini</tt> under
        <tt>[ns/server/service_name/module/nssock]</tt> Here is a sample
        for a computer programmed to listen to 127.0.0.1:8080. Try replacing
        the entries in your file with this one. </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
[ns/server/service_name/module/nssock]
timeout=120
Address=127.0.0.1
Hostname=127.0.0.1
Port=8080
</pre></td></tr></table></blockquote></li><li><a name="N3432"></a><p>Carefully scan the error log file for other entries flagged as
      errors. If you can't figure out what is wrong, try posting to the
      <a href="http://www.openacs.org/bboard/q-and-a.tcl?topic_id=21" target="_top">web/db
      bboard</a>.</p></li></ul></div></div><div id="install-acs-keepalive" class="sect2"><div class="titlepage"><h3 class="title"><a name="install-acs-keepalive"></a><span class="label">7.6.</span> <span class="title">Ensure that Your Service Automatically Starts on Boot (or any other
    time the service dies)</span></h3></div><p>This step should be completed as root. This can break every service on
    your machine, so proceed with caution.</p><div class="itemizedlist"><ul><li><a name="N3446"></a><p>
        Copy this <a href="files/restart-aolserver.txt" target="_top">restart-aolserver</a> into
        <strong>/tmp/restart-aolserver.txt</strong>. 

        
      </p></li><li><a name="N3456"></a><p>
        This script needs to be SUID-root, which means that the script will
        run as root. This is necessary to ensure that the aolserver processes
        are killed regardless of who owns them. However the script should be
        executable by the <strong>web</strong> group to ensure that the users
        updating the web page can use the script, but that general system
        users cannot run the script. You also need to have Perl installed and
        also a symbolic link to it in <tt>/usr/local/bin</tt>. </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
$ su - 
; Enter root password.    
# cp /tmp/restart-aolserver.txt /usr/local/bin/restart-aolserver
# chown root.web /usr/local/bin/restart-aolserver
# chmod 4750 /usr/local/bin/restart-aolserver
# ln -s /usr/bin/perl /usr/local/bin/perl
# su - nsadmin
</pre></td></tr></table></blockquote></li><li><a name="N3469"></a><p>
        Test the <strong>restart-aolserver</strong> script by making sure all
        servers are dead, starting a new server, and then killing it. You
        should see the following lines. </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
$ killall -9 nsd
nsd: no process killed
$ /usr/local/aolserver/bin/nsd-oracle -c /home/aol31/service_name.ini
$ restart-aolserver service_name
Killing 23727 23728 23729 23730
$ killall -9 nsd
nsd: no process killed
</pre></td></tr></table></blockquote><p>        The numbers indicate the process ids (PIDs) of the processes being
        killed. It is important that no processes are killed by the second
        call to <tt>killall</tt>. If there are processes being killed, it
        means that the script is not working. 

        
      </p></li><li><a name="N3484"></a><p>
        Assuming that the <strong>restart-aolserver</strong> script worked,
        login as root and open <tt>/etc/inittab</tt> for editing. </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
$ su -
; Enter root password
# emacs -nw /etc/inittab    
</pre></td></tr></table></blockquote></li><li><a name="N3497"></a><p>
        Copy this line into the bottom of the file as a template, making sure
        that the first field <strong>nss</strong> is unique. </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
nss:2345:respawn:/usr/local/aolserver/bin/nsd-oracle -i -c /home/aol31/<i>service_name</i>.ini
</pre></td></tr></table></blockquote></li><li><a name="N3509"></a><p><strong>Important:</strong> Make sure there is a newline at
      the end of the file. If there is not a newline at the end of the file,
      the system may suffer catastrophic failures.</p></li><li><a name="N3514"></a><p>
        Still as root, enter the following command to re-initialize
        <tt>/etc/inittab</tt>. </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
# killall -9 nsd    
# /sbin/init q
</pre></td></tr></table></blockquote></li><li><a name="N3524"></a><p>
        <strong>Important:</strong> See if it worked by running the
        restart-aolserver script again. </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
# restart-aolserver <i>service_name</i>
Killing 23750 23753 23754 23756
</pre></td></tr></table></blockquote></li></ul></div><p> If the processes were killed, congratulations, your server is now
    automated for startup and shutdown. On to the <a href="tests.html" target="_top">Acceptance Tests!</a></p></div><div id="install-acs-transfer" class="sect2"><div class="titlepage"><h3 class="title"><a name="install-acs-transfer"></a><span class="label">7.7.</span> <span class="title">How to Transfer Data</span></h3></div><p>
    If you are moving the service from one location to another, export code
    for the old database and import into the new. If your database has been
    hosed and you want to restore a backup, use the <tt>imp</tt> command.
    These commands can be run from the shell, you don't need to use
    <tt>sqlplus</tt>. To export:</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
exp <i>service_name</i>/<i>database_password</i> file=foo.dmp consistent=y full=y
</pre></td></tr></table></blockquote><p>To import:</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
imp <i>service_name</i>/<i>database_password</i> file=foo.dmp [fromuser=olduser touser=<i>service_name</i>]
</pre></td></tr></table></blockquote></div><div id="install-acs-port80" class="sect2"><div class="titlepage"><h3 class="title"><a name="install-acs-port80"></a><span class="label">7.8.</span> <span class="title">Running AOLserver on Port 80</span></h3></div><p>
    If you want to run the service on port 80 (the default HTTP port), you
    need to add some additional settings to your
    <tt>service_name.ini</tt> file in <tt>/home/aol30</tt>. Under the
    <tt>[ns/parameters]</tt> section, ensure that there is an entry </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
User=nsadmin
</pre></td></tr></table></blockquote><p>    Moreover, you will need to start the service as <strong>root</strong>. If
    you follow the instructions above for <a href="acs.html#install-acs-keepalive">automating
    startup</a>, this will be taken care of, but if you ever start the server
    from the command line, be sure to <strong>su -</strong> first.</p><p>These steps are required because port 80 is a <i>privileged</i>
    port. Only certain users can claim it. When you start
    <strong>nsd</strong> as root, it obtains the port, and then changes to
    run as whatever user you specify in the server configuration file. This
    ensures a high level of security, as the server, once started, is not
    running as <strong>root</strong>. This mean that if someone was able to
    exploit your web server to execute a command on your server, they would
    not be able to gain <strong>root</strong> access.</p></div><div id="install-acs-delete-tablespace" class="sect2"><div class="titlepage"><h3 class="title"><a name="install-acs-delete-tablespace"></a><span class="label">7.9.</span> <span class="title">Deleting a tablespace</span></h3></div><p>
    Should it become necessary to rebuild a tablespace from scratch, you can
    use the <tt>drop user</tt> command with the <tt>cascade</tt>
    option. This command will drop the user and every database object the
    user owns.</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
drop user
<i>service_name</i> cascade;
</pre></td></tr></table></blockquote><p>If this does not work because svrmgrl "cannot drop a user that is
    currently connected", make sure to kill the AOLserver using this
    user. If it still does not work, do:</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
 select username, sid, serial# from v$session where username='<i>service_name</i>';
</pre></td></tr></table></blockquote><p>and then</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
alter system kill session '<i>sid</i>,<i>serial#</i>';
</pre></td></tr></table></blockquote><p>where <i>sid</i> and <i>serial#</i> are replaced with the
    corresponding values for the open session.</p><p><strong>Use with caution!</strong></p><p>If you feel the need to delete <i>everything</i> related to the
    service, you can also issue the following:</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
drop tablespace <i>service_name</i> including contents cascade constraints;
</pre></td></tr></table></blockquote></div><div id="install-acs-backup" class="sect2"><div class="titlepage"><h3 class="title"><a name="install-acs-backup"></a><span class="label">7.10.</span> <span class="title">Set Up Nightly Oracle Exports</span></h3></div><p>While you're working with Oracle, you should configure it to do
    automatic exports. An export is a separate backup copy of the database.
    This copy includes all of the database's state at the time that the
    export was initiated. If your database is corrupted, you can restore from
    one of these backups (see <a href="acs.html#install-acs-transfer">Section 7.7.</a>). You should
    do this step as <strong>root</strong>.</p><div class="itemizedlist"><ul><li><a name="N3699"></a><p>
        Download the backup script. Save the file <a href="files/export-oracle.txt" target="_top">export-oracle.txt</a> as
        <strong>/tmp/export-oracle.txt</strong>. 

        
      </p></li><li><a name="N3709"></a><p>
        Login as root. The following commands will install the export script:
       </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
$ su -
; Enter root password
# cp /tmp/export-oracle.txt /usr/sbin/export-oracle
# chmod 700 /usr/sbin/export-oracle
   
</pre></td></tr></table></blockquote></li><li><a name="N3715"></a><p>
        Setup the export directory; this is the directory where backups will
        be stored. We recommend the directory
        <tt>/ora8/m02/oracle-exports</tt>. </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
# mkdir /ora8/m02/oracle-exports
# chown oracle.dba /ora8/m02/oracle-exports
# chmod 770 /ora8/m02/oracle-exports
   
</pre></td></tr></table></blockquote></li><li><a name="N3725"></a><p>
        Now edit <tt>/usr/sbin/export-oracle</tt> and change the
        <tt>SERVICE_NAME</tt> and <tt>DATABASE_PASSWORD</tt> fields
        to their correct values. If you want to use a directory other than
        <tt>/ora8/m02/oracle-exports</tt>, you also need to change the
        <tt>exportdir</tt> setting. 
</p><p>Test the export procedure by running the command:</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
# /usr/sbin/export-oracle
mv: /ora8/m02/oracle-exports/oraexport-service_name.dmp.gz: No such file or directory

Export: Release 8.1.6.1.0 - Production on Sun Jun 11 18:07:45 2000

(c) Copyright 1999 Oracle Corporation.  All rights reserved.


Connected to: Oracle8i Enterprise Edition Release 8.1.6.1.0 - Production
With the Partitioning option
JServer Release 8.1.6.0.0 - Production
Export done in US7ASCII character set and US7ASCII NCHAR character set
. exporting pre-schema procedural objects and actions
. exporting foreign function library names for user SERVICE_NAME 
. exporting object type definitions for user SERVICE_NAME 
About to export SERVICE_NAME's objects ...
. exporting database links
. exporting sequence numbers
. exporting cluster definitions
. about to export SERVICE_NAME's tables via Conventional Path ...
. exporting synonyms
. exporting views
. exporting stored procedures
. exporting operators
. exporting referential integrity constraints
. exporting triggers
. exporting indextypes
. exporting bitmap, functional and extensible indexes
. exporting posttables actions
. exporting snapshots
. exporting snapshot logs
. exporting job queues
. exporting refresh groups and children
. exporting dimensions
. exporting post-schema procedural objects and actions
. exporting statistics
Export terminated successfully without warnings.
   
</pre></td></tr></table></blockquote><p>If you don't have any warnings, proceed to automate the
        backups.</p></li><li><a name="N3755"></a><p>
        Automating backups is accomplished using the UNIX
        <strong>crontab</strong> facility.</p><p>While still <strong>root</strong>, run the following command. You
        can replace the <tt>EDITOR="emacs -nw"</tt> portion
        with whatever editor your prefer, such as <tt>EDITOR=vi</tt>.</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
# export EDITOR="emacs -nw"
# crontab -e
   
</pre></td></tr></table></blockquote><p>        Now add the following line on a line by itself </p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
0 23 * * * /usr/sbin/export-oracle
   
</pre></td></tr></table></blockquote><p>Save the file, exit the editor. Verify that the addition succeeded
        by checking the output of the following command.</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
# crontab -l | grep export-oracle
0 23 * * * /usr/sbin/export-oracle
# exit
; Logout
   
</pre></td></tr></table></blockquote><p>  If you see the line, go ahead and log out.
      </p></li></ul></div><p><div align="right" class="cvstag">($Id$)</div></p></div></div><div class="navfooter"><hr size="1" noshade><table width="100%"><tr><td width="40%" align="left"><a class="bottomnav" href="aolserver.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a href="mailto:acs-docs@arsdigita.com"><address class="nav">acs-docs@arsdigita.com</address></a></td><td width="40%" align="right">&nbsp;<a class="bottomnav" href="tests.html">Next</a></td></tr></table></div></body></html>
