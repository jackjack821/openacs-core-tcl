<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type"><title>Install PostgreSQL 7.1.3</title><meta name="generator" content="DocBook XSL Stylesheets V1.50.0"><link rel="home" href="index.html" title="OpenACS Documentation"><link rel="up" href="unix-install.html" title="Chapter 2. Installing on Unix/Linux"><link rel="previous" href="oracle.html" title="Install Oracle 8.1.7"><link rel="next" href="aolserver.html" title="Install AOLserver 3.3+ad13"><link rel="stylesheet" href="openacs.css" type="text/css"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><a href="http://openacs.org"><img src="images/alex.jpg" border="0"></a><table width="100%" summary="Navigation header" border="0"><tr><td width="20%" align="left"><a accesskey="p" href="oracle.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter 2. Installing on Unix/Linux</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="aolserver.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="postgres"></a>Install PostgreSQL 7.1.3</h2></div></div><div class="authorblurb"><p>
	by <a href="mailto:vinod@kurup.com" target="_top">Vinod Kurup</a><br>
		  OpenACS docs are written by the named authors, but may be edited
		  by OpenACS documentation staff.
		</p></div><p>
	Skip this page if you're not interested in PostgreSQL.
  </p><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="install-postgres-download"></a>Download the PostgreSQL source</h3></div></div><p>	  
	  Download PostgreSQL 7.1.3 from the mirror closest to you. The list of
	  mirrors is at <a href="http://www.postgresql.org/" target="_top">http://www.postgresql.org</a>. Download
	  it to <tt>/tmp</tt>.
	</p><p>
	  As <tt>root</tt>, unpack it into
	  <tt>/usr/local/src</tt>
	</p><pre class="programlisting">
joeuser:~$ su -
Password: ***********
root:~# cd /usr/local/src
root:/usr/local/src# tar xzf /tmp/postgresql-7.1.3.tar.gz</pre></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="install-postgres-user"></a>Create the Postgres user</h3></div></div><p>
	  Still as <tt>root</tt>, create a user and
	  group (if you haven't done so before) for PostgreSQL. This is the
	  account that PostgreSQL will run as since it will not run as
	  root. Also give the <tt>postgres</tt> user a
	  password:
	</p><pre class="programlisting">
root:~# groupadd web
root:~# useradd -g web -d /usr/local/pgsql postgres 
root:~# passwd postgres

root:~# mkdir -p /usr/local/pgsql
root:~# chown -R postgres.web /usr/local/pgsql /usr/local/src/postgresql-7.1.3
root:~# chmod 750 /usr/local/pgsql
root:~# exit
logout
joeuser:~$ su - postgres
Password: ***********</pre></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="install-postgres-env"></a>Set up postgres's environment variables</h3></div></div><p>	  
	  Edit <tt>/usr/local/pgsql/.bash_profile</tt>
	  so it looks like this:
	</p><pre class="programlisting">
LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/pgsql/lib
PATH=$PATH:/usr/local/pgsql/bin

export PATH LD_LIBRARY_PATH</pre><p>
	  Logout and login again as <tt>postgres</tt>. Use the
	  <tt>echo</tt> command to make sure that
	  <tt>/usr/local/pgsql/bin</tt> is now in your
	  PATH
	</p><pre class="programlisting">
postgres:~$ exit
logout
joeuser:~$ su - postgres
Password: ************
postgres:~$ echo $PATH
/usr/local/bin:/usr/bin:/bin: ... :/usr/local/pgsql/bin</pre></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="install-postgres-compile"></a>Compile and install PostgreSQL</h3></div></div><p>
	  First, we run <tt>./configure</tt> to set the
	  compilation options automatically. This is the point at which you can
	  configure PostgreSQL in various ways. For example, if you want to
	  enable Unicode support, add the flags
	  <tt>--enable-locale</tt> and
	  <tt>--enable-multibyte</tt>. If you want to
	  see what the other possibilities are, run <tt>./configure
	  --help</tt>.
	</p><pre class="programlisting">
postgres:~$ cd /usr/local/src/postgresql-7.1.3
postgres:/usr/local/src/postgresql-7.1.3$ ./configure
postgres:/usr/local/src/postgresql-7.1.3$ make all</pre><p>
	  Compilation will take a while (about 10 minutes). Once it's done, you
	  will see the following message:
	</p><pre class="programlisting">
All of PostgreSQL is successfully made. Ready to install.</pre><p>
	  Next, we'll install PostgreSQL. If all is successful, you'll see the
	  following &#8220;Thank You&#8221; message.
	</p><pre class="programlisting">
postgres:/usr/local/src/postgresql-7.1.3$ make install
...
Thank you for choosing PostgreSQL, the most advanced open source database engine.</pre></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="install-postgres-openfts"></a>Prepare PostgreSQL for OpenFTS</h3></div></div><p>
	  OpenFTS is the module that provides full text search to OpenACS 4.5. We
	  won't be installing it until later, but we'll set up a couple things
	  that are best done right now.
	</p><pre class="programlisting">
postgres:/usr/local/src/postgresql-7.1.3$ make install-all-headers
postgres:/usr/local/src/postgresql-7.1.3$ cd contrib/intarray
postgres:/usr/local/src/postgresql-7.1.3/contrib/intarray$ make
postgres:/usr/local/src/postgresql-7.1.3/contrib/intarray$ make install</pre></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="install-postgres-startup"></a>Start PostgreSQL</h3></div></div><p>The <tt>initdb</tt> command initializes
	  the database. <tt>pg_ctl</tt> is used to
	  start up PostgreSQL.
	</p><pre class="programlisting">
postgres:/usr/local/src/postgresql-7.1.3/contrib/intarray$ cd
postgres:~$ /usr/local/pgsql/bin/initdb -D /usr/local/pgsql/data
postgres:~$ /usr/local/pgsql/bin/pg_ctl -D /usr/local/pgsql/data -l /usr/local/pgsql/data/server.log start
postmaster successfully started</pre><p>
	  PostgreSQL errors will be logged in
	  <tt>/usr/local/pgsql/data/server.log</tt>
	</p></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="install-postgres-plpgsql"></a>Set up plpgsql and allow nsadmin access</h3></div></div><p>
	  We have to install plpgsql into our PostgreSQL installation so that
	  we can use stored procedures. Fortunately, it's pretty easy. We'll
	  also create a database user named
	  <tt>nsadmin</tt>, so that aolserver can
	  access the database. (Don't worry that you don't have a
	  <tt>nsadmin</tt> user yet - we'll create that
	  in the next chapter.)
	</p><pre class="programlisting">
postgres:~$ createlang plpgsql template1
postgres:~$ # Test if we succeeded
postgres:~$ createlang -l template1
     Procedural languages
  Name   | Trusted? | Compiler 
---------+----------+----------
 plpgsql | t        | PL/pgSQL
(1 row)
postgres:~$ createuser nsadmin
Shall the new user be allowed to create databases? (y/n) y
Shall the new user be allowed to create more new users? (y/n) y
CREATE USER</pre></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="install-postgres-test"></a>Test PostgreSQL</h3></div></div><p>
	  Create a database and try some simple commands. The output should be
	  as shown.
	</p><pre class="programlisting">
postgres:~$ createdb mytestdb
CREATE DATABASE
postgres:~$ psql mytestdb
Welcome to psql, the PostgreSQL interactive terminal.

Type:  \copyright for distribution terms
       \h for help with SQL commands
       \? for help on internal slash commands
       \g or terminate with semicolon to execute query
       \q to quit

mytestdb=# select current_timestamp;
       timestamp        
------------------------
 2001-12-20 14:24:30-05
(1 row)

mytestdb=# create function test1() returns integer as 'begin return 1; end;' language 'plpgsql';
CREATE
mytestdb=# select test1();
 test1 
-------
     1
(1 row)

mytestdb=# \q
postgres:~$ dropdb mytestdb
DROP DATABASE</pre></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="install-postgres-startonboot"></a>Getting PostgreSQL to start on boot</h3></div></div><p>
	  Download <a href="files/postgresql.txt" target="_top">postgresql.txt</a> to
	  <tt>/tmp</tt>. Then follow the instructions
	  specific to your distribution:
	</p><div class="itemizedlist"><ul type="disc"><li><p>Debian:</p><pre class="programlisting">
postgres:~$ su -
Password: ***********
root:~# cp /tmp/postgresql.txt /etc/init.d/postgresql
root:~# chown root.root /etc/init.d/postgresql
root:~# chmod 700 /etc/init.d/postgresql</pre><p>Test the script</p><pre class="programlisting">
root:~# /etc/init.d/postgresql stop
Stopping PostgreSQL: ok</pre><p>
		  If PostgreSQL successfully stopped, then use the following
		  command to make sure that the script is run appropriately at boot
		  and shutdown.
		</p><pre class="programlisting">
root:~# update-rc.d postgresql defaults
 Adding system startup for /etc/init.d/postgresql ...
   /etc/rc0.d/K20postgresql -&gt; ../init.d/postgresql
   /etc/rc1.d/K20postgresql -&gt; ../init.d/postgresql
   /etc/rc6.d/K20postgresql -&gt; ../init.d/postgresql
   /etc/rc2.d/S20postgresql -&gt; ../init.d/postgresql
   /etc/rc3.d/S20postgresql -&gt; ../init.d/postgresql
   /etc/rc4.d/S20postgresql -&gt; ../init.d/postgresql
   /etc/rc5.d/S20postgresql -&gt; ../init.d/postgresql
root:~# /etc/init.d/postgresql start
Starting PostgreSQL: ok
root:~# exit
postgres:~$ exit</pre></li><li><p>Red Hat:</p><pre class="programlisting">
postgres:~$ su -
Password: ***********
root:~# cp /tmp/postgresql.txt /etc/rc.d/init.d/postgresql
root:~# chown root.root /etc/rc.d/init.d/postgresql
root:~# chmod 700 /etc/rc.d/init.d/postgresql</pre><p>Test the script</p><pre class="programlisting">
root:~# /etc/rc.d/init.d/postgresql stop
Stopping PostgreSQL: ok</pre><p>If PostgreSQL successfully stopped, then use the following
		  command to make sure that the script is run appropriately at boot
		  and shutdown.
		</p><pre class="programlisting">
root:~# chkconfig --add postgresql
root:~# chkconfig --list postgresql
; You should see:
postgresql        0:off   1:off   2:on   3:on    4:on    5:on    6:off
root:~# /etc/rc.d/init.d/postgresql start
Starting PostgreSQL: ok
root:~# exit
postgres:~$ exit</pre></li><li><p>SuSE:</p><pre class="programlisting">
postgres:~$ su -
Password: ***********
root:~# cp /tmp/postgresql.txt /etc/rc.d/init.d/postgresql
root:~# chown root.root /etc/rc.d/init.d/postgresql
root:~# chmod 700 /etc/rc.d/init.d/postgresql</pre><p>Test the script</p><pre class="programlisting">
root:~# /etc/rc.d/init.d/postgresql stop
Stopping PostgreSQL: ok</pre><p>
		  If PostgreSQL successfully stopped, then use the following
		  command to make sure that the script is run appropriately at boot
		  and shutdown.
		</p><pre class="programlisting">
root:~# cd /etc/rc.d/init.d
root:/etc/rc.d/init.d# ln -s /etc/rc.d/init.d/postgresql K20postgresql
root:/etc/rc.d/init.d# ln -s /etc/rc.d/init.d/postgresql S20postgresql  
root:/etc/rc.d/init.d# cp K20postgresql rc2.d
root:/etc/rc.d/init.d# cp S20postgresql rc2.d
root:/etc/rc.d/init.d# cp K20postgresql rc3.d
root:/etc/rc.d/init.d# cp S20postgresql rc3.d
root:/etc/rc.d/init.d# cp K20postgresql rc4.d
root:/etc/rc.d/init.d# cp S20postgresql rc4.d 
root:/etc/rc.d/init.d# cp K20postgresql rc5.d
root:/etc/rc.d/init.d# cp S20postgresql rc5.d
root:/etc/rc.d/init.d# rm K20postgresql
root:/etc/rc.d/init.d# rm S20postgresql</pre><p>
		  Test configuration
		</p><pre class="programlisting">
root:/etc/rc.d/init.d # cd
root:~ # /etc/rc.d/init.d/rc2.d/S20postgresql start
Starting PostgreSQL: ok
root:~ # exit</pre></li></ul></div><p>
	  From now on, PostgreSQL should start automatically each time you boot
	  up and it should shutdown gracefully each time you shut down. (Note:
	  Debian defaults to starting all services on runlevels 2-5. Red Hat
	  defaults to starting services on 3-5. So, on Red Hat, PostgreSQL won't
	  start on runlevel 2 unless you alter the above commands a
	  little. This usually isn't a problem as Red Hat defaults to runlevel 3)
	</p></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="install-postgres-moreinfo"></a>Learn more about PostgreSQL</h3></div></div><p>
		  Here are some links: 
	</p><div class="itemizedlist"><ul type="disc"><li><p>
		  <a href="http://www.postgresql.org/idocs/" target="_top">Official PostgreSQL Docs</a>
		</p></li><li><p>
		  <a href="http://pascal.scheffers.net/openacs/pgupdate/" target="_top">Migrating from 7.0 to 7.1</a>
		</p></li><li><p>
		<a href="http://techdocs.postgresql.org" target="_top">techdocs.postgresql.org</a>
		</p></li><li><p>
		  <a href="http://www.linuxjournal.com/article.php?sid=4791" target="_top">PostgreSQL
		Performance Tuning</a>
		</p></li></ul></div></div><p><div class="cvstag">($Id$)</div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="oracle.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="aolserver.html">Next</a></td></tr><tr><td width="40%" align="left">Install Oracle 8.1.7&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="unix-install.html">Up</a></td><td width="40%" align="right">&nbsp;Install AOLserver 3.3+ad13</td></tr></table><hr><address>rmello at fslc.usu.edu</address><address><a href="mailto:vinod@kurup.com">
			vinod@kurup.com
		  </a></address></div></body></html>
