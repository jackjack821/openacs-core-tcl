<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Staged Deployment for Production Networks</title><meta name="generator" content="DocBook XSL Stylesheets V1.64.1"><link rel="home" href="index.html" title="OpenACS Core Documentation"><link rel="up" href="maintenance-web.html" title="Chapter 6. Production Environments"><link rel="previous" href="high-avail.html" title="High Availability/High Performance Configurations"><link rel="next" href="install-ssl.html" title="Installing SSL Support for an OpenACS service"><link rel="stylesheet" href="openacs.css" type="text/css"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><a href="http://openacs.org"><img src="/doc/images/alex.jpg" border="0" alt="Alex logo"></a><table width="100%" summary="Navigation header" border="0"><tr><td width="20%" align="left"><a accesskey="p" href="high-avail.html">Prev</a> </td><th width="60%" align="center">Chapter 6. Production Environments</th><td width="20%" align="right"> <a accesskey="n" href="install-ssl.html">Next</a></td></tr></table><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="maintenance-deploy"></a>Staged Deployment for Production Networks</h2></div></div><div></div></div><div class="authorblurb"><p>By <a href="mailto:joel@aufrecht.org" target="_top">Joel Aufrecht</a></p>
          OpenACS docs are written by the named authors, and may be edited
          by OpenACS documentation staff.
        </div><p>This section describes minimal-risk methods for deploying changes on a production network.  The important characteristics of a safe change deployment include:  (THIS SECTION IN DEVELOPMENT)</p><div class="itemizedlist"><ul type="disc"><li><p>Control: You know for sure that the change you are making is the change that you intend to make and is the change that you tested.</p></li><li><p>Rollback: If anything goes wrong, you can return to the previous working configuration safely and quickly.</p></li></ul></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2522646"></a>Deployment with CVS</h3></div></div><div></div></div><p>With this method, we control the files on a site via CVS.  In this example, there is one development site and one production site.  The only way files should move between the two is via cvs.  The production site could run "HEAD" from cvs (raw example from chat log:)</p><pre class="programlisting">
1) change the file on dev as desired
2) test the new file
3) commit the file: 
if the file is /web/foo-dev/www/index.adp, do: 

cd /web/foo-dev/www
cvs diff index.adp (this is optional; it's just a
reality check)
the lines starting &gt; will be added and the lines
starting &lt; will be removed, when you commit
if that looks okay, commit with: 
cvs -m "changing text on front page for February conference" index.adp
the stuff in -m "foo" is a comment visible only from within cvs commands
4) update the file on production:
cd /web/foo-prod/www
cvs up index.adp</pre><p>The drawback to using HEAD as the live code is that you cannot commit new work on the development server without erasing the definition of 'working production code.'  So a better method is to use a tag.  This guarantees that, at any time in the future, you can retrieve exactly the same set of code.  This is useful for both of the characteristics of safe change deployment.  For control, you can use tags to define a body of code, test that code, and then know that what you are deploying is exactly that code.  For rollback, you can use return to the last working tag if the new tag (or new, untagged changes) cause problems.  .... example of using tags to follow ...</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2522687"></a>A/B Deployment</h3></div></div><div></div></div><p>The approach taken in this section is to always create a new service with the desired changes, running in parallel with the existing site.  This guarantees control, at least at the final step of the process: you know what changes you are about to make because you can see them directly.  It does not, by itself, guarantee the entire control chain.  You need additional measures to make sure that the change you are making is exactly and completely the change you intended to make and tested previously, and nothing more.  Those additional measures typically take the form of source control tags and system version numbers.  The parallel-server approach also guarantees rollback because the original working service is not touched; it is merely set aside.</p><p>This approach can has limitations.  If the database or file system regularly receiving new data, you must interrupt this function or risk losing data in the shuffle.  It also requires extra steps if the database will be affected.</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2522715"></a>Simple A/B Deployment: Database is not changed</h4></div></div><div></div></div><div class="figure"><a name="id2522722"></a><p class="title"><b>Figure 6.2. Simple A/B Deployment - Step 1</b></p><div class="mediaobject" align="center"><img src="images/simple-deploy-1.png" align="middle" alt="Simple A/B Deployment - Step 1"></div></div><div class="figure"><a name="id2522743"></a><p class="title"><b>Figure 6.3. Simple A/B Deployment - Step 2</b></p><div class="mediaobject" align="center"><img src="images/simple-deploy-2.png" align="middle" alt="Simple A/B Deployment - Step 2"></div></div><div class="figure"><a name="id2522764"></a><p class="title"><b>Figure 6.4. Simple A/B Deployment - Step 3</b></p><div class="mediaobject" align="center"><img src="images/simple-deploy-3.png" align="middle" alt="Simple A/B Deployment - Step 3"></div></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2522786"></a>Complex A/B Deployment: Database is changed</h4></div></div><div></div></div><div class="figure"><a name="id2525950"></a><p class="title"><b>Figure 6.5. Complex A/B Deployment - Step 1</b></p><div class="mediaobject" align="center"><img src="images/complex-deploy-1.png" align="middle" alt="Complex A/B Deployment - Step 1"></div></div><div class="figure"><a name="id2525970"></a><p class="title"><b>Figure 6.6. Complex A/B Deployment - Step 2</b></p><div class="mediaobject" align="center"><img src="images/complex-deploy-2.png" align="middle" alt="Complex A/B Deployment - Step 2"></div></div><div class="figure"><a name="id2525991"></a><p class="title"><b>Figure 6.7. Complex A/B Deployment - Step 3</b></p><div class="mediaobject" align="center"><img src="images/complex-deploy-3.png" align="middle" alt="Complex A/B Deployment - Step 3"></div></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="high-avail.html">Prev</a> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right"> <a accesskey="n" href="install-ssl.html">Next</a></td></tr><tr><td width="40%" align="left">High Availability/High Performance Configurations </td><td width="20%" align="center"><a accesskey="u" href="maintenance-web.html">Up</a></td><td width="40%" align="right"> Installing SSL Support for an OpenACS service</td></tr></table><hr><address><a href="mailto:docs@openacs.org">docs@openacs.org</a></address></div><a name="comments"></a><center><a href="http://openacs.org/doc/maintenance-deploy.html#comments">View comments on this page at openacs.org</a></center></body></html>
