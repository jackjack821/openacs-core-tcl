<html xmlns:lxslt="http://xml.apache.org/xslt" xmlns:saxon="http://icl.com/saxon" xmlns:xalanredirect="org.apache.xalan.xslt.extensions.Redirect"><head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>3. ACS 4 Packages</title><link rel="stylesheet" href="ad.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.24"><link rel="home" href="index.html" title="ACS Core"><link rel="up" href="dev-guide.html" title="4. ACS Developer's Guide"><link rel="previous" href="objects.html" title="2. ACS 4 Data Models and the Object System"><link rel="next" href="request-processor.html" title="4. The Request Processor"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><a href="http://www.openacs.org/"><img src="images/alex.jpg" border="0"></a><br><br><a class="topnav" href="/">Home</a><span class="topnav"> : </span><a class="topnav" href="index">Documentation</a><span class="topnav"> : </span><a class="topnav" href="acs-dev.html">Part III. For ACS Developers</a><span class="topnav"> : </span><a class="topnav" href="dev-guide.html">4. ACS Developer's Guide</a><span class="topnav"> : </span><strong class="topnav">3. ACS 4 Packages&nbsp;</strong><hr size="1" noshade><div id="packages" class="sect1"><div class="titlepage"><h2 class="title" style="clear: all"><a name="packages"></a><span class="label">3.</span> <span class="title">ACS 4 Packages</span></h2></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt>3.1. <a href="packages.html#packages-overviw">Overview</a></dt><dt>3.2. <a href="packages.html#packages-why-package">Why package your software?</a></dt><dt>3.3. <a href="packages.html#packages-apm">The APM</a></dt><dt>3.4. <a href="packages.html#packages-looks">What a Package Looks Like</a></dt><dt>3.5. <a href="packages.html#packages-making-a-package">Making a Package</a></dt><dt>3.6. <a href="packages.html#packages-subsites">The Site Map and Package Instances</a></dt><dt>3.7. <a href="packages.html#packages-summary">Summary</a></dt><dt>3.8. <a href="packages.html#packages-add-reading">Additional Reading</a></dt></dl></div><p><p>By <a href="mailto:psu@arsdigita.com" target="_top">Pete Su</a> and <a href="mailto:bquinn@arsdigita.com" target="_top">Bryan Quinn</a></p></p><div id="packages-overviw" class="sect2"><div class="titlepage"><h3 class="title"><a name="packages-overviw"></a><span class="label">3.1.</span> <span class="title">Overview</span></h3></div><p>
This document is a guide on how to write a software package for the
ArsDigita Community System.  ACS packages are installed and maintained
with the ACS Package Manager (APM).  This document presents reasons
for packaging software, conventions for the file system and naming
that must be followed, and step by step instructions for creating a
new package for the "Notes" example package.
</p></div><div id="packages-why-package" class="sect2"><div class="titlepage"><h3 class="title"><a name="packages-why-package"></a><span class="label">3.2.</span> <span class="title">Why package your software?</span></h3></div><p>
To answer this question, we should examine how ACS servers were
organized in the past. We will assume throughout this document that
the page root for your server is called <tt>ROOT</tt>.  In ACS
3.2.x and earlier, a typical server might have a file system behind it
that looked something like this:
</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

<strong>ROOT/</strong>
<strong>   bin/</strong>
<strong>   parameters/</strong>
        ad.ini
     <strong>tcl/</strong>
        core tcl libraries here
     <strong>www/</strong>
         <strong>admin/</strong>
             <strong>bboard/</strong>
                 site wide admin for bboard
             <strong>intranet/</strong>
                 site wide admin for intranet

             ... and so on for all modules ...

         <strong>bboard/</strong>
             pages for bboard
             <strong>admin/</strong>
                 other admin pages for bboard
         <strong>intranet/</strong>
             pages for bboard
             <strong>admin/</strong>
                 other admin pages for intranet
         <strong>doc/</strong>
             documentation
             sql/
                core and application data models here

         ... and so on for all modules ... 

</pre></td></tr></table></blockquote><p>
Later ACS 3.x installs also had a <tt>packages</tt> directory, but
the 3.x package manager was only experimental.
</p><p>
In previous versions of ACS, you wrote a new application like this:
</p><div class="orderedlist"><ol type="1"><li><a name="N5293"></a><p>Put all Tcl library procedures under
      <tt>server-root/tcl</tt>.</p></li><li><a name="N5300"></a><p>Put all User viewable content under
      <tt>server-root/www</tt>.</p></li><li><a name="N5307"></a><p>Put all Admin content under <tt>/admin/package-key/</tt>.
	</p></li></ol></div><p>
This structure is very simple, and worked well in a world where the
ACS was basically a single monolithic entity. But, this organization
made it difficult to distribute modules as independent packcages, because
the pieces of each module are strewn all over the tree in at least 3
or 4 different areas. 
</p><p>
Here is how an ACS 4 server is laid out:
</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

<strong>ROOT/</strong>
    <strong>bin/</strong>
    <strong>packages/</strong>
        <strong>acs-admin/</strong>
        <strong>acs-api-browser/</strong>
        <strong>acs-content-repository/</strong>
        <strong>acs-core-docs/</strong>
        <strong>acs-developer-support/</strong>
        <strong>acs-kernel/</strong>
        <strong>acs-ldap-authentication/</strong>
        <strong>acs-messaging/</strong>
        <strong>acs-subsite/</strong>
        <strong>acs-templating/</strong>
        <strong>acs-test-harness/</strong>
        <strong>acs-util/</strong>
        <strong>acs-workflow/</strong>
        <strong>bboard/</strong>
               bboard.info
               <strong>sql/</strong>
                    data model
               <strong>tcl/</strong>
                    tcl library code
               <strong>www/</strong>
                    <strong>admin/</strong>
                           administration pages
                    other pages
                    <strong>doc/</strong>
                          documentation
        <strong>message-catalog/</strong>
        <strong>news/</strong>
        <strong>notification/</strong>
        <strong>page/</strong>
    <strong>tcl/</strong>
            bootstrap code
    <strong>www/</strong>
            misc pages

</pre></td></tr></table></blockquote><p>
Note that a major reorganization has happened here. The diagram only
expands the structure of the <tt>bboard/</tt> package directory,
but all the others are basically the same. Each package encapsulates
all of its data model, library code, logic, adminstration pages and
user pages in a single part of the file tree. this organization has
two major advantages:
</p><div class="itemizedlist"><ul><li><a name="N5412"></a><p>
This structure makes it easy for developers to track down
<i>everything</i> that is related to a particular package without
hunting all over the file system.
</p></li><li><a name="N5418"></a><p>
Encapsulating everything about a package in one place also makes it
much easier to distribute packages indepedently from the ACS itself.
</p></li></ul></div><p>
In order to make this work, we need a system that keeps track of the
packages that have been installed in the server, where those packages
have been installed, and a standard way to map URLs that a client
sends to our server to the right page in the appropriate
package. While we are at it, this tool may as well also automate
package installation, depedency checking, upgrades, and package
removal. In ACS 4, this tool is called APM.
</p></div><div id="packages-apm" class="sect2"><div class="titlepage"><h3 class="title"><a name="packages-apm"></a><span class="label">3.3.</span> <span class="title">The APM</span></h3></div><p>
The APM is used to create, maintain, and install packages.  It takes
care of copying all of the files and registering the package in the
system.  The APM is responsible for:
</p><div class="orderedlist"><ol type="1"><li><a name="N5432"></a><p>Package registration</p></li><li><a name="N5435"></a><p>Automatic installation of packages: loading data models, code
  libraries, and so on.</p></li><li><a name="N5438"></a><p>Checking what packages depend on what other packages.</p></li><li><a name="N5441"></a><p>Storing information on the package including ownership and a file
      list.</p></li></ol></div><p>
In addition for packages that are applications, the APM is repsonsible
for keeping track of where in the site a user must go in order to use
the application. To do this, the APM defines a set of objects that we
call <i>package instances</i>. Once a package is loaded, the
administrator can create as many instances of the package as she
likes, and map these instances to any URL in the site that she
wants. If packages are analogous to executable programs in an
operating system, then package instances are analgous to multiple
running copies of a single program. Each instance can be independently
administered and each instance maintains its own set of application
parameters and options.
</p><p>
The following sections will show you how to make a package for the
Notes application. In addition, they will discuss some new site
management features in ACS 4 that take advantage of the APM's package
instance model. The two most important of these are <i>subsites</i>,
and the <i>site map</i> tool, which can be used to map applications to
one or more arbitrary URLs in a running site.
</p></div><div id="packages-looks" class="sect2"><div class="titlepage"><h3 class="title"><a name="packages-looks"></a><span class="label">3.4.</span> <span class="title">What a Package Looks Like</span></h3></div><p>

To illustrate the general structure of a package, let's see what the
package for the "notes" application should look like. This is shown in
the diagram below:
</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

<strong>ROOT</strong>/
  +-- packages/    <strong>APM Root</strong>
        |
        +-- notes/	<strong>Package Root</strong> 
        |     |
        |     |
        |     +-- sql/
        |     |     |
        |     |	    +-- notes-create.sql       <strong>Data Model Creation Script</strong>
        |     |	    +-- notes-drop.sql         <strong>Data Model Drop Script</strong>
        |     |	    +-- *.sql                  <strong>Data Model Files</strong>
        |     +-- tcl/
        |     |     |
        |     |	    +-- notes-procs.tcl        <strong>Tcl Library</strong>
        |     |	    +-- notes-init.tcl         <strong>Tcl Initialization</strong>
        |     |     +-- *.tcl                  <strong>Tcl Library Files</strong>
        |     +-- www/
        |     |     |
        |     |     +-- admin/                 <strong>Administration UI</strong>
        |     |     |     +-- tests/           <strong>Regression Tests</strong>
        |     |     |     |     +-- index.tcl  <strong>Regression Test Index Page</strong>
        |     |     |     |     +-- ...        <strong>Regression Tests</strong>
        |     |     |     +-- index.tcl        <strong>Administration UI Index Page</strong>
        |     |     |     +-- ...              <strong>Administration UI Pages</strong>
        |     |     |
        |     |     +-- doc/                   <strong>Documentation</strong>
        |     |     |     +-- index.tcl        <strong>Documentation Index Page</strong>
        |     |     |     +-- ...              <strong>Administration Pages</strong>
        |     |     +-- index.tcl              <strong>UI Index Page</strong>
        |     |     +-- index.adp              <strong>UI Index Template</strong>
        |     |     +-- *.tcl                  <strong>UI Logic Scripts</strong>
        |     |     +-- *.adp                  <strong>UI Templates</strong>
        |     +-- notes.info                   <strong>Package Specification File</strong>
        +-- Other package directories.

</pre></td></tr></table></blockquote><p>


All file locations are relative to the package root, which in this
case is <tt>ROOT/packages/notes</tt>. The following table
describes in detail what each of the files up in the diagram contain.
</p><div class="informaltable" id="N5547"><a name="N5547"></a><table cellpadding="5" cellspacing="0" border="0"><colgroup><col><col><col></colgroup><tbody><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><strong xmlns="">File Type</strong></td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><strong xmlns="">Its Use</strong></td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><strong xmlns="">Naming Convention</strong></td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Data Model Creation Script</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Contains the SQL that creates the necessary data model and
	PL/SQL packages to support the package.  The name must match
	the convention below or the package will not be installed correctly.
    </td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><tt xmlns="">sql/notes-create.sql</tt></td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Data Model Drop Script</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Contains the SQL that removes the data model and PL/SQL
	packages generated by the creation script.  The name must
	match the convention below or the package will not be
	installed correctly.
    </td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><tt xmlns="">sql/notes-drop.sql</tt></td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Data Model File</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Any .sql file that does not match the naming convention above
	is recognized as a data model file.  It is useful to separate
	the SQL in the creation and drop scripts into several
	files and then have the scripts source the other data model
	files.  This can be done by including 
	<i xmlns="">@@ filename</i> in the creation or drop scripts.  See
    the  <a href="http://oradoc.photo.net/ora816/sqlplus.816/a75664/ch83.htm#1011677" target="_top" xmlns="">Oracle SQL*Plus documentation</a> for examples.</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><tt xmlns="">sql/*.sql</tt></td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Tcl Library Files</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">The Tcl library files include a set of procedures that provide
    an application programming interface (API) for the package to
	utilize.</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><tt xmlns="">tcl/notes-procs.tcl</tt></td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Tcl Initialization</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">The initialization files are used to run Tcl procedures that
	should only be sourced once on startup.  Examples of
	statements to put here are registered filters or procedures.
	Tcl initialization files are sourced once on server startup
	after all of the Tcl library files are sourced.</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><i xmlns="">tcl/notes-init.tcl</i></td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Administration UI</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">The administration UI is used to administer the instances of
	the package.  For example, the bboard administration UI is
	used to create new forums, moderate postings, and create new
	categories for bboard postings.</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><tt xmlns="">www/admin/*</tt></td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Administration UI Index Page</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Every package administration UI must have an index page.  In
	most cases, this is <tt xmlns="">index.tcl</tt> but it can be
	any file with the name <tt xmlns="">index</tt>, such as
	index.html or index.adp.</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><tt xmlns="">www/admin/index.tcl</tt></td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Regression Tests</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Every package should have a set of regression tests that
	verify that it is in working operation.   
	These tests should be able to be run at any time after the package has
	been installed and report helpful error messages when there is
    a fault in the system.</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><tt xmlns="">www/admin/tests/</tt></td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Regression Test Index Page</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">The regression test directory must have an index page that
	displays all of the tests available and provides information
	on how to run them.  This file can have any extension, as long
    as its name is <tt xmlns="">index</tt>.</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><tt xmlns="">/www/admin/tests/index.html</tt></td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Documentation</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Every package must include a full set of documentation that
	includes requirements and design documents, and user-level and
    developer-level documentation where appropriate.</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><tt xmlns="">/www/doc/</tt></td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Documentation Index Page</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">The documentation directory must include a static HTML file with the name
	of <tt xmlns="">index.html</tt>.</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><tt xmlns="">/www/doc/index.html</tt></td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">UI Logic Scripts</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Packages provide a UI for users to access the system.  The UI
	is split into Logic and Templates.  The logic scripts
	perform database queries and prepare variables for
	presentation by the associated templates.</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><tt xmlns="">/www/*.tcl</tt></td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">UI Templates</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Templates are used to control the presentation of the UI.
	Templates receive a set of data sources from the logic scripts
	and prepare them for display to the browser.</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><tt xmlns="">/www/*.adp</tt></td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">UI Index Page</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">The UI must have an index page composed of a logic script
	called <tt xmlns="">index.tcl</tt> and a template called
	<tt xmlns="">index.adp</tt>.</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><tt xmlns="">/www/index.tcl</tt></td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Package Specification File</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">The package specification file is an XML file generated and
	maintained by the ACS Package Manager (APM).  It specifies
	information about the package including its parameters and its
    files.</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><tt xmlns="">notes.info</tt></td></tr></tbody></table></div></div><div id="packages-making-a-package" class="sect2"><div class="titlepage"><h3 class="title"><a name="packages-making-a-package"></a><span class="label">3.5.</span> <span class="title">Making a Package</span></h3></div><p>
Here is how you make a package.
</p><div class="orderedlist"><ol type="1"><li><a name="N5739"></a><p>Login as a site-wide administrator on your web service.
</p></li><li><a name="N5742"></a><p>Go to the package manager on your server.  The URL is <a href="/acs-admin/apm" target="_top">/acs-admin/apm</a>.
</p></li><li><a name="N5749"></a><p>Click on the link <a href="/acs-admin/apm/package-add" target="_top">/acs-admin/apm/package-add</a>.
</p></li><li><a name="N5756"></a><p>Fill out the form for adding a new package. The form explains what
everything means, but we'll repeat the important bits here for easy
reference:

<div class="variablelist"><dl><dt><a name="N5760"></a><span class="term">Package Key
</span></dt><dd><p>
This is a short text string that should uniquely name your package to
distinguish it from all the others. It is used as a database key to
keep track of the package and as the name of the directory in the file
system where all the files related to your package will live. Example
package keys in the current system include: <tt>bboard</tt>,
<tt>acs-kernel</tt> and so on. For the example application, we
will use the package key <tt>notes</tt>.
</p></dd><dt><a name="N5778"></a><span class="term">Package Name
</span></dt><dd><p>
This is a short human readable name for your package. For our example,
we will use the name "Notes".
</p></dd><dt><a name="N5784"></a><span class="term">Package Plural
</span></dt><dd><p>
If your package name is a nice singular noun, this should be the
plural form of it. I assume the plural form is used when multiple
instances of the package are used by a single service. We'll talk more
about package instances later. Our example apllication doesn't really
have a good plural name. So just make it also be "Notes".
</p></dd><dt><a name="N5790"></a><span class="term">Package Type
</span></dt><dd><p>
Generally we think of packages as either being <i>applications</i>,
meaning that the package is meant primarily for use by end-users, or
<i>services</i> meaning that the package is meant to be a reusable
library of code, to be used by other packages. <tt>bboard</tt> is
a good example of an application, while <tt>acs-templating</tt> is
a good example of a service. Our example is an application, so pick
that.
</p></dd><dt><a name="N5810"></a><span class="term">Package URL
</span></dt><dd><p>
The URL from which people will download your package when it is
done. Just use the default for this, you can change it later.
</p></dd><dt><a name="N5816"></a><span class="term">Initial Version
</span></dt><dd><p>
Just use the default here, which by convention is 0.1d.
</p></dd><dt><a name="N5822"></a><span class="term">Version URL
</span></dt><dd><p>
Just use the default here.
</p></dd><dt><a name="N5828"></a><span class="term">Summary and Description
</span></dt><dd><p>
Enter a short summary and longer description of what the Notes
application will do. That is, something like "this application keeps
short textual notes in the database", and so on.
</p></dd></dl></div>
</p></li><li><a name="N5835"></a><p>Click the button <strong>Create Package</strong>.
</p></li><li><a name="N5841"></a><p>At this point, APM will create a directory called
<tt>ROOT/packages/notes</tt>.
</p></li><li><a name="N5848"></a><p>Since we didn't create any files for the package before, the
directory that APM created will be empty except for the
<tt>notes.info</tt> file. At this point, create a file called
<tt>ROOT/packages/notes/sql/notes-create.sql</tt> and put the add
the <a href="objects.html">data model</a> that we created before to
this file. You should also create a file called
<tt>ROOT/packages/notes/sql/notes-drop.sql</tt> that drops the
data model.  </p><p>After you do this, go back to the main APM page. From there, click
the link called <strong>notes</strong> to go to the management page for the new
package. Now click the link called <strong>Manage file information</strong>,
then the <strong>Scan the <tt>packages/notes</tt> directory for
additional files in this package</strong> link on that page to scan the
file system for new files.  This will bring you do a page that lists
all the files you just added and lets you add them to the
<tt>notes</tt> package.
</p><p>
Note that while the <tt>.sql</tt> files have been added to the
packge, they <i>have not</i> been loaded into the database. For the
purposes of development, you have to load the data model by hand,
because while ACS has automatic mechanisms for loading and reloading
<tt>.tcl</tt> files for code, it does not do the same thing for
data model files.
</p></li><li><a name="N5899"></a><p>Now go back to the main management page for the <tt>notes</tt>
If your package has parameters, create them using the <strong>Manage
Parameter Information</strong> link.</p></li><li><a name="N5909"></a><p>The new package has been created and installed in the server. At
this point, you should add your package files to your CVS repository.
I'll assume that you have set up your development repository according
to the standards described in <a href="http://acs40.arsdigita.com/acs40-project-central/client-build.html" target="_top">these instructions</a>. If so, then you just do this:
</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

% cd ROOT/packages
% cvs add notes
% cd notes
% cvs add notes.info
% cvs add sql
% cd sql
% cvs add *.sql
% cd ROOT/packages/notes
% cvs commit -m "add new package for notes"

</pre></td></tr></table></blockquote></li><li><a name="N5919"></a><p>
Now you can start developing the package. In addition to writing code,
you should also consider the tasks outlined in the <a href="http://acs40.arsdigita.com/acs40-project-central/package-submission.html" target="_top">package submission guidelines</a>.
</p></li></ol></div></div><div id="packages-subsites" class="sect2"><div class="titlepage"><h3 class="title"><a name="packages-subsites"></a><span class="label">3.6.</span> <span class="title">The Site Map and Package Instances</span></h3></div><p>
At this point, you are probably excited to see your new package in
action. But, we haven't added any user visible pages yet. By
convention, user visible pages go in the
<tt>ROOT/packages/notes/www</tt> directory. So go there and add a
file called <tt>hello.html</tt> with some text in it. Now we have
to make the user pages visible in the site. Since we didn't put the
pages underneath <tt>ROOT/www</tt> they will not appear on their
own.  What we have to do is <i>mount</i> the application into the site
map. That is, we have to define the URL from which the application
will serve its pages. This process is slightly more complex than in
ACS 3.x, but also much more flexible.
</p><p>
In ACS 3.x, everything in the site was implicitly mounted underneath
<tt>ROOT/www</tt>. AOLserver automatically took any URL like
<tt>/foo/bar/moo/baz.html</tt> and mapped it to the file
<tt>ROOT/www/foo/bar/moo/baz.html</tt>.  This was conveniently
simple, but lacked flexibility.  In particular, it was difficult to
map content that lived outside the page root into the site, and it was
also hard to map mulitiple URLs to the same place in the file system.
</p><p>
In ACS 4, administrators can define an arbitrary mapping between the
URLs the user types and the actual file in the file system that is
served. This mapping is called the <i>site map</i> and entries in the
site map are called <i>site nodes</i>. Each site node maps a URL to an
ACS object. Since package instances are objects, the site map allows
us to easily map package instances to URLs As we said before, each
instance of an application has its own set of parameters settings and
runs from its own URL within the site.  What this means is that even
though all the code for the <tt>notes</tt> application lives in
<tt>ROOT/packages/notes</tt> the application itself can run from
any number of locations in the site. This fact allows developers and
administrators to build sites that look to the user like a collection
of many indepdendent applications that actually run on a single shared
code base. The <a href="request-processor.html">request-processor</a> document shows
you how ACS figures out which instance of your application was
requested by the user at any given time. The <a href="subsites.html">page development</a> tutorial shows you how to use this
information in your user interface.
</p><p>
In order to make the new <tt>notes</tt> application visible to
users, we have to mount it in the site map. You do this by going to
the <a href="/admin/site-map" target="_top">Site Map</a> page, which is by
default available at <tt>/acs-admin/site-map</tt>. Use the
interface here to add a new sub-folder called <tt>notes</tt> to
the root of the site, then click <strong>new application</strong> to mount a new
instance of the <tt>notes</tt> application to the site. Name the
new instance <tt>notes-1</tt>.
</p><p>
After you get done doing this, try typing this URL into your browser:

</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

http://your-server.your-domain.com/notes/hello.html

</pre></td></tr></table></blockquote><p>
Now you should see the contents of the page that you added. What has
happened is that all URLs that start with <tt>/notes</tt> have
been mapped in such a way as to serve content from the directory
<tt>ROOT/packages/notes/www</tt>. At this point, you can
experiment with the site map by mounting multiple instances of the not
yet written Notes application at various places in the site. In a
later document, we'll see how to write your applicationn so that the
code can detect from where in the site it was invoked. This is the key
to supporting <a href="subsites.html">subsites</a>.
</p></div><div id="packages-summary" class="sect2"><div class="titlepage"><h3 class="title"><a name="packages-summary"></a><span class="label">3.7.</span> <span class="title">Summary</span></h3></div><p>
The APM performs the following tasks in an ACS site:
</p><div class="itemizedlist"><ul><li><a name="N6040"></a><p>
Manages creation, installation, and removal of packages from the
server. Also keeps track of what files belong to which packages.
</p></li><li><a name="N6043"></a><p>
Manages package upgrades.
</p></li><li><a name="N6046"></a><p>
Manages information on all package <i>instances</i> in a site. For
correctly written application packages, this allows the site
administrator to map multiple instances of a package to URLs within a
site.
</p></li><li><a name="N6052"></a><p>
Writes out package distribution files for other people to download and
install. We'll cover this later.
</p></li></ul></div></div><div id="packages-add-reading" class="sect2"><div class="titlepage"><h3 class="title"><a name="packages-add-reading"></a><span class="label">3.8.</span> <span class="title">Additional Reading</span></h3></div><div class="itemizedlist"><ul><li><a name="N6060"></a><p><a href="apm-design.html">ACS 4 Package Manager Design</a></p></li><li><a name="N6064"></a><p><a href="apm-requirements.html">ACS 4 Package Manager Requirements</a></p></li><li><a name="N6068"></a><p><a href="http://acs40.arsdigita.com/acs40-project-central/package-submission.html" target="_top">Package submission guidelines</a></p></li></ul></div><p><div align="right" class="cvstag">($Id$)</div></p></div></div><div class="navfooter"><hr size="1" noshade><table width="100%"><tr><td width="40%" align="left"><a class="bottomnav" href="objects.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a href="mailto:acs-docs@arsdigita.com"><address class="nav">acs-docs@arsdigita.com</address></a></td><td width="40%" align="right">&nbsp;<a class="bottomnav" href="request-processor.html">Next</a></td></tr></table></div></body></html>
