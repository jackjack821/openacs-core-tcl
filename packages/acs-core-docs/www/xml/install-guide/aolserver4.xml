<?xml version='1.0' ?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN"
               "http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd" [
<!ENTITY % myvars SYSTEM "../variables.ent">
%myvars;
]>

<sect1 id="aolserver4" xreflabel="Install AOLserver 4">
  <title>Install AOLserver 4</title>

  <authorblurb>
    <para>by <ulink url="mailto:sussdorff@sussdorff.de">Malte Sussdorff</ulink></para>
  </authorblurb>

  <orderedlist>
    <listitem id="aolserver4-download">
      <formalpara>
        <title>Retrieve AOLserver</title>
        <para>Download the aolserver from CVS.</para>
      </formalpara>
      <screen>
        [root@yourserver root]# <userinput>cd /usr/local/src</userinput>
        [root@yourserver /usr/local/src]# <userinput>mkdir aolserver</userinput>
        [root@yourserver /usr/local/src]# <userinput>cd aolserver</userinput>
        [root@yourserver /usr/local/src/aolserver]# <userinput>cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/aolserver co  -r aolserver_v40_r2 aolserver</userinput>
        [root@yourserver /usr/local/src/aolserver]# <userinput>cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/aolserver co nscache</userinput>
        [root@yourserver /usr/local/src/aolserver]# <userinput>cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/aolserver co nsrewrite</userinput>
        [root@yourserver /usr/local/src/aolserver]# <userinput>cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/aolserver co nspostgres</userinput>
        [root@yourserver /usr/local/src/aolserver]# <userinput>cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/aolserver co nssha1</userinput>
        [root@yourserver /usr/local/src/aolserver]# <userinput>cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/aolserver co nsoracle</userinput>
        [root@yourserver /usr/local/src/aolserver]# <userinput>cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/aolserver co nsxml</userinput>
        [root@yourserver /usr/local/src/aolserver]# <userinput>wget http://www.tdom.org/tDOM-0.7.8.tar.gz</userinput>
        [root@yourserver /usr/local/src/aolserver]# <userinput>tar xvfz tDOM-0.7.8.tar.gz</userinput>
        [root@yourserver /usr/local/src/aolserver]#
        <userinput>
          cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/aolserver co -r aolserver_v40_r2 aolserver
          cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/aolserver co nscache
          cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/aolserver co nsrewrite
          cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/aolserver co nspostgres
          cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/aolserver co nssha1
          cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/aolserver co nsoracle
          cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/aolserver co nsxml
          wget http://www.tdom.org/tDOM-0.7.8.tar.gz
          tar xvfz tDOM-0.7.8.tar.gz
        </userinput>
      </screen>
    </listitem>
<listitem id="aolserver4-install">
<formalpara>
<title>Configure, compile and install AOLserver</title>
<screen>
  [root@yourserver /usr/local/src/aolserver/]# <userinput>cd aolserver</userinput>
  [root@yourserver /usr/local/src/aolserver/aolserver]# <userinput>cd aolserver</userinput>
  [root@yourserver /usr/local/src/aolserver/aolserver]# <userinput>./configure --with-tcl=/usr/local/lib/</userinput>
  [root@yourserver /usr/local/src/aolserver/aolserver]# <userinput>make install</userinput>
</screen>
</formalpara>
</listitem>
<listitem id="aolserver4-modules-install">
  <formalpara>
    <title>Configure, compile and install the modules</title>
    <orderedlist>
      <listitem id="aolserver4-nscache-install">
        <para>Install nscache</para>
        <screen>
          [root@yourserver /usr/local/src/aolserver/aolserver]# <userinput>cd ../nscache</userinput>
          [root@yourserver /usr/local/src/aolserver/nscache]# <userinput>make install</userinput>
        </screen>
      </listitem>
      <listitem id="aolserver4-nsrewrite-install">
        <para>Install nsrewrite</para>
        <screen>
          [root@yourserver /usr/local/src/aolserver/nscache]# <userinput>cd ../nsrewrite</userinput>
          [root@yourserver /usr/local/src/aolserver/nsrewrite]# <userinput>make install</userinput>
        </screen>
      </listitem>
      <listitem id="aolserver4-nsoracle-install">
        <para>Install nsoracle (if you want to use Oracle)</para>
        <screen>
          [root@yourserver /usr/local/src/aolserver/nscache]# <userinput>cd ../nsoracle</userinput>
          [root@yourserver /usr/local/src/aolserver/nsrewrite]# <userinput>make install</userinput>
        </screen>
        <para>Steps so far</para>
        <screen>
          [root@yourserver /usr/local/src/aolserver]#
          cd aolserver
          ./configure --with-tcl=/usr/local/lib/
          make install
          cd ../nscache
          make install
          cd ../nsrewrite
          make install
          cd ../nsoracle
          make install
        </screen>
      </listitem>
      <listitem id="aolserver4-nspostgres-install">
        <para>Install nspostgres (if you want to use Postgres)</para>
        <screen>
          [root@yourserver /usr/local/src/aolserver/nsrewrite]# <userinput>cd ../nspostgres</userinput>
          [root@yourserver /usr/local/src/aolserver/nspostgres]# <userinput>sudo make install POSTGRES=/usr/local/pgsql ACS=1 </userinput>
        </screen>
        <para>If you run into problems with libpq.a do the following (and repeat the step above)</para>
        <screen>
          [root@yourserver /usr/local/src/aolserver/nspostgres]# <userinput>sudo ranlib /usr/local/pgsql/lib/libpq.a</userinput>
        </screen>
        <para>If you run into problems with the linker, edit the Makefile. Add <computeroutput>-lnsdb</computeroutput> to the <computeroutput>MODLIBS</computeroutput> var.</para>
        <screen>
          MODLIBS = -L$(PGLIB) -lpq <emphasis role="bold">-lnsdb</emphasis>
        </screen>
      </listitem>
       <listitem id="aolserver4-nssha1-install">
        <para>Install nssha1</para>
        <screen>
          [root@yourserver /usr/local/src/aolserver/nsrewrite]# <userinput>cd ../nssha1</userinput>
          [root@yourserver /usr/local/src/aolserver/nssha1]# <userinput>make</userinput>
        </screen>
        <para>If the make fails you will have to edit nssha1.c. Comment out the following 2 lines (lines 139-140):
        <screen>
          <emphasis role="bold">//</emphasis> typedef unsigned int u_int32_t;
          <emphasis role="bold">//</emphasis> typedef unsigned char u_int8_t;
        </screen>
        </para>
        <para>Now install nssha1
        <screen>
          [root@yourserver /usr/local/src/aolserver/nssha1]# <userinput>make install</userinput>
        </screen>
        </para>
      </listitem>
      <listitem id="aolserver4-tdom-install">
        <para>Install tDOM</para>
        <screen>
          [root@yourserver /usr/local/src/aolserver/nssha1]# <userinput>cd ../tDOM-0.7.8/unix</userinput>
        </screen>
        <para>Edit the <computeroutput>CONFIG</computeroutput> file. Uncomment the instructions meant for AOLserver 4, but edit it to look like this:</para>
        <screen>
          ../configure --enable-threads --disable-tdomalloc
          --prefix=/usr/local/aolserver --with-tcl=/usr/local/lib
        </screen>
        <para>Now you can compile and configure tDOM</para>
        <screen>
          [root@yourserver /usr/local/src/aolserver/tDOM-0.7.8/unix]# <userinput>sh CONFIG</userinput>
          [root@yourserver /usr/local/src/aolserver/tDOM-0.7.8/unix]# <userinput>make install</userinput>
        </screen>
      </listitem>
    </orderedlist>
  </formalpara>
</listitem>
<listitem>
  <para><link linkend="install-aolserver-permissions">Test AOLserver</link>. 
  </para>
</listitem>
</orderedlist>
</sect1>


