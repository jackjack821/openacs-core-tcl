<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>ACS File Naming and Formatting Standards</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.45">
<link rel="home" href="index.html" title="OpenACS Documentation">
<link rel="up" href="eng-standards.html" title="Chapter 6. Engineering Standards">
<link rel="previous" href="eng-standards-constraint-naming.html" title="Constraint naming standard">
<link rel="next" href="eng-standards-plsql.html" title="PL/SQL Standards">
<link rel="stylesheet" href="openacs.css" type="text/css">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<a href="http://openacs.org"><img src="images/alex.jpg" border="0"></a><table width="100%" summary="Navigation header" border="0"><tr>
<td width="20%" align="left">
<a accesskey="p" href="eng-standards-constraint-naming.html">Prev</a> </td>
<th width="60%" align="center">Chapter 6. Engineering Standards</th>
<td width="20%" align="right"> <a accesskey="n" href="eng-standards-plsql.html">Next</a>
</td>
</tr></table>
<hr>
</div>
<div class="sect1">
<div class="titlepage"><div><h2 class="title" style="clear: both">
<a name="eng-standards-filenaming"></a>ACS File Naming and Formatting Standards</h2></div></div>
<div class="authorblurb"><p>By <a href="mailto:michael@arsdigita.com" target="_top">michael@arsdigita.com</a> and 
<a href="mailto:aure@arsdigita.com" target="_top">aure@arsdigita.com</a>
</p></div>
<p>
To ensure consistency (and its collateral benefit, maintainability),
we define and adhere to standards in the following areas:
</p>
<div class="sect2">
<div class="titlepage"><div><h3 class="title">
<a name="eng-standards-filenaming-nomenclature"></a>File Nomenclature</h3></div></div>
<p>
Usually we organize our files so that they mainly serve one of the following three purposes:
</p>
<div class="itemizedlist"><ul>
<li><p> displaying objects and their properties</p></li>
<li><p> manipulating or acting on objects in some way (by creating, editing, linking, etc)</p></li>
<li><p> housing procedures, packages, data models and other prerequisite code
Essentially, we want our files named in a fashion that reflects their purpose.</p></li>
</ul></div>
<p>

Under the page root (and the template root if using the <a href="style" target="_top">Style package</a>):
</p>
<div class="itemizedlist"><ul>
<li>
<p>For naming files that enable a specific action on an object, use this format:</p>
<blockquote class="blockquote"><p>
<span class="emphasis"><i><tt>object-verb.extension</tt></i></span>
</p></blockquote>
<p>
For example, the page to erase a user's portrait from the database is
<tt>/admin/users/portrait-erase.tcl</tt>.
</p>
</li>
<li>
<p>However, modules typically deal with only one primary type of object -
e.g.,
the Bookmarks module deals mainly with bookmarks - and so action-type files in modules don't need to be specified by the object they act on.  Example: the user pages
for the Bookmarks module live in the <tt>/bookmarks/</tt>
directory, and so there is no need to name the bookmark editing page with a redundant url: <tt>/bookmarks/bookmark-edit.tcl</tt>. Instead, we omit the object type, and use this convention:
</p>
<blockquote class="blockquote"><p>
<span class="emphasis"><i><tt>verb.extension</tt></i></span>
</p></blockquote>
<p>
Thus, the page to edit a bookmark is <tt>/bookmarks/edit.tcl</tt>.
</p>
</li>
<li>
<p>For naming files that display the properties of a primary object - such as the bookmark object within the bookmark module -  use this convention:</p>
<blockquote class="blockquote"><p>
<tt>one.</tt><span class="emphasis"><i><tt>extension</tt></i></span>
</p></blockquote>
<p>
For example, the page to view one bookmark is
<tt>/bookmarks/one.tcl</tt>.  Note that no verb is necessary for display-type files.
</p>
</li>
<li>
<p>Otherwise, if the object to be displayed is not the primary feature of a module,  simply omit the verb and use the object name:</p>
<blockquote class="blockquote"><p>
<span class="emphasis"><i><tt>object.extension</tt></i></span>
</p></blockquote>
<p>
For example, the page to view the properties of an
ecommerce product is
<tt>/ecommerce/product.tcl</tt>.
</p>
</li>
<li>
<p>For naming files in a page flow, use the convention:</p>
<div class="itemizedlist"><ul>
<li><p>
<span class="emphasis"><i><tt>foobar.extension</tt></i></span> (Step 1)</p></li>
<li><p>
<span class="emphasis"><i><tt>foobar-2.extension</tt></i></span> (Step 2)</p></li>
<li><p>...</p></li>
<li><p>
<span class="emphasis"><i><tt>foobar-N.extension</tt></i></span> (Step N)</p></li>
</ul></div>
<p>
where <span class="emphasis"><i><tt>foobar</tt></i></span> is determined by the above
rules.
</p>
<p>
Typically, we use a three-step page flow when taking user information:
</p>
<div class="orderedlist"><ol type="1">
<li><p>Present a form to the user</p></li>
<li><p>Present a confirmation page to the user</p></li>
<li><p>Perform the database transaction, then redirect</p></li>
</ol></div>
</li>
<li>
<p>Put data model files in <tt>/www/doc/sql</tt>, and name them
for the modules towards which they are used:
</p>
<blockquote class="blockquote"><p>
<span class="emphasis"><i><tt>module</tt></i></span><tt>.sql</tt>
</p></blockquote>
</li>
</ul></div>
<p>
In the Tcl library directory:
</p>
<div class="itemizedlist"><ul>
<li>
<p>For files that contain module-specific procedures, use the
convention:</p>
<blockquote class="blockquote"><p>
<span class="emphasis"><i><tt>module</tt></i></span><tt>-procs.tcl</tt>
</p></blockquote>
</li>
<li>
<p>For files that contain procedures that are part of the core ACS,
use the convention:</p>
<blockquote class="blockquote"><p>
<tt>ad-</tt><span class="emphasis"><i>description</i></span><tt>-procs.tcl</tt>
</p></blockquote>
</li>
</ul></div>
</div>
<div class="sect2">
<div class="titlepage"><div><h3 class="title">
<a name="eng-standards-filenaming-urls"></a>URLs</h3></div></div>
<p>
File names also appear <span class="emphasis"><i>within</i></span> pages, as linked URLs and
form targets. When they do, always use <a href="abstract-url" target="_top">abstract
URLs</a> (e.g., <tt>user-delete</tt> instead of
<tt>user-delete.tcl</tt>), because they enhance maintainability.
</p>
<p>
Similarly, when linking to the index page of a directory, do not
explicitly name the index file (<tt>index.tcl</tt>,
<tt>index.adp</tt>, <tt>index.html</tt>, etc.). Instead, use
just the directory name, for both relative links
(<tt>subdir/</tt>) and absolute links
(<tt>/top-level-dir/</tt>). If linking to the directory in which
the page is located, use the empty string (<tt>&quot;&quot;</tt>), which
browsers will resolve correctly.
</p>
</div>
<div class="sect2">
<div class="titlepage"><div><h3 class="title">
<a name="eng-standards-filenaming-headers"></a>File Headers and Page Input</h3></div></div>
<p>
Include the appropriate standard header in all scripts.  The first
line should be a comment specifying the file path relative to the
ACS root directory.  e.g.
</p>
<blockquote class="blockquote"><p><tt>
# /www/index.tcl
</tt></p></blockquote>
<p>
or
</p>
<blockquote class="blockquote"><p><tt>
# /tcl/module-defs.tcl
</tt></p></blockquote>
<p>
For static content files (html or adp), include a CVS identification tag as a
comment at the top of the file, e.g.  
</p>
<pre class="programlisting">
&lt;!-- file-standards.html,v 1.2 2000/09/19 07:22:45 ron Exp --&gt;
</pre>
<p>
In addition, all static HTML files, documentation and other pages
should have a visible CVS ID stamp, at least during development. These
can be removed at release times. This should take the form of a line
like this:
</p>
<pre class="programlisting">
&lt;p&gt;
Last Modified: file-standards.html,v 1.2 2000/09/19 07:22:45 ron Exp
&lt;/p&gt;
</pre>
<p>
This can be at the top or bottom of the file.
</p>
<p><div>Using ad_page_contract</div></p>
<p>
For non-library Tcl files (those not in the private Tcl directory),
use <a href="tcl-doc.html#tcl-doc-ad-page-contract" title="ad_page_contract"><tt>ad_page_contract</tt></a>
after the file path comment (this supersedes set_the_usual_form_variables and
ad_return_complaint).  Here is an example of using
ad_page_contract, which serves both documentation and page input
validation purposes:
</p>
<pre class="programlisting">
# www/register/user-login-2.tcl

ad_page_contract {
    Verify the user's password and issue the cookie.
    
    @param user_id The user's id in users table.
    @param password_from_from The password the user entered.
    @param return_url What url to return to after successful login.
    @param persistent_cookie_p Specifies whether a cookie should be set to keep the user logged in forever.
    @author John Doe (jdoe@arsdigita.com)
    @cvs-id file-standards.html,v 1.2 2000/09/19 07:22:45 ron Exp
} {
    user_id:integer,notnull
    password_from_form:notnull
    {return_url {[ad_pvt_home]}}
    {persistent_cookie_p f}
}
</pre>
<p>
Salient features of <tt>ad_page_contract</tt>:
</p>
<div class="itemizedlist"><ul>
<li><p>A mandatory documentation string is the first argument. This has
the standard form with javadoc-style @author, @cvs-id, etc, and should contain a short description of the recieved variables and any necessary explanations. </p></li>
<li><p>The second argument specifies the page
inputs. The syntax for switches/flags (e.g. multiple-list, array,
etc.) uses a colon (:) followed by any number of flags
separated by commas (,),
e.g. <tt>foo:integer,multiple,trim</tt>. In particular, <tt>multiple</tt> and
<tt>array</tt> are the flags that correspond to the old
<tt>ad_page_variables</tt> flags.</p></li>
<li><p>There are new flags: <tt>trim</tt>, <tt>notnull</tt> and
<tt>optional</tt>. They do what you'd expect; values will not be
trimmed, unless you mark them for it; empty strings are valid input, unless
you specify notnull; and a specified variable will be considered required,
unless you declare it optional.</p></li>
<li><p>
<tt>ad_page_contract</tt> can do validation for you: the flags <tt>integer</tt>
and <tt>sql_identifier</tt> will make sure that the values
supplied are integers/sql_identifiers. The <tt>integer</tt> flag
will also trim leading zeros. Note that unless you specify
<tt>notnull</tt>, both will accept the empty string.
</p></li>
<li><p>Note that <tt>ad_page_contract</tt> does not generate
QQvariables, which were automatically created by ad_page_variables and
set_the_usual_form_variables. The use of bind variables makes such
previous variable syntax obsolete.
</p></li>
</ul></div>
<p><div>Using ad_library</div></p>
<p>
For shared Tcl library files, use <a href="tcl-doc.html#tcl-doc-ad-library" title="ad_library"><tt>ad_library</tt></a> after
the file path comment. Its only argument is a doc_string in the
standard (javadoc-style) format, like
<tt>ad_page_contract</tt>. Don't forget to put the @cvs-id in
there.  Here is an example of using ad_library:
</p>
<pre class="programlisting">
# tcl/wp-defs.tcl

ad_library {
    Provides helper routines for the Wimpy Point module.

    @author John Doe (jdoe@arsdigita.com)
    @cvs-id file-standards.html,v 1.2 2000/09/19 07:22:45 ron Exp
}
</pre>
<p><div>Non-Tcl Files</div></p>
<p>
For SQL and other non-Tcl source files, the following file header structure is recommended:
</p>
<pre class="programlisting">
-- <span class="emphasis"><i>path relative to the ACS root directory</i></span>
--
-- <span class="emphasis"><i>brief description of the file's purpose</i></span>
--
-- <span class="emphasis"><i>author</i></span>
-- <span class="emphasis"><i>created</i></span>
--
-- <a href="http://www.loria.fr/~molli/cvs/doc/cvs_12.html#SEC93" target="_top">$Id$</a>
</pre>
<p>
Of course, replace &quot;<tt>--</tt>&quot; with the comment delimiter
appropriate for the language in which you are programming.
</p>
</div>
<div class="sect2">
<div class="titlepage"><div><h3 class="title">
<a name="eng-standards-filenaming-pages"></a>Page Construction</h3></div></div>
<p>
Construct the page as one Tcl variable (name it
<tt>page_content</tt>), and then send it back to the browser with
one call to <tt>doc_return</tt>, which will call
db_release_unused_handles prior to executing ns_return, effectively
combining the two operations.
</p>
<p>
For example:
</p>
<pre class="programlisting">
set page_content &quot;[ad_header &quot;<span class="emphasis"><i>Page Title</i></span>&quot;]

&lt;h2&gt;<span class="emphasis"><i>Page Title</i></span>&lt;/h2&gt;

&lt;hr&gt;

&lt;ul&gt;
&quot;

db_foreach get_row_info {
    select row_information 
    from bar
} {
    append page_content &quot;&lt;li&gt;<span class="emphasis"><i>row_information</i></span>\n&quot;
}

append page_content &quot;&lt;/ul&gt;

[ad_footer]&quot;

doc_return 200 text/html $page_content
</pre>
<p>
The old convention was to call <tt>ReturnHeaders</tt> and
then <tt>ns_write</tt> for each distinct chunk of the page. This
approach has the disadvantage of tying up a scarce and valuable
resource (namely, a database handle) for an unpredictable amount of
time while sending packets back to the browser, and so it should be
avoided in most cases. (On the other hand, for a page that requires an
expensive database query, it's better to call

<tt>ad_return_top_of_page</tt>

first, so that the user is not left to stare at an empty page while
the query is running.)
</p>
<p>
Local procedures (i.e., procedures defined and used only within one
page) should be prefixed with &quot;<span class="emphasis"><i><tt>module_</tt></i></span>&quot; and
should be used rarely, only when they are exceedingly useful.
</p>
<p>
All files that prepare HTML to display should end with [ad_footer] or
[<span class="emphasis"><i>module</i></span>_footer].  If your module requires its own footer,
this footer should call ad_footer within it.  Why?  Because when we
adapt the ACS to a new site, it is often the case that the client will
want a much fancier display than the ACS standard.  We like to be able to
edit ad_header (which quite possibly can start a &lt;table&gt;) and
ad_footer (which may need to end the table started in ad_footer) to
customize the look and feel of the entire site.
</p>
</div>
<div class="sect2">
<div class="titlepage"><div><h3 class="title">
<a name="eng-standards-filenaming-tcllib"></a>Tcl Library Files</h3></div></div>
<p>
Further standards for Tcl library files are under discussion; we plan to 
include naming conventions for procs.
</p>
<p><div class="cvstag">($Id$)</div></p>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="eng-standards-constraint-naming.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right"> <a accesskey="n" href="eng-standards-plsql.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left">Constraint naming standard </td>
<td width="20%" align="center"><a accesskey="u" href="eng-standards.html">Up</a></td>
<td width="40%" align="right"> PL/SQL Standards</td>
</tr>
</table>
<hr>
<address>
			rmello at fslc.usu.edu
		</address>
<address><a href="mailto:vinod@kurup.com">
			vinod@kurup.com
		  </a></address>
</div>
</body>
</html>
