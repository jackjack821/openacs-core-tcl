<html xmlns:lxslt="http://xml.apache.org/xslt" xmlns:saxon="http://icl.com/saxon" xmlns:xalanredirect="org.apache.xalan.xslt.extensions.Redirect"><head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>8. ACS File Naming and Formatting Standards</title><link rel="stylesheet" href="ad.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.24"><link rel="home" href="index.html" title="ACS Core"><link rel="up" href="eng-standards.html" title="6. Engineering Standards"><link rel="previous" href="eng-standards-constraint-naming.html" title="7. Constraint naming standard"><link rel="next" href="eng-standards-plsql.html" title="9. PL/SQL Standards"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><a href="http://www.openacs.org/"><img src="images/alex.jpg" border="0"></a><br><br><a class="topnav" href="/">Home</a><span class="topnav"> : </span><a class="topnav" href="index">Documentation</a><span class="topnav"> : </span><a class="topnav" href="acs-dev.html">Part III. For ACS Developers</a><span class="topnav"> : </span><a class="topnav" href="eng-standards.html">6. Engineering Standards</a><span class="topnav"> : </span><strong class="topnav">8. ACS File Naming and Formatting Standards&nbsp;</strong><hr size="1" noshade><div id="eng-standards-filenaming" class="sect1"><div class="titlepage"><h2 class="title" style="clear: all"><a name="eng-standards-filenaming"></a><span class="label">8.</span> <span class="title">ACS File Naming and Formatting Standards</span></h2></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt>8.1. <a href="eng-standards-filenaming.html#eng-standards-filenaming-nomenclature">File Nomenclature</a></dt><dt>8.2. <a href="eng-standards-filenaming.html#eng-standards-filenaming-urls">URLs</a></dt><dt>8.3. <a href="eng-standards-filenaming.html#eng-standards-filenaming-headers">File Headers and Page Input</a></dt><dt>8.4. <a href="eng-standards-filenaming.html#eng-standards-filenaming-pages">Page Construction</a></dt><dt>8.5. <a href="eng-standards-filenaming.html#eng-standards-filenaming-tcllib">Tcl Library Files</a></dt></dl></div><p><p>By <a href="mailto:michael@arsdigita.com" target="_top">michael@arsdigita.com</a> and 
<a href="mailto:aure@arsdigita.com" target="_top">aure@arsdigita.com</a></p></p><p>
To ensure consistency (and its collateral benefit, maintainability),
we define and adhere to standards in the following areas:
</p><div id="eng-standards-filenaming-nomenclature" class="sect2"><div class="titlepage"><h3 class="title"><a name="eng-standards-filenaming-nomenclature"></a><span class="label">8.1.</span> <span class="title">File Nomenclature</span></h3></div><p>
Usually we organize our files so that they mainly serve one of the following three purposes:
</p><div class="itemizedlist"><ul><li><a name="N10227"></a><p> displaying objects and their properties</p></li><li><a name="N10230"></a><p> manipulating or acting on objects in some way (by creating, editing, linking, etc)</p></li><li><a name="N10233"></a><p> housing procedures, packages, data models and other prerequisite code
Essentially, we want our files named in a fashion that reflects their purpose.</p></li></ul></div><p>

Under the page root (and the template root if using the <a href="style" target="_top">Style package</a>):
</p><div class="itemizedlist"><ul><li><a name="N10243"></a><p>For naming files that enable a specific action on an object, use this format:</p><blockquote class="blockquote"><p>
<i><tt>object-verb.extension</tt></i>
</p></blockquote><p>
For example, the page to erase a user's portrait from the database is
<tt>/admin/users/portrait-erase.tcl</tt>.
</p></li><li><a name="N10260"></a><p>However, modules typically deal with only one primary type of object -
e.g.,
the Bookmarks module deals mainly with bookmarks - and so action-type files in modules don't need to be specified by the object they act on.  Example: the user pages
for the Bookmarks module live in the <tt>/bookmarks/</tt>
directory, and so there is no need to name the bookmark editing page with a redundant url: <tt>/bookmarks/bookmark-edit.tcl</tt>. Instead, we omit the object type, and use this convention:
</p><blockquote class="blockquote"><p>
<i><tt>verb.extension</tt></i>
</p></blockquote><p>
Thus, the page to edit a bookmark is <tt>/bookmarks/edit.tcl</tt>.
</p></li><li><a name="N10285"></a><p>For naming files that display the properties of a primary object - such as the bookmark object within the bookmark module -  use this convention:</p><blockquote class="blockquote"><p>
<tt>one.</tt><i><tt>extension</tt></i>
</p></blockquote><p>
For example, the page to view one bookmark is
<tt>/bookmarks/one.tcl</tt>.  Note that no verb is necessary for display-type files.
</p></li><li><a name="N10305"></a><p>Otherwise, if the object to be displayed is not the primary feature of a module,  simply omit the verb and use the object name:</p><blockquote class="blockquote"><p>
<i><tt>object.extension</tt></i>
</p></blockquote><p>
For example, the page to view the properties of an
ecommerce product is
<tt>/ecommerce/product.tcl</tt>.
</p></li><li><a name="N10322"></a><p>For naming files in a page flow, use the convention:</p><div class="itemizedlist"><ul><li><a name="N10326"></a><p><i><tt>foobar.extension</tt></i> (Step 1)</p></li><li><a name="N10333"></a><p><i><tt>foobar-2.extension</tt></i> (Step 2)</p></li><li><a name="N10340"></a><p>...</p></li><li><a name="N10343"></a><p><i><tt>foobar-N.extension</tt></i> (Step N)</p></li></ul></div><p>
where <i><tt>foobar</tt></i> is determined by the above
rules.
</p><p>
Typically, we use a three-step page flow when taking user information:
</p><div class="orderedlist"><ol type="1"><li><a name="N10362"></a><p>Present a form to the user</p></li><li><a name="N10365"></a><p>Present a confirmation page to the user</p></li><li><a name="N10368"></a><p>Perform the database transaction, then redirect</p></li></ol></div></li><li><a name="N10371"></a><p>Put data model files in <tt>/www/doc/sql</tt>, and name them
for the modules towards which they are used:
</p><blockquote class="blockquote"><p>
<i><tt>module</tt></i><tt>.sql</tt>
</p></blockquote></li></ul></div><p>
In the Tcl library directory:
</p><div class="itemizedlist"><ul><li><a name="N10392"></a><p>For files that contain module-specific procedures, use the
convention:</p><blockquote class="blockquote"><p>
<i><tt>module</tt></i><tt>-procs.tcl</tt>
</p></blockquote></li><li><a name="N10406"></a><p>For files that contain procedures that are part of the core ACS,
use the convention:</p><blockquote class="blockquote"><p>
<tt>ad-</tt><i>description</i><tt>-procs.tcl</tt>
</p></blockquote></li></ul></div></div><div id="eng-standards-filenaming-urls" class="sect2"><div class="titlepage"><h3 class="title"><a name="eng-standards-filenaming-urls"></a><span class="label">8.2.</span> <span class="title">URLs</span></h3></div><p>
File names also appear <i>within</i> pages, as linked URLs and
form targets. When they do, always use <a href="abstract-url" target="_top">abstract
URLs</a> (e.g., <tt>user-delete</tt> instead of
<tt>user-delete.tcl</tt>), because they enhance maintainability.
</p><p>
Similarly, when linking to the index page of a directory, do not
explicitly name the index file (<tt>index.tcl</tt>,
<tt>index.adp</tt>, <tt>index.html</tt>, etc.). Instead, use
just the directory name, for both relative links
(<tt>subdir/</tt>) and absolute links
(<tt>/top-level-dir/</tt>). If linking to the directory in which
the page is located, use the empty string (<tt>""</tt>), which
browsers will resolve correctly.
</p></div><div id="eng-standards-filenaming-headers" class="sect2"><div class="titlepage"><h3 class="title"><a name="eng-standards-filenaming-headers"></a><span class="label">8.3.</span> <span class="title">File Headers and Page Input</span></h3></div><p>
Include the appropriate standard header in all scripts.  The first
line should be a comment specifying the file path relative to the
ACS root directory.  e.g.
</p><blockquote class="blockquote"><p><tt>
# /www/index.tcl
</tt></p></blockquote><p>
or
</p><blockquote class="blockquote"><p><tt>
# /tcl/module-defs.tcl
</tt></p></blockquote><p>
For static content files (html or adp), include a CVS identification tag as a
comment at the top of the file, e.g.  
</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
&lt;!-- file-standards.html,v 1.2 2000/09/19 07:22:45 ron Exp --&gt;
</pre></td></tr></table></blockquote><p>
In addition, all static HTML files, documentation and other pages
should have a visible CVS ID stamp, at least during development. These
can be removed at release times. This should take the form of a line
like this:
</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
&lt;p&gt;
Last Modified: file-standards.html,v 1.2 2000/09/19 07:22:45 ron Exp
&lt;/p&gt;
</pre></td></tr></table></blockquote><p>
This can be at the top or bottom of the file.
</p><p><strong>Using ad_page_contract</strong></p><p>
For non-library Tcl files (those not in the private Tcl directory),
use <a href="tcl-doc.html#tcl-doc-ad-page-contract"><tt>ad_page_contract</tt></a>
after the file path comment (this supersedes set_the_usual_form_variables and
ad_return_complaint).  Here is an example of using
ad_page_contract, which serves both documentation and page input
validation purposes:
</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
# www/register/user-login-2.tcl

ad_page_contract {
    Verify the user's password and issue the cookie.
    
    @param user_id The user's id in users table.
    @param password_from_from The password the user entered.
    @param return_url What url to return to after successful login.
    @param persistent_cookie_p Specifies whether a cookie should be set to keep the user logged in forever.
    @author John Doe (jdoe@arsdigita.com)
    @cvs-id file-standards.html,v 1.2 2000/09/19 07:22:45 ron Exp
} {
    user_id:integer,notnull
    password_from_form:notnull
    {return_url {[ad_pvt_home]}}
    {persistent_cookie_p f}
}
</pre></td></tr></table></blockquote><p>
Salient features of <tt>ad_page_contract</tt>:
</p><div class="itemizedlist"><ul><li><a name="N10519"></a><p>A mandatory documentation string is the first argument. This has
the standard form with javadoc-style @author, @cvs-id, etc, and should contain a short description of the recieved variables and any necessary explanations. </p></li><li><a name="N10522"></a><p>The second argument specifies the page
inputs. The syntax for switches/flags (e.g. multiple-list, array,
etc.) uses a <strong>colon</strong> (:) followed by any number of <strong>flags</strong>
separated by commas (,),
e.g. <tt>foo:integer,multiple,trim</tt>. In particular, <tt>multiple</tt> and
<tt>array</tt> are the flags that correspond to the old
<tt>ad_page_variables</tt> flags.</p></li><li><a name="N10547"></a><p>There are new flags: <tt>trim</tt>, <tt>notnull</tt> and
<tt>optional</tt>. They do what you'd expect; values will not be
trimmed, unless you mark them for it; empty strings are valid input, unless
you specify notnull; and a specified variable will be considered required,
unless you declare it optional.</p></li><li><a name="N10562"></a><p><tt>ad_page_contract</tt> can do validation for you: the flags <tt>integer</tt>
and <tt>sql_identifier</tt> will make sure that the values
supplied are integers/sql_identifiers. The <tt>integer</tt> flag
will also trim leading zeros. Note that unless you specify
<tt>notnull</tt>, both will accept the empty string.
</p></li><li><a name="N10584"></a><p>Note that <tt>ad_page_contract</tt> does not generate
QQvariables, which were automatically created by ad_page_variables and
set_the_usual_form_variables. The use of bind variables makes such
previous variable syntax obsolete.
</p></li></ul></div><p><strong>Using ad_library</strong></p><p>
For shared Tcl library files, use <a href="tcl-doc.html#tcl-doc-ad-library"><tt>ad_library</tt></a> after
the file path comment. Its only argument is a doc_string in the
standard (javadoc-style) format, like
<tt>ad_page_contract</tt>. Don't forget to put the @cvs-id in
there.  Here is an example of using ad_library:
</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
# tcl/wp-defs.tcl

ad_library {
    Provides helper routines for the Wimpy Point module.

    @author John Doe (jdoe@arsdigita.com)
    @cvs-id file-standards.html,v 1.2 2000/09/19 07:22:45 ron Exp
}
</pre></td></tr></table></blockquote><p><strong>Non-Tcl Files</strong></p><p>
For SQL and other non-Tcl source files, the following file header structure is recommended:
</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
-- <i>path relative to the ACS root directory</i>
--
-- <i>brief description of the file's purpose</i>
--
-- <i>author</i>
-- <i>created</i>
--
-- <a href="http://www.loria.fr/~molli/cvs/doc/cvs_12.html#SEC93" target="_top">$Id$</a>
</pre></td></tr></table></blockquote><p>
Of course, replace "<tt>--</tt>" with the comment delimiter
appropriate for the language in which you are programming.
</p></div><div id="eng-standards-filenaming-pages" class="sect2"><div class="titlepage"><h3 class="title"><a name="eng-standards-filenaming-pages"></a><span class="label">8.4.</span> <span class="title">Page Construction</span></h3></div><p>
Construct the page as one Tcl variable (name it
<tt>page_content</tt>), and then send it back to the browser with
one call to <tt>doc_return</tt>, which will call
db_release_unused_handles prior to executing ns_return, effectively
combining the two operations.
</p><p>
For example:
</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
set page_content "[ad_header "<i>Page Title</i>"]

&lt;h2&gt;<i>Page Title</i>&lt;/h2&gt;

&lt;hr&gt;

&lt;ul&gt;
"

db_foreach get_row_info {
    select row_information 
    from bar
} {
    append page_content "&lt;li&gt;<i>row_information</i>\n"
}

append page_content "&lt;/ul&gt;

[ad_footer]"

doc_return 200 text/html $page_content
</pre></td></tr></table></blockquote><p>
The old convention was to call <tt>ReturnHeaders</tt> and
then <tt>ns_write</tt> for each distinct chunk of the page. This
approach has the disadvantage of tying up a scarce and valuable
resource (namely, a database handle) for an unpredictable amount of
time while sending packets back to the browser, and so it should be
avoided in most cases. (On the other hand, for a page that requires an
expensive database query, it's better to call

<tt>ad_return_top_of_page</tt>

first, so that the user is not left to stare at an empty page while
the query is running.)
</p><p>
Local procedures (i.e., procedures defined and used only within one
page) should be prefixed with "<i><tt>module_</tt></i>" and
should be used rarely, only when they are exceedingly useful.
</p><p>
All files that prepare HTML to display should end with [ad_footer] or
[<i>module</i>_footer].  If your module requires its own footer,
this footer should call ad_footer within it.  Why?  Because when we
adapt the ACS to a new site, it is often the case that the client will
want a much fancier display than the ACS standard.  We like to be able to
edit ad_header (which quite possibly can start a &lt;table&gt;) and
ad_footer (which may need to end the table started in ad_footer) to
customize the look and feel of the entire site.
</p></div><div id="eng-standards-filenaming-tcllib" class="sect2"><div class="titlepage"><h3 class="title"><a name="eng-standards-filenaming-tcllib"></a><span class="label">8.5.</span> <span class="title">Tcl Library Files</span></h3></div><p>
Further standards for Tcl library files are under discussion; we plan to 
include naming conventions for procs.
</p><p><div align="right" class="cvstag">($Id$)</div></p></div></div><div class="navfooter"><hr size="1" noshade><table width="100%"><tr><td width="40%" align="left"><a class="bottomnav" href="eng-standards-constraint-naming.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a href="mailto:acs-docs@arsdigita.com"><address class="nav">acs-docs@arsdigita.com</address></a></td><td width="40%" align="right">&nbsp;<a class="bottomnav" href="eng-standards-plsql.html">Next</a></td></tr></table></div></body></html>
