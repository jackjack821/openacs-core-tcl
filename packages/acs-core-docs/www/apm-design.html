<html xmlns:lxslt="http://xml.apache.org/xslt" xmlns:saxon="http://icl.com/saxon" xmlns:xalanredirect="org.apache.xalan.xslt.extensions.Redirect"><head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>11. ACS 4 Package Manager Design</title><link rel="stylesheet" href="ad.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.24"><link rel="home" href="index.html" title="ACS Core"><link rel="up" href="kernel-doc.html" title="7. Kernel Documentation"><link rel="previous" href="apm-requirements.html" title="10. ACS 4 Package Manager Requirements"><link rel="next" href="security-requirements.html" title="12. ACS 4 Security Requirements"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><a href="http://www.openacs.org/"><img src="images/alex.jpg" border="0"></a><br><br><a class="topnav" href="/">Home</a><span class="topnav"> : </span><a class="topnav" href="index">Documentation</a><span class="topnav"> : </span><a class="topnav" href="acs-dev.html">Part III. For ACS Developers</a><span class="topnav"> : </span><a class="topnav" href="kernel-doc.html">7. Kernel Documentation</a><span class="topnav"> : </span><strong class="topnav">11. ACS 4 Package Manager Design&nbsp;</strong><hr size="1" noshade><div id="apm-design" class="sect1"><div class="titlepage"><h2 class="title" style="clear: all"><a name="apm-design"></a><span class="label">11.</span> <span class="title">ACS 4 Package Manager Design</span></h2></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt>11.1. <a href="apm-design.html#apm-design-essentials">Essentials</a></dt><dt>11.2. <a href="apm-design.html#apm-design-intro">Introduction</a></dt><dt>11.3. <a href="apm-design.html#apm-design-hist-considerations">Historical Considerations</a></dt><dt>11.4. <a href="apm-design.html#apm-design-competitors">Competitive Analysis</a></dt><dt>11.5. <a href="apm-design.html#apm-design-design-tradeoffs">Design Tradeoffs</a></dt><dt>11.6. <a href="apm-design.html#apm-design-api">API</a></dt><dt>11.7. <a href="apm-design.html#apm-design-data-model">Data Model Discussion</a></dt><dt>11.8. <a href="apm-design.html#apm-design-ui">User Interface</a></dt><dt>11.9. <a href="apm-design.html#apm-design-config">Configuration/Parameters</a></dt><dt>11.10. <a href="apm-design.html#apm-design-future">Future Improvements/Areas of Likely Change</a></dt><dt>11.11. <a href="apm-design.html#apm-design-authors">Authors</a></dt><dt>11.12. <a href="apm-design.html#apm-design-rev-history">Revision History</a></dt></dl></div><p><p>
by <a href="mailto:bquinn@arsdigita.com" target="_top">Bryan Quinn</a> 
</p></p><div id="apm-design-essentials" class="sect2"><div class="titlepage"><h3 class="title"><a name="apm-design-essentials"></a><span class="label">11.1.</span> <span class="title">Essentials</span></h3></div><div class="itemizedlist"><ul><li><a name="N16975"></a><p><a href="/acs-admin/apm" target="_top">ACS Administrator directory</a></p></li><li><a name="N16980"></a><p><a href="apm-requirements.html">ACS 4 Package Manager Requirements</a></p></li><li><a name="N16984"></a><p><a href="packages.html">Packages</a></p></li><li><a name="N16988"></a><p><a href="images/apm.pdf" target="_top">ER diagram</a></p></li><li><a name="N16993"></a><p>Tcl API </p><div class="itemizedlist"><ul><li><a name="N16997"></a><p><a href="/api-doc/procs-file-view?path=packages%2facs%2dkernel%2ftcl%2fapm%2dprocs%2etcl" target="_top">
apm-procs.tcl</a></p></li><li><a name="N17002"></a><p><a href="/api-doc/procs-file-view?path=packages%2facs%2dkernel%2ftcl%2fapm%2dinstall%2dprocs%2etcl" target="_top">
apm-install-procs.tcl</a> (Supports installation of packages)</p></li><li><a name="N17008"></a><p><a href="/api-doc/procs-file-view?path=packages%2facs%2dkernel%2ftcl%2f20%2dapm%2dload%2dprocs%2etcl" target="_top">
20-apm-load-procs.tcl</a> (Bootstraps APM for server startup)</p></li><li><a name="N17014"></a><p><a href="/api-doc/procs-file-view?path=packages%2facs%2dkernel%2ftcl%2fapm%2dadmin%2dprocs%2etcl" target="_top">
apm-admin-procs.tcl</a> (Supports APM UI)</p></li></ul></div></li><li><a name="N17020"></a><p>PL/SQL file </p><div class="itemizedlist"><ul><li><a name="N17024"></a><p><a href="/doc/sql/display-sql?url=apm-create.sql&amp;package_key=acs-kernel" target="_top">apm-create.sql</a></p></li></ul></div></li></ul></div></div><div id="apm-design-intro" class="sect2"><div class="titlepage"><h3 class="title"><a name="apm-design-intro"></a><span class="label">11.2.</span> <span class="title">Introduction</span></h3></div><p>
In general terms, a <strong>package</strong> is a unit of software that
serves a single well-defined purpose. That purpose may be to provide a
service directly to one or more classes of end-user, (e.g., discussion forums
and file storage for community members, user profiling tools for the site
publisher), or it may be to act as a building block for other packages (e.g.,
an application programming interface (API) for storing and querying access
control rules, or an API for scheduling email alerts). Thus, packages fall
into one of two categories: 
</p><div class="itemizedlist"><ul><li><a name="N17039"></a><p><strong>ACS Applications:</strong> a "program or group of programs
designed for end users" (the <a href="http://www.pcwebopaedia.com/TERM/a/application.html" target="_top">Webopedia
definition</a>); also known as <i>modules</i>, for historical reasons.
Examples of applications include <a href="/doc/bboard" target="_top">Bboard</a> and <a href="/doc/news" target="_top">News</a>. 


</p></li><li><a name="N17059"></a><p><strong>ACS Services:</strong> the aforementioned building blocks.
Examples of services include the <a href="/doc/acs-content-repository" target="_top">ACS
Content Repository</a>, the <a href="/doc/acs-templating" target="_top">ACS Templating
System</a>, and the <a href="kernel-doc.html">ACS Kernel</a>, which includes
APM.</p></li></ul></div><p>An installation of the ACS includes the ACS Kernel, some services that
extend the kernel's functionality, and some applications intended for
end-users. Packages function as individual pieces of <a href="subsites-design.html">subsites</a>. A subsite can contain multiple
application and service instances that provide the end-user with capabilities
and content customized to the particular subsite.</p><p>This architecture supports the growth of collaborative commerce. For
example, Jane User starts a forum focusing on the merits of View Cameras by
creating an instance of the Bboard application for her personal subsite on an
ACS Installation. Jack User discovers Jane's forum and includes a link to
it in his subsite. As interest in Jane's forum grows, she creates a
subsite specializing in providing information about View cameras. This
subsite now includes several package instances beyond Bboard; it could
potentially include its own Ecommerce capabilities (ala <a href="http://shopping.yahoo.com" target="_top">Yahoo! Shopping</a>). This could include a
knowledge management application that allows users to spread expertise about
view cameras and a portal application that links to reliable camera models
and resellers. Any subsite enabled package that is added to the ACS
installation through APM is another potential package instance that can
become part of Jane's View Camera subsite.</p><p>The APM provides an architecture for packaging software, making instances
of that software available to subsites, specifying configuration parameters
for each instance, and managing the creation and release of new packages.</p></div><div id="apm-design-hist-considerations" class="sect2"><div class="titlepage"><h3 class="title"><a name="apm-design-hist-considerations"></a><span class="label">11.3.</span> <span class="title">Historical Considerations</span></h3></div><p>
Prior to ACS 3.3, all packages were lumped together into one monolithic
distribution without explicit boundaries; the only way to ascertain what
comprised a given package was to look at the top of the corresponding
documentation page, where, by convention, the package developer would specify
where to find: 
</p><div class="itemizedlist"><ul><li><a name="N17097"></a><p>the data model</p></li><li><a name="N17100"></a><p>the Tcl procedures</p></li><li><a name="N17103"></a><p>the user-accessible pages</p></li><li><a name="N17106"></a><p>the administration pages</p></li></ul></div><p>Experience has shown us that this lack of explicit boundaries causes a
number of maintainability problems for pre-3.3 installations:</p><div class="orderedlist"><ol type="1"><li><a name="N17114"></a><p>Package interfaces were not guaranteed to be stable in any formal way, so
a change in the interface of one package would often break dependent packages
(which we would only discover through manual regression testing). In this
context, any of the following could constitute an interface change: 

</p><div class="itemizedlist"><ul><li><a name="N17118"></a><p>renaming a file or directory that appears in a URL</p></li><li><a name="N17121"></a><p>changing what form variables are expected as input by a page</p></li><li><a name="N17124"></a><p>changing a procedural abstraction, e.g., a PL/SQL or Java stored
procedure or a Tcl procedure</p></li><li><a name="N17127"></a><p>changing a functional abstraction, e.g., a database view or a PL/SQL or
Java stored function</p></li><li><a name="N17130"></a><p>changing the data model</p></li></ul></div><p>This last point is especially important. In most cases, changing the data
model should <i>not</i> affect dependent packages. Rather, the package
interface should provide a level of abstraction above the data model (as well
as the rest of the package implementation). Then, users of the package can
take advantage of implementation improvements that don't affect the
interface (e.g., faster performance from intelligent denormalization of the
data model), without having to worry that code outside the package will now
break.</p></li><li><a name="N17138"></a><p>A typical ACS-backed site only uses a few of the modules included in the
distribution, yet there was no well-understood way to pick only what you
needed when installing the ACS, or even to uninstall what you didn't
need, post-installation. Unwanted code had to be removed manually. 


</p></li><li><a name="N17141"></a><p>Releasing a new version of the ACS was complicated, owing again to the
monolithic nature of the software. Since we released everything in the ACS
together, all threads of ACS development had to converge on a single
deadline, after which we would undertake a focused QA effort whose scale
increased in direct proportion to the expansion of the ACS codebase. 


</p></li><li><a name="N17144"></a><p>There was no standard way for developers outside of ArsDigita to extend
the ACS with their own packages. Along the same lines, ArsDigita programmers
working on client projects had no standard way to keep custom development
cleanly separated from ACS code. Consequently, upgrading an already installed
ACS was an error-prone and time-consuming process.</p></li></ol></div><p>Consistent use of the APM format and tools will go a long way toward
solving the maintainability problems listed above. Moreover, APM is the
substrate that will enable us to soon establish a central package repository,
where both ArsDigita and third-party developers will be able publish their
packages for other ACS users to download and install.</p><p>For a simple illustration of the difference between ACS without APM
(pre-3.3) and ACS with APM (3.3 and beyond), consider a hypothetical ACS
installation that uses only two of the thirty-odd modules available circa ACS
3.2 (say, bboard and e-commerce):</p><div class="mediaobject"><img src="images/acs-without-apm-vs-with-apm.png" align="center" alt="ACS without APM vs. with APM"></div><p>APM itself is part of a package, the <strong>ACS Kernel</strong>, an ACS
service that is the only mandatory component of an ACS installation.</p></div><div id="apm-design-competitors" class="sect2"><div class="titlepage"><h3 class="title"><a name="apm-design-competitors"></a><span class="label">11.4.</span> <span class="title">Competitive Analysis</span></h3></div><p>The ACS is a platform for web-based application software, and any software
platform has the potential to develop problems like those described above.
Fortunately, there are many precedents for systematic solutions,
including:</p><div class="itemizedlist"><ul><li><a name="N17172"></a><p><a href="http://www.debian.org/" target="_top">Debian GNU/Linux</a> and the <a href="http://www.debian.org/doc/packaging-manuals/packaging.html/" target="_top">Debian
Packaging manual</a></p></li><li><a name="N17181"></a><p><a href="http://www.freebsd.org/" target="_top">FreeBSD</a> has <a href="http://www.freebsd.org/handbook/ports.html" target="_top">the Ports
collection</a></p></li><li><a name="N17190"></a><p><a href="http://www.redhat.com/" target="_top">Red Hat Linux</a> has <a href="http://rpm.redhat.com/" target="_top">the Red Hat Package Manager (RPM)</a></p></li></ul></div><p>Borrowing from all of the above, ACS 3.3 introduces its own package
management system, the ACS Package Manager (APM), which consists of:</p><div class="itemizedlist"><ul><li><a name="N17202"></a><p><strong>a standard format for APM packages</strong> (also called
"ACS packages"), including: </p><div class="itemizedlist"><ul><li><a name="N17208"></a><p>version numbering, independent of any other package and the ACS as a
whole</p></li><li><a name="N17211"></a><p>specification of the package interface</p></li><li><a name="N17214"></a><p>specification of dependencies on other packages (if any)</p></li><li><a name="N17217"></a><p>attribution (who wrote it) and ownership (who maintains it)</p></li></ul></div></li><li><a name="N17220"></a><p><strong>web-based tools for package management:</strong> </p><div class="itemizedlist"><ul><li><a name="N17226"></a><p>obtaining packages from a remote distribution point</p></li><li><a name="N17229"></a><p>installing packages, if and only if: </p><div class="orderedlist"><ol type="1"><li><a name="N17235"></a><p>all prerequisite packages are installed</p></li><li><a name="N17238"></a><p>no conflicts will be created by the installation</p></li></ol></div></li><li><a name="N17241"></a><p>configuring packages (obsoleting the monolithic ACS configuration
file)</p></li><li><a name="N17244"></a><p>upgrading packages, without clobbering local modifications</p></li><li><a name="N17247"></a><p>uninstalling unwanted packages</p></li></ul></div></li><li><a name="N17250"></a><p><strong>a registry of installed packages</strong>, database-backed and
integrated with filesystem-based version control 


</p></li><li><a name="N17255"></a><p><strong>web-based tools for package development:</strong> </p><div class="itemizedlist"><ul><li><a name="N17261"></a><p>creating new packages locally</p></li><li><a name="N17264"></a><p>releasing new versions of locally-created packages</p></li></ul></div></li></ul></div></div><div id="apm-design-design-tradeoffs" class="sect2"><div class="titlepage"><h3 class="title"><a name="apm-design-design-tradeoffs"></a><span class="label">11.5.</span> <span class="title">Design Tradeoffs</span></h3></div><p>
The design chosen for APM was meant to satisfy the following constraints: 
</p><div class="itemizedlist"><ul><li><a name="N17274"></a><p>The process of authoring a package must be as simple as possible.</p></li><li><a name="N17277"></a><p>Strict conventions must be established that provide a set of canonical
locations and names for files and patterns, for ACS application
development.</p></li><li><a name="N17280"></a><p>The processes of installing, upgrading, and using packages must be
straightforward and accessible through a web-based UI.</p></li><li><a name="N17283"></a><p>Package instances must be able to have subsite-specific content available
at an easily configurable URL.</p></li></ul></div><p>All of these requirements were met, but at the cost of development
simplicity. As <a href="packages.html">Packages</a> demonstrates, a set of strict directory conventions are
required in order for a package to use APM. This contrasts with the apparent
simplicity available to developers of the ACS 3.3 system. However, while the
system has become more complex for developers to build packages, this
complexity is easily managed and is compensated for by additional
capabilities.</p><p>For example, to make a new application available to the system, a
developer must:</p><div class="orderedlist"><ol type="1"><li><a name="N17296"></a><p>Create the necessary files to support the data model, Tcl API, and UI
pages.</p></li><li><a name="N17299"></a><p>Put the files in the correct locations for APM to be aware of them.</p></li><li><a name="N17302"></a><p>Use APM to create a new package and enable it.</p></li><li><a name="N17305"></a><p>Use the Site Map facility to create an instance of the package, mount it
on an appropriate URL, and set parameters for that particular instance.</p></li></ol></div><p>While this is complex, especially to a new ACS developer, the
documentation walks the developer through each of these steps. Moreover, from
following these steps, the package can be subsite specific, available to
subsites across the system, and be available for distribution to other ACS
installations without doing a monolithic upgrade or reinstall.</p></div><div id="apm-design-api" class="sect2"><div class="titlepage"><h3 class="title"><a name="apm-design-api"></a><span class="label">11.6.</span> <span class="title">API</span></h3></div><p>The APM is composed of systems for accomplishing a set of package-related
tasks. Each of these tasks comprise a feature area that has an API, data
model, and a UI:</p><div class="itemizedlist"><ul><li><a name="N17317"></a><p>Authoring a Package</p></li><li><a name="N17320"></a><p>Maintaining Multiple Versions of a Package</p></li><li><a name="N17323"></a><p>Creating Instances of the Package</p></li><li><a name="N17326"></a><p>Specifying Configuration Parameters for each Instance</p></li></ul></div><p><strong>Authoring a Package</strong></p><p>Full instructions on how to prepare an ACS package are available in <a href="packages.html">Packages</a>. The API here can be invoked manually by a package's data model
creation script, but need not to be used. This API is part of the <a href="/api-doc/plsql-subprogram-one?type=PACKAGE&amp;name=APM" target="_top">APM PL/SQL
package</a>.</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

-- Informs the APM that this application is available for use.
procedure register_application (
    package_key         in apm_package_types.package_key%TYPE,
    pretty_name         in apm_package_types.pretty_name%TYPE,
    pretty_plural       in apm_package_types.pretty_plural%TYPE,
    package_uri         in apm_package_types.package_uri%TYPE,
    singleton_p         in apm_package_types.singleton_p%TYPE
                                default 'f',
    spec_file_path      in apm_package_types.spec_file_path%TYPE
                                default null,
    spec_file_mtime     in apm_package_types.spec_file_mtime%TYPE
                                default null
);

</pre></td></tr></table></blockquote><p>The procedure above registers an ACS application in the APM. It creates a
new ACS object and stores information about the package, such as its name, in
the APM data model. There is an analogous procedure for ACS services, called
<tt>apm.register_service</tt>.</p><p>To remove an application from the system, there are the calls
<tt>apm.unregister_application</tt> and
<tt>apm.unregister_service</tt>.</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

-- Remove the application from the system.  
procedure unregister_application (
    package_key     in apm_package_types.package_key%TYPE,
    -- Delete all objects associated with this application.
    cascade_p       in char default 'f'  
);

</pre></td></tr></table></blockquote><p>Use the <tt>cascade_p</tt> only if you want to completely remove the
package from the ACS.</p><p>In order to determine if a particular package exists in the system, use
the <tt>register_p</tt> predicate. It returns 1 if the specified
<tt>package_key</tt> exists in the system, 0 otherwise.</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

function register_p (
    package_key     in apm_package_types.package_key%TYPE
) return integer;

</pre></td></tr></table></blockquote><p><strong>Maintaining Multiple Versions of a Package</strong></p><p>While the package authoring API provides a means for registering a
package, some information about a package is version dependent. For example,
between versions, the owner of a package, its vendor, its URI, and its
dependency information may change. The API for package versions allows this
information to be specified. All of these APIs are part of the <a href="/api-doc/plsql-subprogram-one?type=PACKAGE&amp;name=APM%5fPACKAGE%5fVERSION" target="_top">
<tt>apm_package_version</tt> PL/SQL package</a>.</p><p>To create a new package version, use the
<tt>apm_package_version.new</tt> constructor function.</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

function new (
    version_id          in apm_package_versions.version_id%TYPE
                default null,
    package_key         in apm_package_versions.package_key%TYPE,
    version_name        in apm_package_versions.version_name%TYPE
                                default null,
    version_uri         in apm_package_versions.version_uri%TYPE,
    summary         in apm_package_versions.summary%TYPE,
    description_format      in apm_package_versions.description_format%TYPE,
    description         in apm_package_versions.description%TYPE,
    release_date        in apm_package_versions.release_date%TYPE,
    vendor          in apm_package_versions.vendor%TYPE,
    vendor_uri          in apm_package_versions.vendor_uri%TYPE,
    installed_p         in apm_package_versions.installed_p%TYPE
                                default 'f',
    data_model_loaded_p     in apm_package_versions.data_model_loaded_p%TYPE
                        default 'f'
) return apm_package_versions.version_id%TYPE;

</pre></td></tr></table></blockquote><p>In order to use this function, an existing <tt>package_key</tt> must
be specified. The <tt>version_name</tt> parameter must follow a strict
convention:</p><div class="orderedlist"><ol type="1"><li><a name="N17417"></a><p>A major version number</p></li><li><a name="N17420"></a><p>at least one minor version number. Although any number of minor version
numbers may be included, three minor version numbers is sufficient and is the
convention of software developers.</p></li><li><a name="N17423"></a><p>One of the following: </p><div class="itemizedlist"><ul><li><a name="N17427"></a><p>The letter <tt>d</tt>, indicating a development-only version</p></li><li><a name="N17434"></a><p>The letter <tt>a</tt>, indicating an alpha release</p></li><li><a name="N17441"></a><p>The letter <tt>b</tt>, indicating a beta release</p></li><li><a name="N17448"></a><p>No letter at all, indicating a final production release</p></li></ul></div></li></ol></div><p>In addition, the letters <tt>d</tt>, <tt>a</tt>, and
<tt>b</tt> may be followed by another integer, indicating a version
within the release.</p><p>For those who like regular expressions:</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

version_number := ^[0-9]+((\.[0-9]+)+((d|a|b|)[0-9]?)?)$

</pre></td></tr></table></blockquote><p>So the following is a valid progression for version numbers:</p><blockquote class="blockquote"><p><tt>0.9d, 0.9d1, 0.9a1, 0.9b1, 0.9b2, 0.9, 1.0, 1.0.1, 1.1b1,
1.1</tt></p></blockquote><p>To delete a given version of a package, use the
<tt>apm_package_version.delete</tt> procedure:</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

procedure delete (
    package_id      in apm_packages.package_id%TYPE  
);

</pre></td></tr></table></blockquote><p>After creating a version, it is possible to edit the information
associated with it using <tt>apm_package_version.edit</tt>.</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

function edit (
      new_version_id        in apm_package_versions.version_id%TYPE
                default null,
      version_id        in apm_package_versions.version_id%TYPE,
      version_name      in apm_package_versions.version_name%TYPE
                default null,
      version_uri       in apm_package_versions.version_uri%TYPE,
      summary           in apm_package_versions.summary%TYPE,
      description_format    in apm_package_versions.description_format%TYPE,
      description       in apm_package_versions.description%TYPE,
      release_date      in apm_package_versions.release_date%TYPE,
      vendor            in apm_package_versions.vendor%TYPE,
      vendor_uri        in apm_package_versions.vendor_uri%TYPE,
      installed_p       in apm_package_versions.installed_p%TYPE
                default 'f',
      data_model_loaded_p   in apm_package_versions.data_model_loaded_p%TYPE
                default 'f'
) return apm_package_versions.version_id%TYPE;

</pre></td></tr></table></blockquote><p>Versions can be enabled or disabled. Enabling a version instructs APM to
source the package's libraries on startup and to make the package
available to the ACS.</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

procedure enable (
    version_id          in apm_package_versions.version_id%TYPE
);

procedure disable (
    version_id          in apm_package_versions.version_id%TYPE  
);

</pre></td></tr></table></blockquote><p>Files associated with a version can be added and removed. The path is
relative to the <strong>package-root</strong> which is
<tt>acs-server-root/packages/package-key</tt>.</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>
-- Add a file to the indicated version. 
function add_file(
    file_id             in apm_package_files.file_id%TYPE 
                        default null, 
    version_id in       apm_package_versions.version_id%TYPE, 
    path                in apm_package_files.path%TYPE,
    file_type           in apm_package_file_types.file_type_key%TYPE 
) return apm_package_files.file_id%TYPE; 

-- Remove a file from the indicated version.
procedure remove_file( 
    version_id          in apm_package_versions.version_id%TYPE,
    path                in apm_package_files.path%TYPE 
);
</pre></td></tr></table></blockquote><p>Package versions need to indicate that they provide interfaces for other
software. An interface is an API that other packages can access and utilize.
Interfaces are identified as a URI and a version name, that comply with the
specification of a version name for package URIs.</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

-- Add an interface provided by this version.
function add_interface(
    interface_id        in apm_package_dependencies.dependency_id%TYPE
                    default null,
    version_id          in apm_package_versions.version_id%TYPE,
    interface_uri       in apm_package_dependencies.service_uri%TYPE,
    interface_version       in apm_package_dependencies.service_version%TYPE
) return apm_package_dependencies.dependency_id%TYPE;

procedure remove_interface(
    interface_id        in apm_package_dependencies.dependency_id%TYPE,
    version_id          in apm_package_versions.version_id%TYPE
);

procedure remove_interface(
    interface_uri       in apm_package_dependencies.service_uri%TYPE,
    interface_version       in apm_package_dependencies.service_version%TYPE,
    version_id          in apm_package_versions.version_id%TYPE
);

</pre></td></tr></table></blockquote><p>The primary use of interfaces is for other packages to specify required
interfaces, known as dependencies. A package cannot be correctly installed
unless all of its dependencies have been satisfied.</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

-- Add a requirement for this version.  A requirement is some interface that this
-- version depends on.
function add_dependency(
    requirement_id      in apm_package_dependencies.dependency_id%TYPE
                    default null,
    version_id          in apm_package_versions.version_id%TYPE,
    requirement_uri     in apm_package_dependencies.service_uri%TYPE,
    requirement_version     in apm_package_dependencies.service_version%TYPE
) return apm_package_dependencies.dependency_id%TYPE;

procedure remove_dependency(
    requirement_id      in apm_package_dependencies.dependency_id%TYPE,
    version_id          in apm_package_versions.version_id%TYPE
);

procedure remove_dependency(
    requirement_uri     in apm_package_dependencies.service_uri%TYPE,
    requirement_version     in apm_package_dependencies.service_version%TYPE,
    version_id          in apm_package_versions.version_id%TYPE
);

</pre></td></tr></table></blockquote><p>As new versions of packages are created, it is necessary to compare their
version names. These two functions assist in that task.</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

-- Given a version_name (e.g. 3.2a), return
-- something that can be lexicographically sorted.
function sortable_version_name (
    version_name        in apm_package_versions.version_name%TYPE
) return varchar;

-- Given two version names, return 1 if one &gt; two, -1 if two &gt; one, 0 otherwise. 
-- Deprecate?
function compare(
    version_name_one        in apm_package_versions.version_name%TYPE,
    version_name_two        in apm_package_versions.version_name%TYPE
) return integer;

</pre></td></tr></table></blockquote><p><strong>Creating Instances of a Package</strong></p><p>Once a package is registered in the system, it is possible to create
instances of it. Each instance can maintain its own content and
parameters.</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

create or replace package apm_application
as

function new (
    application_id  in acs_objects.object_id%TYPE default null,
    instance_name   in apm_packages.instance_name%TYPE
            default null,
    package_key     in apm_package_types.package_key%TYPE,
    object_type     in acs_objects.object_type%TYPE
               default 'apm_application',
    creation_date   in acs_objects.creation_date%TYPE default sysdate,
    creation_user   in acs_objects.creation_user%TYPE default null,
    creation_ip     in acs_objects.creation_ip%TYPE default null,
    context_id      in acs_objects.context_id%TYPE default null
) return acs_objects.object_id%TYPE;

procedure delete (
    application_id      in acs_objects.object_id%TYPE
);
end apm_application;

</pre></td></tr></table></blockquote><p>Just creating a package instance is not sufficient for it to be served
from the web server. A corresponding site node must be created for it. As an
example, here is how the <a href="/api-doc" target="_top">ACS API Documentation</a> service
makes itself available on the ACS main site:</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

declare
    api_doc_id integer;
begin
    api_doc_id := apm_service.new (
      instance_name =&gt; 'ACS API Browser',
      package_key =&gt; 'acs-api-browser',
      context_id =&gt; main_site_id
    );

    apm_package.enable(api_doc_id);

    api_doc_id := site_node.new (
      parent_id =&gt; site_node.node_id('/'),
      name =&gt; 'api-doc',
      directory_p =&gt; 't',
      pattern_p =&gt; 't',
      object_id =&gt; api_doc_id
    );

    commit;
end;
/
show errors


</pre></td></tr></table></blockquote><p><strong>Specifying Configuration Parameters for each Instance</strong></p><p>A parameter is a setting that can be changed on a package instance basis.
Parameters are registered on each <tt>package_key</tt>, and the values
are associated with each instance. Parameters can have default values and can
be of type 'string' or 'number.' There is support with this
API for setting a number of minimum and maximum values for each parameter,
but for most instances, the minimum and maximum should be 1. It is useful to
allow or require multiple values for packages that need to store multiple
pieces of information under one parameter. Default values are automatically
set when instances are created, but can be changed for each instance.</p><p>All of the functions below are in the <a href="/api-doc/plsql-subprogram-one?type=PACKAGE&amp;name=APM" target="_top">APM PL/SQL
package</a>.</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

-- Indicate to APM that a parameter is available to the system.
function register_parameter (
    parameter_id        in apm_parameters.parameter_id%TYPE 
                default null,
    parameter_name      in apm_parameters.parameter_name%TYPE,
    description         in apm_parameters.description%TYPE
                default null,
    package_key         in apm_parameters.package_key%TYPE,
    datatype            in apm_parameters.datatype%TYPE 
                default 'string',
    default_value       in apm_parameters.default_value%TYPE 
                default null,
    section_name        in apm_parameters.section_name%TYPE
                default null,
    min_n_values        in apm_parameters.min_n_values%TYPE 
                default 1,
    max_n_values        in apm_parameters.max_n_values%TYPE 
                default 1
) return apm_parameters.parameter_id%TYPE;

function update_parameter (
    parameter_id        in apm_parameters.parameter_id%TYPE,
    parameter_name      in apm_parameters.parameter_name%TYPE,
    description         in apm_parameters.description%TYPE
                default null,
    package_key         in apm_parameters.package_key%TYPE,
    datatype            in apm_parameters.datatype%TYPE 
                default 'string',
    default_value       in apm_parameters.default_value%TYPE 
                default null,
    section_name        in apm_parameters.section_name%TYPE
                default null,
    min_n_values        in apm_parameters.min_n_values%TYPE 
                default 1,
    max_n_values        in apm_parameters.max_n_values%TYPE 
                default 1
) return apm_parameters.parameter_name%TYPE;

-- Remove any uses of this parameter.
procedure unregister_parameter (
    parameter_id        in apm_parameters.parameter_id%TYPE 
                default null
);

</pre></td></tr></table></blockquote><p>The following functions are used to associate values with parameters and
instances:</p><blockquote><table border="0" cellpadding="5" cellspacing="0"><tr><td class="codeblock"><pre>

-- Return the value of this parameter for a specific package and parameter.
function get_value (
    parameter_id        in apm_parameter_values.parameter_id%TYPE,
    package_id          in apm_packages.package_id%TYPE         
) return apm_parameter_values.attr_value%TYPE;

function get_value (
    package_id          in apm_packages.package_id%TYPE,
    parameter_name      in apm_parameters.parameter_name%TYPE
) return apm_parameter_values.attr_value%TYPE;

-- Sets a value for a parameter for a package instance.
procedure set_value (
    parameter_id        in apm_parameter_values.parameter_id%TYPE,
    package_id          in apm_packages.package_id%TYPE,        
    attr_value          in apm_parameter_values.attr_value%TYPE
);

procedure set_value (
    package_id          in apm_packages.package_id%TYPE,
    parameter_name      in apm_parameters.parameter_name%TYPE,
    attr_value          in apm_parameter_values.attr_value%TYPE
);  

</pre></td></tr></table></blockquote></div><div id="apm-design-data-model" class="sect2"><div class="titlepage"><h3 class="title"><a name="apm-design-data-model"></a><span class="label">11.7.</span> <span class="title">Data Model Discussion</span></h3></div><p>The central piece of the data model is the <tt>apm_package_types</tt>
table where each package is registered. When a new application or service is
installed on an ACS instance, a corresponding row in this table is inserted
with information about the type of package, e.g. if the <a href="/doc/bboard" target="_top">bboard package</a> is installed on your ACS server, a row
in <tt>apm_package_types</tt> will be created, noting that it's an
application package type.</p><p>The <tt>apm_packages</tt> table is used to contain information about
the <i>instances</i> of packages currently created in the system. The
<tt>package_key</tt> column references the <tt>apm_package_types</tt>
table to ensure that no package instance can be created for a type that does
not exist.</p><p>The <tt>apm_package_versions</tt> table contains information specific
to a particular version of a package. Several tables reference this one to
provide further information about the particular version:</p><div class="itemizedlist"><ul><li><a name="N17609"></a><p><tt>apm_package_owners</tt>
 Stores information about the owners of a particular version of a package.


</p></li><li><a name="N17615"></a><p><tt>apm_package_files</tt>
 Stores information about the files that are part of a version.


</p></li><li><a name="N17621"></a><p><tt>apm_package_dependencies</tt>
 Stores information about what interfaces the package provides and
requires.</p></li></ul></div><p>Parameter information is maintained through two tables:</p><div class="itemizedlist"><ul><li><a name="N17630"></a><p><tt>apm_parameters</tt>
 This table contains the definition of each of the parameters for a package.


</p></li><li><a name="N17636"></a><p><tt>apm_parameter_values</tt>
 This table holds all of the values of parameters for specific package
instances.


</p></li></ul></div><p>A number of views are available for obtaining information about packages
registered in the APM.</p><div class="itemizedlist"><ul><li><a name="N17645"></a><p><tt>apm_package_version_info</tt>
 Provides information about all of the versions in the system with
information available from the <tt>apm_package_types</tt> table.


</p></li><li><a name="N17655"></a><p><tt>apm_enabled_package_versions</tt>
 A view (subset) of the above table with only enabled versions.


</p></li><li><a name="N17661"></a><p><tt>apm_file_info</tt>
 Provides a public interface for querying file information.</p></li></ul></div></div><div id="apm-design-ui" class="sect2"><div class="titlepage"><h3 class="title"><a name="apm-design-ui"></a><span class="label">11.8.</span> <span class="title">User Interface</span></h3></div><p>The <a href="/acs-admin/apm" target="_top">APM's user interface</a> is part of the
<a href="/acs-admin" target="_top">ACS Administration Service</a>. The UI is the primary
point of contact with APM by developers and administrators. It is part of ACS
Administration, because only the site-wide administrator should be able to
access it. Thus in order to develop a package, the developer must be granted
site-wide administration.</p></div><div id="apm-design-config" class="sect2"><div class="titlepage"><h3 class="title"><a name="apm-design-config"></a><span class="label">11.9.</span> <span class="title">Configuration/Parameters</span></h3></div><p>APM has two parameters for configuring how it interacts with the UNIX
filesystem, accessible via the <a href="/admin/site-map/" target="_top">Site Map admin</a>
page. These parameters need not be changed under most circumstances, but may
need to be tweaked for Windows compatibility.</p><div class="itemizedlist"><ul><li><a name="N17692"></a><p><strong>GzipExecutableDirectory</strong>
 This directory points to where the <tt>gunzip</tt> program can be found
for uncompressing <tt>gzip</tt> archives. This is needed for the
installation of <tt>.apm</tt> files which are simply <tt>gzip</tt>ed
tarballs. Default is <tt>/usr/local/bin</tt> 


</p></li><li><a name="N17717"></a><p><strong>InfoFilePermissionsMode</strong>
 This sets the default UNIX permissions used when creating files using the
APM. Default is 775.</p></li></ul></div></div><div id="apm-design-future" class="sect2"><div class="titlepage"><h3 class="title"><a name="apm-design-future"></a><span class="label">11.10.</span> <span class="title">Future Improvements/Areas of Likely Change</span></h3></div><p>APM has been in production since ACS 3.3, and as of version 4.0 offers a
stable set of features. One major feature planned is integration with the ACS
Package Repository for automatic dependency satisfaction. When a user tries
to install a package that depends on other packages, the APM will contact the
package repository, determine what packages depend on it, and offer the user
a chance to download and install them all. This improvement offers value to
end users by facilitating the extension of their ACS systems.</p><p>Architecturally, minor improvements to the data model and the
specification file are planned to increase modularity. The current
implementation puts all package specification information in a single file.
This approach has certain advantages, such as centralization, but splitting
this information into several files allows for flexible extensions to the APM
architecture over time.</p><p>APM packages currently lack provisions to verify security information.
There are plans to add MD5 time stamps and PGP signatures to packages to
enable secure authentication of packages. These steps are necessary for APM
to be usable as a scalable method to distribute packages on multiple
repositories worldwide.</p><p>Another anticipated change is to split the APM UI into separate systems
for authoring, maintaining, and installing packages. The current UI presents
all of this functionality in one interface and it can be confusing from a
usability perspective.</p></div><div id="apm-design-authors" class="sect2"><div class="titlepage"><h3 class="title"><a name="apm-design-authors"></a><span class="label">11.11.</span> <span class="title">Authors</span></h3></div><div class="itemizedlist"><ul><li><a name="N17739"></a><p>System creator: Bryan Quinn, Jon Salz, Michael Yoon, Lars Pind, Todd
Nightingale.</p></li><li><a name="N17742"></a><p>System owner: Bryan Quinn</p></li><li><a name="N17745"></a><p>Documentation author: Bryan Quinn, building from earlier versions by Jon
Salz, Michael Yoon, and Lars Pind.</p></li></ul></div></div><div id="apm-design-rev-history" class="sect2"><div class="titlepage"><h3 class="title"><a name="apm-design-rev-history"></a><span class="label">11.12.</span> <span class="title">Revision History</span></h3></div><div class="informaltable" id="N17752"><a name="N17752"></a><table cellpadding="5" cellspacing="0" border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><strong xmlns="">Document Revision #</strong></td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><strong xmlns="">Action Taken, Notes</strong></td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><strong xmlns="">When?</strong></td><td xmlns="http://www.w3.org/TR/xhtml1/transitional"><strong xmlns="">By Whom?</strong></td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">0.1</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Creation</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">9/25/2000</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Bryan Quinn</td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">0.8</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Ready for QA</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">9/29/2000</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Bryan Quinn</td></tr><tr><td xmlns="http://www.w3.org/TR/xhtml1/transitional">0.9</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Edited for ACS 4 Beta release</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">10/02/2000</td><td xmlns="http://www.w3.org/TR/xhtml1/transitional">Kai Wu</td></tr></tbody></table></div></div></div><div class="navfooter"><hr size="1" noshade><table width="100%"><tr><td width="40%" align="left"><a class="bottomnav" href="apm-requirements.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a href="mailto:acs-docs@arsdigita.com"><address class="nav">acs-docs@arsdigita.com</address></a></td><td width="40%" align="right">&nbsp;<a class="bottomnav" href="security-requirements.html">Next</a></td></tr></table></div></body></html>
