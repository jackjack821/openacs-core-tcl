<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>OpenACS 4 Permissions Design</title><meta name="generator" content="DocBook XSL Stylesheets V1.60.1"><link rel="home" href="index.html" title="OpenACS Documentation"><link rel="up" href="kernel-doc.html" title="Chapter 11. Kernel Documentation"><link rel="previous" href="permissions-requirements.html" title="OpenACS 4 Permissions Requirements"><link rel="next" href="groups-requirements.html" title="OpenACS 4 Groups Requirements"><link rel="stylesheet" href="openacs.css" type="text/css"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><a href="http://openacs.org"><img src="images/alex.jpg" border="0"></a><table width="100%" summary="Navigation header" border="0"><tr><td width="20%" align="left"><a accesskey="p" href="permissions-requirements.html">Prev</a> </td><th width="60%" align="center">Chapter 11. Kernel Documentation</th><td width="20%" align="right"> <a accesskey="n" href="groups-requirements.html">Next</a></td></tr></table><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="permissions-design"></a>OpenACS 4 Permissions Design</h2></div></div><div></div></div><div class="authorblurb"><p>
by <a href="mailto:jmp@arsdigita.com" target="_top">John Prevost</a> and <a href="http://planitia.org" target="_top">Rafael H. Schloming</a><br>
          OpenACS docs are written by the named authors, and may be edited
          by OpenACS documentation staff.
        </p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="permissions-design-essentials"></a>Essentials</h3></div></div><div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Tcl in <tt class="computeroutput">packages/acs-kernel</tt></p></li><li><p><a href="permissions-requirements.html">OpenACS 4 Permissions Requirements</a></p></li><li><p><a href="/doc/sql/display-sql?url=acs-permissions-create.sql&amp;package_key=acs-kernel" target="_top">
SQL file</a></p></li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="permissions-design-intro"></a>Introduction</h3></div></div><div></div></div><p>The goal of the Permissions system is to provide generic means to both
programmers and site administrators to check, grant, or revoke permissions via a
consistent interface. For example, we might decide that the transaction that
bans a user from a sub-site is an operation a site administrator is able to
assign to a particular user. Or perhaps an application developer might decide
that viewing a certain set of pages within the application is an operation to
be individually granted or revoked from a user. It's expected that the
Permissions system will be seeing a lot of use - almost every page will make
at least one permissions API call, and some will make several.</p><p>For programmers, the Permissions API provides a means to work with access
control in a consistent manner. If a programmer's OpenACS package defines new
privilege for itself, the Permissions API must provide simple calls to
determine whether the current user is has been granted that privilege on a given
object. In addition, using the Permissions API, queries should easily select only
those package objects on which a user has certain permissions.</p><p>For site administrators and other authorized users, the Permissions UI
provides a means to grant and revoke privileges on objects.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="permissions-design-history"></a>Historical Considerations</h3></div></div><div></div></div><p>In earlier versions of the OpenACS toolkit, permissions and access control was handled
on a module-by-module basis, often even on a page-by-page basis. For example,
a typical module might allow any registered user to access its pages
read-only, but only allow members of a certain group to make changes. The way
this group was determined also varied greatly between modules. Some modules
used &quot;roles&quot;, while others did not. Other modules did all access
control based simply on coded rules regarding who can act on a given database
row based on the information in that row.</p><p>Problems resulting from this piecemeal approach to permissions and access
control were many, the two major ones being inconsistency, and
repeated/redundant code. Thus the drive in OpenACS 4 to provide a unified,
consistent permissions system that both programmers and administrators can
readily use.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="permissions-design-design-tradeoffs"></a>Design Tradeoffs</h3></div></div><div></div></div><p>The core of the permissions data model is quite simple. Unfortunately, the
hierarchical nature of default permissions entails quite a number of tree
queries which could slow the system down. Since every page will have at least
one permissions check, a number of views and auxiliary tables
(de-normalizations of the data model) have been created to speed up access
queries. As a consequence, speed of updates are decreased and requirements
for additional storage space increase.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="permissions-design-data-model"></a>Data Model Discussion</h3></div></div><div></div></div><p>The core model consists of three tables:</p><div class="variablelist"><dl><dt><span class="term"><tt class="computeroutput">acs_privileges</tt>

</span></dt><dd><p>The set of all defined privileges.</p></dd><dt><span class="term"><tt class="computeroutput">acs_privilege_hierarchy</tt>

</span></dt><dd><p>A relation describing which privileges <span class="strong">directly</span>
&quot;contain&quot; other privileges.</p></dd><dt><span class="term"><tt class="computeroutput">acs_permissions</tt>

</span></dt><dd><p>A table with one (<span class="emphasis"><em>party</em></span>, <span class="emphasis"><em>object</em></span>, <span class="emphasis"><em>privilege</em></span>)
row for every privilege <span class="strong">directly</span> granted on any object in
the system.
</p></dd></dl></div><p>There are also a number of views to make it easier to ask specific
questions about permissions. For example, a number of the above tables
describe &quot;direct&quot; or explicit permissions. Inheritance and default
values can, however, introduce permissions which are not directly specified.
(For example, read access on a bboard allows read access on all the messages
in the bboard.)</p><p>The following views provide flattened versions of inherited
information:</p><div class="variablelist"><dl><dt><span class="term"><tt class="computeroutput">acs_object_grantee_priv_map</tt>

</span></dt><dd><p>Relation on (<span class="emphasis"><em>object</em></span>, <span class="emphasis"><em>party</em></span>, <span class="emphasis"><em>privilege</em></span>) for
privileges from <tt class="computeroutput">acs_privileges</tt>) granted directly on the object, or
on the context of the object (at any depth).</p></dd><dt><span class="term"><tt class="computeroutput">acs_object_party_privilege_map</tt>

</span></dt><dd><p>Relation on (<span class="emphasis"><em>object</em></span>, <span class="emphasis"><em>party</em></span>, <span class="emphasis"><em>privilege</em></span>) for
privileges directly from <tt class="computeroutput">acs_object_grantee_priv_map</tt> or also because
a party is a member of a group (at any depth).  This view is normally used in an <tt class="computeroutput">exists</tt>
clause to constrain the rows returned by a query to those on which a given party has a given privilege.</p></dd></dl></div><p>The data model also includes two simple PL/SQL procedures
(<tt class="computeroutput">acs_permission.grant_permission</tt> and
<tt class="computeroutput">acs_permission.revoke_permission</tt>) for granting and revoking a
specific privilege for a specific user on a specific object.</p><p>To sum up, the PL/SQL procedures are meant to be used to grant or revoke
permissions. The three base tables represent the basic data model of the
system, with a set of views provided to convert them into a format suitable
for joining to answer specific questions. The exact means by which this
transformation takes place should not be depended on, since they may change
for efficiency reasons.</p><p>The transformations done create a set of default permissions, in
which:</p><div class="itemizedlist"><ul type="disc"><li><p>parties get the privileges of any groups they are directly or indirectly
a member of</p></li><li><p>objects get access control from direct grants, or inherit permissions
from their context (unless the &quot;don't inherit&quot; flag is
set)</p></li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="permissions-design-transactions"></a>Legal Transactions</h3></div></div><div></div></div><p>There are two essential areas in which all transactions in the
permissions system fall (a privilege is a an operation like &quot;read&quot;,
permissions define which parties have which privileges on which
objects):</p><div class="itemizedlist"><ul type="disc"><li><p>Modification of privileges</p></li><li><p>Modification of permissions</p></li><li><p>Queries on permissions</p></li></ul></div><p><span class="strong">&quot;Modification of privileges.&quot;</span> This
refers to actions that happen mainly at package installation time - a package
may create new privileges and aggregations of privileges.  This should be done with care, as
each additional privilege and parent-child privilege relationship added to the system
decreases the performance of the permissions system.  Historically, packages have created
their own versions of common privileges like &quot;read&quot; or &quot;write&quot; rather than use the global
permissions created by the kernel.  This practice is now discouraged as it adds no
usable functionality, makes the design and implementation of general-purpose permissions UI pages
more difficult, and as mentioned previously negatively impacts performance.
</p><p><span class="strong">&quot;Modification of permissions.&quot;</span> - involves fairly
common operations. Users are typically able to administer permissions for
objects they themselves create. The two basic operations here are
&quot;grant&quot; and &quot;revoke&quot;. Granting permissions is done via
<tt class="computeroutput">acs_permissions.grant_permission</tt>, and revocation via
<tt class="computeroutput">acs_permissions.revoke_permission</tt>. These directly manipulate the
<tt class="computeroutput">acs_permissions</tt> table.</p><p>Web pages for making these changes are available to all users, so they
should not be in an admin area. In order to grant and revoke permissions on
an object, the user must have the <tt class="computeroutput">admin</tt>
privilege on that object.</p><p><span class="strong">&quot;Queries on permissions&quot;</span> - by far the most
common operation is querying the permissions database. Several kinds of
questions are commonly asked: First, and most commonly, &quot;Can this party
perform this operation on this object?&quot; Two Tcl functions are provided to
answer this - one which returns a boolean, the other of which results in an
error page.</p><p>The second most commonly asked question occurs when a list of objects is
being displayed, often in order to provide appropriate UI functionality.
Here, the SQL query needs to filter based on whether the party/user can
perform some operation on the object. This is done by using an <tt class="computeroutput">exists</tt>
clause that returns a value if any row exists in the <tt class="computeroutput">acs_object_party_privilege_map</tt>
view with the given party, object and privilege.</p><p>Finally, when administering the permissions for an object, a web page
needs to know all permissions directly granted on that object. This is done
by querying against <tt class="computeroutput">acs_permissions</tt>.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="permissions-design-api"></a>API</h3></div></div><div></div></div><p>The API to the permissions system consists of a few well-known tables,
plus a pair of PL/SQL procedures and a pair of Tcl functions.</p><p><span class="strong">Tables and views</span></p><p>The main view for queries is <tt class="computeroutput">acs_object_party_privlege_map</tt>, which
contains (<span class="emphasis"><em>object</em></span>, <span class="emphasis"><em>party</em></span>, <span class="emphasis"><em>privilege</em></span>) triples
for all allowed operations in the system.</p><p>Also of interest for queries is <tt class="computeroutput">acs_permissions</tt>, which lists
directly granted privileges. Neither <tt class="computeroutput">acs_object_party_privilege_map</tt>
(which is a view) nor <tt class="computeroutput">acs_permissions</tt> should be updated
directly.</p><p><span class="strong">PL/[pg]SQL Procedures</span></p><p><tt class="computeroutput">acs_permissions.grant_permission</tt> introduces new permissions for
an object. It should be given an (<span class="emphasis"><em>object</em></span>, <span class="emphasis"><em>party</em></span>,
<span class="emphasis"><em>privilege</em></span>) triple, and will always succeed. If the permission is
already in the system, no change occurs.</p><p>The interface for this procedure is:</p><pre class="programlisting">
procedure grant_permission (
  object_id    acs_permissions.object_id%TYPE,
  grantee_id   acs_permissions.grantee_id%TYPE,
  privilege    acs_permissions.privilege%TYPE
);
</pre><p><tt class="computeroutput">acs_permissions.revoke_permission</tt> removes a permission entry
given a triple. It always succeeds--if a permission does not exist, nothing
changes. The interface for this procedure is:</p><pre class="programlisting">
procedure revoke_permission (
  object_id    acs_permissions.object_id%TYPE,
  grantee_id   acs_permissions.grantee_id%TYPE,
  privilege    acs_permissions.privilege%TYPE
);
</pre><p>These procedures are defined in <a href="http://acs40.arsdigita.com/doc/sql/display-sql?url=acs-permissions-create.sql&amp;package_key=acs-kernel" target="_top">
<tt class="computeroutput">permissions-create.sql</tt></a></p><p><span class="strong">Tcl Procedures</span></p><p>Two tcl procedures provide a simple call for the query, &quot;Can this
user perform this method on this object?&quot; One returns true or false, the
other presents an error page.</p><p>To receive a true or false value, Tcl code should call:</p><pre class="programlisting">
permission::permission_p -party_id $party_id -object_id $object_id -privilege $privilege
</pre><p>To create an error page, Tcl code should call:</p><pre class="programlisting">
permission::require_permission -party_id $party_id -object_id $object_id -privilege $privilege
</pre><p>These procedures are defined in <tt class="computeroutput">acs-permissions-procs.tcl</tt>.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="permissions-design-ui"></a>User Interface</h3></div></div><div></div></div><p>All users of the permissions system are the same at the user-interface
level. If you have the <tt class="computeroutput">admin</tt> privilege on an
object, then you may edit privileges for that object with the UI.</p><p>The UI currently provides a list of all granted permissions on the object.
If the user wishes to revoke privileges, she may select a set of grants,
choose revoke, confirm their deletion, and be returned to the same page after
those privileges have been revoked.</p><p>Granting permissions currently (as of 10/2000) works by providing a list
of all possible permissions and a list of all parties in the system. (For
large sites, some future search mechanism will be necessary.) After choosing
privileges to grant, the user is returned to the &quot;edit privileges for
one object&quot; screen.</p><p>If it makes sense, the system will also display a checkbox which the user
may select to toggle whether permissions are inherited from the object's
context.</p><p>There are a number of potential future enhancements for the permissions
UI, outlined below.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="permissions-design-configure"></a>Configuration/Parameters</h3></div></div><div></div></div><p>There are no configuration options for the permissions system.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="permissions-design-future"></a>Future Improvements/Areas of Likely Change</h3></div></div><div></div></div><p>The most important future changes to the Permissions system are likely to
be in the UI:</p><div class="itemizedlist"><ul type="disc"><li><p>There should be a page displaying a list of all objects for which the
current user is allowed to administer privileges.</p></li><li><p>Users should be able to view the permissions on any object, or perhaps on
objects which they have the &quot;read_permissions&quot; method. This would
allow them to see what grants are affecting their objects through
inheritance.</p></li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="permissions-design-authors"></a>Authors</h3></div></div><div></div></div><div class="variablelist"><dl><dt><span class="term">System creator

</span></dt><dd><p><a href="mailto:rhs@mit.edu" target="_top">Rafael H. Schloming</a></p></dd><dt><span class="term">System maintainer

</span></dt><dd><p><a href="mailto:dhogaza@pacifier.com" target="_top">Don Baccus</a></p></dd><dt><span class="term">Documentation author

</span></dt><dd><p>John Prevost</p></dd></dl></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="permissions-design-rev-history"></a>Revision History</h3></div></div><div></div></div><div class="informaltable"><table border="1"><colgroup><col><col><col><col></colgroup><tbody><tr><td><span class="strong">Document Revision #</span></td><td><span class="strong">Action Taken, Notes</span></td><td><span class="strong">When?</span></td><td><span class="strong">By Whom?</span></td></tr><tr><td>0.1</td><td>Creation</td><td>9/11/2000</td><td>John Prevost</td></tr><tr><td>0.2</td><td>Edited for ACS 4 Beta release</td><td>10/04/2000</td><td>Kai Wu</td></tr><tr><td>0.3</td><td>Edited for OpenACS 4.6.3</td><td>05/04/2003</td><td>Don Baccus</td></tr></tbody></table></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="permissions-requirements.html">Prev</a> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right"> <a accesskey="n" href="groups-requirements.html">Next</a></td></tr><tr><td width="40%" align="left">OpenACS 4 Permissions Requirements </td><td width="20%" align="center"><a accesskey="u" href="kernel-doc.html">Up</a></td><td width="40%" align="right"> OpenACS 4 Groups Requirements</td></tr></table><hr><address><a href="mailto:docs@openacs.org">docs@openacs.org</a></address></div><a name="comments"></a><center><a href="http://openacs.org/doc/openacs-4-6-3/permissions-design.html#comments">View comments on this page at openacs.org</a></center></body></html>
