<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Upgrading the OpenACS files</title><meta name="generator" content="DocBook XSL Stylesheets V1.62.4"><link rel="home" href="index.html" title="OpenACS Core Documentation"><link rel="up" href="upgrade.html" title="Chapter 5. Upgrading"><link rel="previous" href="upgrade-openacs.html" title="Upgrading OpenACS"><link rel="next" href="upgrade-supporting.html" title="Upgrading Platform components"><link rel="stylesheet" href="openacs.css" type="text/css"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><a href="http://openacs.org"><img src="/doc/images/alex.jpg" border="0"></a><table width="100%" summary="Navigation header" border="0"><tr><td width="20%" align="left"><a accesskey="p" href="upgrade-openacs.html">Prev</a> </td><th width="60%" align="center">Chapter 5. Upgrading</th><td width="20%" align="right"> <a accesskey="n" href="upgrade-supporting.html">Next</a></td></tr></table><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="upgrade-openacs-files"></a>Upgrading the OpenACS files</h2></div></div><div></div></div><p>OpenACS is distributed as a collection of files, available as one big tarball, via CVS, and via automatic download from within the APM.  Upgrades work by first changing the file system (via any of the previous methods), and then using the APM to scan the file system, find upgrade scripts, and execute them.  This section describes how to upgrade the file system.  Starting with OpenACS 5.0, this section can generally be skipped because the OpenACS APM can directly download new files from the openacs.org repository.</p><p>Many OpenACS site developers operate their own CVS repository to keep track of changes from the release OpenACS code.  This part describes how to import the latest OpenACS version into your own repository.  If you are using CVS, you will unpack the OpenACS 4.6 tarball into a working directory and then import that directory into cvs.  If you have changed files in the core packages, cvs will attempt to merge your changes.  You may have to manually merge some conflicts.  When that's finished, you can update your normal development checkout directory and the new files will appear.  If you aren't using CVS, you can unpack the tarball on top of your existing tree, but any customizations you've made to the kernel or core packages will be erased.</p><div class="itemizedlist"><ul type="disc"><li><p><b>Upgrading files for a site which is not in a CVS repository. </b>Unpack the tarball into a new directory and copy its contents on top of your working directory.</p><pre class="screen">[root root]# <b class="userinput"><tt>su - <span class="replaceable"><span class="replaceable">service0</span></span></tt></b>
        [service0 aolserver]$ <b class="userinput"><tt>cd /var/lib/aolserver</tt></b>
        [service0 web]$ <b class="userinput"><tt>tar xzf /tmp/openacs-4-6.tgz</tt></b>
        [service0 web]$ <b class="userinput"><tt>cp -r openacs-4-6/* openacs-4</tt></b>
        [service0 openacs-upgrade]$ <b class="userinput"><tt>exit</tt></b>
        [root root]#
        <pre class="action"><span class="action">su - <span class="replaceable"><span class="replaceable">service0</span></span>
        cd /var/lib/aolserver
        tar xzf /tmp/openacs-4-6.tgz
        cp -r openacs-4-6/* openacs-4
        exit</span></pre></pre></li><li><p>
          <span class="strong">Upgrading files for a site which is in a CVS repository</span>
        </p><div class="orderedlist"><ol type="1"><li><p>Unpack the new files into a working directory.</p><pre class="screen">[root root]# <b class="userinput"><tt>su - <span class="replaceable"><span class="replaceable">service0</span></span></tt></b>
            [service0 aolserver]$ <b class="userinput"><tt>cd /tmp</tt></b>
            [service0 tmp]$ <b class="userinput"><tt>tar xzf openacs-4-6.tgz</tt></b>
            [service0 tmp]$ <b class="userinput"><tt>cd openacs-4.6</tt></b></pre><p>Import the new files into your cvs repository; where they match existing files, they will become the new version of the file.</p><pre class="screen">[service0 openacs-4.6]$ <b class="userinput"><tt> cvs import -m "upgrade to OpenACS 4.6" openacs 
            OpenACS openacs-4-6</tt></b></pre><p>Create a new directory as temporary working space to reconcile conflicts between the new files and your current work.  The example uses the cvs keyword yesterday, making the assumption that you haven't checked in new code to your local tree in the last day.</p><pre class="screen">[service0 openacs-4.6]$ <b class="userinput"><tt> cd /var/lib/aolserver</tt></b>
            [service0 tmp]$ <b class="userinput"><tt>mkdir openacs-upgrade</tt></b>
            [service0 tmp]$ <b class="userinput"><tt>cvs checkout -d openacs-upgrade -jOpenACS:yesterday -jOpenACS openacs &gt; cvs.txt 2&gt;&amp;1</tt></b>
            (CVS feedback here)
            <pre class="action"><span class="action">su - <span class="replaceable"><span class="replaceable">service0</span></span>
            cd /tmp
            tar xzv openacs-4-6.tgz
            cd openacs-4.6
            cvs import -m "upgrade to OpenACS 4.6" openacs OpenACS openacs-4-6
            cd /tmp
            mkdir openacs-upgrade
            cvs checkout -d openacs-upgrade -jOpenACS:yesterday -jOpenACS openacs &gt; cvs.txt 2&gt;&amp;1</span></pre></pre></li><li><p>The file /tmp/openacs-upgrade/cvs.txt contains the results of the upgrade.  If you changed files that are part of the OpenACS tarball and those changes conflict with the 4.5-4.6 upgrade, you'll have to manually reconcile them.  Use the emacs command <tt class="computeroutput">M-x sort-lines</tt> and then, for each line that starts with a C, open that file and manually resolve the conflict by deleting the excess lines.  When you're finished, or if there aren't any conflicts, save and exit.</p></li><li><p>Once you've fixed any conflicts, commit the new code
            to your local tree.  </p><pre class="screen">[service0 tmp]$ <b class="userinput"><tt>cd openacs-upgrade</tt></b>
            [service0 openacs-upgrade]$ <b class="userinput"><tt>cvs commit -m "Upgraded to 4.6"</tt></b>
            <pre class="action"><span class="action">cd openacs-upgrade
            cvs commit -m "Upgraded to 4.6"</span></pre></pre></li><li><p>Update your working tree with the new files.  The CVS flags ensure that new directories are created and pruned directories destroyed.</p><pre class="screen">[service0 openacs-upgrade]$ <b class="userinput"><tt>cd /var/lib/aolserver/<span class="replaceable"><span class="replaceable">service0</span></span></tt></b>
            [service0 service0]$ <b class="userinput"><tt>cvs up -Pd</tt></b>
            (CVS feedback)
            [service0 service0]$ <b class="userinput"><tt>exit</tt></b>
            [root root]#
            <pre class="action"><span class="action">cd /var/lib/aolserver/<span class="replaceable"><span class="replaceable">service0</span></span>
            cvs up -Pd
            exit</span></pre></pre></li></ol></div></li></ul></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="upgrade-openacs.html">Prev</a> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right"> <a accesskey="n" href="upgrade-supporting.html">Next</a></td></tr><tr><td width="40%" align="left">Upgrading OpenACS </td><td width="20%" align="center"><a accesskey="u" href="upgrade.html">Up</a></td><td width="40%" align="right"> Upgrading Platform components</td></tr></table><hr><address><a href="mailto:docs@openacs.org">docs@openacs.org</a></address></div><a name="comments"></a><center><a href="http://openacs.org/doc/upgrade-openacs-files.html#comments">View comments on this page at openacs.org</a></center></body></html>
